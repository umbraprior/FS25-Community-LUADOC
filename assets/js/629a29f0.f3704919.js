"use strict";(globalThis.webpackChunkfs25_community_luadoc=globalThis.webpackChunkfs25_community_luadoc||[]).push([[1824],{28453(e,n,i){i.d(n,{R:()=>s,x:()=>a});var r=i(96540);const l={},t=r.createContext(l);function s(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:s(e.components),r.createElement(t.Provider,{value:n},e.children)}},77055(e,n,i){i.r(n),i.d(n,{assets:()=>g,contentTitle:()=>a,default:()=>o,frontMatter:()=>s,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"script/Specializations/JigglingParts","title":"JigglingParts","description":"JigglingParts","source":"@site/../docs/script/Specializations/JigglingParts.md","sourceDirName":"script/Specializations","slug":"/script/Specializations/JigglingParts","permalink":"/FS25-Community-LUADOC/script/Specializations/JigglingParts","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1767161192000,"frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"InlineWrapper","permalink":"/FS25-Community-LUADOC/script/Specializations/InlineWrapper"},"next":{"title":"Leveler","permalink":"/FS25-Community-LUADOC/script/Specializations/Leveler"}}');var l=i(74848),t=i(28453);const s={},a=void 0,g={},d=[{value:"JigglingParts",id:"jigglingparts",level:2},{value:"initSpecialization",id:"initspecialization",level:3},{value:"isJigglingPartActive",id:"isjigglingpartactive",level:3},{value:"loadJigglingPartsFromXML",id:"loadjigglingpartsfromxml",level:3},{value:"onLoad",id:"onload",level:3},{value:"onUpdate",id:"onupdate",level:3},{value:"prerequisitesPresent",id:"prerequisitespresent",level:3},{value:"registerEventListeners",id:"registereventlisteners",level:3},{value:"registerFunctions",id:"registerfunctions",level:3},{value:"updateJigglingPart",id:"updatejigglingpart",level:3}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h2,{id:"jigglingparts",children:"JigglingParts"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"Specialization for letting parts (e.g. sowing coulters) shake during work using a shader"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Functions"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#initspecialization",children:"initSpecialization"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#isjigglingpartactive",children:"isJigglingPartActive"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#loadjigglingpartsfromxml",children:"loadJigglingPartsFromXML"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#onload",children:"onLoad"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#onupdate",children:"onUpdate"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#prerequisitespresent",children:"prerequisitesPresent"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#registereventlisteners",children:"registerEventListeners"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#registerfunctions",children:"registerFunctions"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#updatejigglingpart",children:"updateJigglingPart"})}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"initspecialization",children:"initSpecialization"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"Called on specialization initializing"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Definition"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"initSpecialization()"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Code"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'function JigglingParts.initSpecialization()\n    local schema = Vehicle.xmlSchema\n    schema:setXMLSpecializationType( "JigglingParts" )\n\n    local basePath = JigglingParts.JIGGLING_PART_XML_KEY\n    schema:register(XMLValueType.NODE_INDEX, basePath .. "#node" , "Jiggling node" )\n\n    schema:register(XMLValueType.FLOAT, basePath .. "#speedScale" , "Speed scale" , 1 )\n    schema:register(XMLValueType.STRING, basePath .. "#shaderParameter" , "Shader parameter" , "amplFreq" )\n    schema:register(XMLValueType.STRING, basePath .. "#shaderParameterPrev" , "Shader parameter previous frame" , "prevAmplFreq" )\n    schema:register(XMLValueType.INT, basePath .. "#shaderParameterComponentSpeed" , "Shader component speed index" , 4 )\n    schema:register(XMLValueType.INT, basePath .. "#shaderParameterComponentAmplitude" , "Shader component amplitude index" , 1 )\n    schema:register(XMLValueType.FLOAT, basePath .. "#amplitudeScale" , "Amplitude scale" , 4 )\n    schema:register(XMLValueType.INT, basePath .. "#refNodeIndex" , "Ground reference node index" )\n\n    schema:setXMLSpecializationType()\nend\n\n'})}),"\n",(0,l.jsx)(n.h3,{id:"isjigglingpartactive",children:"isJigglingPartActive"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Definition"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"isJigglingPartActive()"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,l.jsx)(n.table,{children:(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"any"}),(0,l.jsx)(n.th,{children:"jigglingPart"})]})})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Code"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:"function JigglingParts:isJigglingPartActive(jigglingPart)\n    if jigglingPart.refNodeIndex ~ = nil and jigglingPart.refNode = = nil then\n        if self.getGroundReferenceNodeFromIndex ~ = nil then\n            local refNode = self:getGroundReferenceNodeFromIndex(jigglingPart.refNodeIndex)\n            if refNode ~ = nil then\n                jigglingPart.refNode = refNode\n            end\n        end\n\n        if jigglingPart.refNode = = nil then\n            Logging.xmlWarning( self.xmlFile, \"Unable to find ground reference node '%d' for jiggling part '%s'\" , jigglingPart.refNodeIndex, getName(jigglingPart.node))\n            end\n\n            jigglingPart.refNodeIndex = nil\n        end\n\n        if jigglingPart.refNode ~ = nil then\n            if not self:getIsGroundReferenceNodeActive(jigglingPart.refNode) then\n                return false\n            end\n        end\n\n        return true\n    end\n\n"})}),"\n",(0,l.jsx)(n.h3,{id:"loadjigglingpartsfromxml",children:"loadJigglingPartsFromXML"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Definition"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"loadJigglingPartsFromXML()"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"any"}),(0,l.jsx)(n.th,{children:"jigglingPart"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"xmlFile"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"key"})]})]})]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Code"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'function JigglingParts:loadJigglingPartsFromXML(jigglingPart, xmlFile, key)\n    XMLUtil.checkDeprecatedXMLElements(xmlFile, key .. "#index" , key .. "#node" ) --FS17 to FS19\n\n    jigglingPart.currentTime = 0\n    jigglingPart.currentAmplitudeScale = 0\n\n    jigglingPart.node = xmlFile:getValue(key .. "#node" , nil , self.components, self.i3dMappings)\n    if jigglingPart.node = = nil then\n        Logging.xmlWarning( self.xmlFile, "Failed to load node for jiggling part \'%s\'" , key)\n            return false\n        end\n\n        jigglingPart.speedScale = xmlFile:getValue(key .. "#speedScale" , 1 )\n        jigglingPart.shaderParameter = xmlFile:getValue(key .. "#shaderParameter" , "amplFreq" )\n        jigglingPart.shaderParameterPrev = xmlFile:getValue(key .. "#shaderParameterPrev" , "prevAmplFreq" )\n        jigglingPart.shaderParameterComponentSpeed = xmlFile:getValue(key .. "#shaderParameterComponentSpeed" , 4 )\n        jigglingPart.shaderParameterComponentAmplitude = xmlFile:getValue(key .. "#shaderParameterComponentAmplitude" , 1 )\n        jigglingPart.amplitudeScale = xmlFile:getValue(key .. "#amplitudeScale" , 4.0 )\n\n        jigglingPart.refNodeIndex = xmlFile:getValue(key .. "#refNodeIndex" )\n\n        jigglingPart.values = { 0 , 0 , 0 , 0 }\n\n        return true\n    end\n\n'})}),"\n",(0,l.jsx)(n.h3,{id:"onload",children:"onLoad"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Definition"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"onLoad()"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,l.jsx)(n.table,{children:(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"any"}),(0,l.jsx)(n.th,{children:"savegame"})]})})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Code"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'function JigglingParts:onLoad(savegame)\n    local spec = self.spec_jigglingParts\n\n    spec.parts = { }\n    local i = 0\n    while true do\n        local key = string.format( "vehicle.jigglingParts.jigglingPart(%d)" , i)\n        if not self.xmlFile:hasProperty(key) then\n            break\n        end\n\n        local jigglingPart = { }\n        if self:loadJigglingPartsFromXML(jigglingPart, self.xmlFile, key) then\n            table.insert(spec.parts, jigglingPart)\n        end\n\n        i = i + 1\n    end\n\n    if #spec.parts = = 0 then\n        SpecializationUtil.removeEventListener( self , "onUpdate" , JigglingParts )\n    end\nend\n\n'})}),"\n",(0,l.jsx)(n.h3,{id:"onupdate",children:"onUpdate"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Definition"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"onUpdate()"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"any"}),(0,l.jsx)(n.th,{children:"dt"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"isActiveForInput"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"isActiveForInputIgnoreSelection"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"isSelected"})]})]})]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Code"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:"function JigglingParts:onUpdate(dt, isActiveForInput, isActiveForInputIgnoreSelection, isSelected)\n    local spec = self.spec_jigglingParts\n    for _, jigglingPart in ipairs(spec.parts) do\n        if self:isJigglingPartActive(jigglingPart) then\n            self:updateJigglingPart(jigglingPart, dt, true )\n        elseif jigglingPart.currentAmplitudeScale > 0 then\n                self:updateJigglingPart(jigglingPart, dt, false )\n            end\n        end\n    end\n\n"})}),"\n",(0,l.jsx)(n.h3,{id:"prerequisitespresent",children:"prerequisitesPresent"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Definition"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"prerequisitesPresent()"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,l.jsx)(n.table,{children:(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"any"}),(0,l.jsx)(n.th,{children:"specializations"})]})})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Code"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:"function JigglingParts.prerequisitesPresent(specializations)\n    return true\nend\n\n"})}),"\n",(0,l.jsx)(n.h3,{id:"registereventlisteners",children:"registerEventListeners"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Definition"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"registerEventListeners()"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,l.jsx)(n.table,{children:(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"any"}),(0,l.jsx)(n.th,{children:"vehicleType"})]})})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Code"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'function JigglingParts.registerEventListeners(vehicleType)\n    SpecializationUtil.registerEventListener(vehicleType, "onLoad" , JigglingParts )\n    SpecializationUtil.registerEventListener(vehicleType, "onUpdate" , JigglingParts )\nend\n\n'})}),"\n",(0,l.jsx)(n.h3,{id:"registerfunctions",children:"registerFunctions"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Definition"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"registerFunctions()"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,l.jsx)(n.table,{children:(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"any"}),(0,l.jsx)(n.th,{children:"vehicleType"})]})})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Code"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'function JigglingParts.registerFunctions(vehicleType)\n    SpecializationUtil.registerFunction(vehicleType, "loadJigglingPartsFromXML" , JigglingParts.loadJigglingPartsFromXML)\n    SpecializationUtil.registerFunction(vehicleType, "isJigglingPartActive" , JigglingParts.isJigglingPartActive)\n    SpecializationUtil.registerFunction(vehicleType, "updateJigglingPart" , JigglingParts.updateJigglingPart)\nend\n\n'})}),"\n",(0,l.jsx)(n.h3,{id:"updatejigglingpart",children:"updateJigglingPart"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Definition"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"updateJigglingPart()"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"any"}),(0,l.jsx)(n.th,{children:"jigglingPart"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"dt"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"groundContact"})]})]})]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Code"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:"function JigglingParts:updateJigglingPart(jigglingPart, dt, groundContact)\n    local oldX, oldY, oldZ, oldW = jigglingPart.values[ 1 ], jigglingPart.values[ 2 ], jigglingPart.values[ 3 ], jigglingPart.values[ 4 ]\n    local x, y, z, w = getShaderParameter(jigglingPart.node, jigglingPart.shaderParameter)\n    jigglingPart.values[ 1 ], jigglingPart.values[ 2 ], jigglingPart.values[ 3 ], jigglingPart.values[ 4 ] = x, y, z, w\n\n    -- update speed\n    local t = dt / 1000 * jigglingPart.speedScale * self:getLastSpeed() / 20\n    jigglingPart.currentTime = jigglingPart.currentTime + t\n    jigglingPart.values[jigglingPart.shaderParameterComponentSpeed] = jigglingPart.currentTime\n\n    --update amplitude\n    if groundContact and jigglingPart.currentAmplitudeScale < 1 then\n        jigglingPart.currentAmplitudeScale = math.min(jigglingPart.currentAmplitudeScale + dt / 100 , 1 )\n    elseif not groundContact and jigglingPart.currentAmplitudeScale > 0 then\n            jigglingPart.currentAmplitudeScale = math.max(jigglingPart.currentAmplitudeScale - dt / 100 , 0 )\n        end\n        jigglingPart.values[jigglingPart.shaderParameterComponentAmplitude] = jigglingPart.currentAmplitudeScale * jigglingPart.amplitudeScale\n\n        setShaderParameter(jigglingPart.node, jigglingPart.shaderParameter, jigglingPart.values[ 1 ], jigglingPart.values[ 2 ], jigglingPart.values[ 3 ], jigglingPart.values[ 4 ], false )\n        setShaderParameter(jigglingPart.node, jigglingPart.shaderParameterPrev, oldX, oldY, oldZ, oldW, false )\n    end\n\n"})})]})}function o(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}}}]);