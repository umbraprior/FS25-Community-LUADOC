"use strict";(globalThis.webpackChunkfs25_community_luadoc=globalThis.webpackChunkfs25_community_luadoc||[]).push([[57765],{28453(e,n,t){t.d(n,{R:()=>l,x:()=>s});var i=t(96540);const o={},r=i.createContext(o);function l(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),i.createElement(r.Provider,{value:n},e.children)}},64661(e,n,t){t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>s,default:()=>p,frontMatter:()=>l,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"script/Networking/PlayerPositionalInterpolator","title":"PlayerPositionalInterpolator","description":"PlayerPositionalInterpolator","source":"@site/../docs/script/Networking/PlayerPositionalInterpolator.md","sourceDirName":"script/Networking","slug":"/script/Networking/PlayerPositionalInterpolator","permalink":"/FS25-Community-LUADOC/script/Networking/PlayerPositionalInterpolator","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1767161192000,"frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"PlayerNetworkComponent","permalink":"/FS25-Community-LUADOC/script/Networking/PlayerNetworkComponent"},"next":{"title":"PlayerRemoteNetworkComponent","permalink":"/FS25-Community-LUADOC/script/Networking/PlayerRemoteNetworkComponent"}}');var o=t(74848),r=t(28453);const l={},s=void 0,a={},d=[{value:"PlayerPositionalInterpolator",id:"playerpositionalinterpolator",level:2},{value:"getInterpolatedPosition",id:"getinterpolatedposition",level:3},{value:"new",id:"new",level:3},{value:"setTargetPosition",id:"settargetposition",level:3},{value:"setTargetYaw",id:"settargetyaw",level:3},{value:"update",id:"update",level:3},{value:"updateTick",id:"updatetick",level:3}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h2,{id:"playerpositionalinterpolator",children:"PlayerPositionalInterpolator"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Description"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"Handles interpolating the player's graphical position and their actual position, to ensure it is smooth."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Functions"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#getinterpolatedposition",children:"getInterpolatedPosition"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#new",children:"new"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#settargetposition",children:"setTargetPosition"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#settargetyaw",children:"setTargetYaw"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#update",children:"update"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#updatetick",children:"updateTick"})}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"getinterpolatedposition",children:"getInterpolatedPosition"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Description"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"Gets the currently interpolated position."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Definition"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"getInterpolatedPosition()"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Return Values"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"any"}),(0,o.jsx)(n.th,{children:"interpolatedPositionX"}),(0,o.jsx)(n.th,{children:"The interpolated x position."})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"any"}),(0,o.jsx)(n.td,{children:"interpolatedPositionY"}),(0,o.jsx)(n.td,{children:"The interpolated y position."})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"any"}),(0,o.jsx)(n.td,{children:"interpolatedPositionZ"}),(0,o.jsx)(n.td,{children:"The interpolated z position."})]})]})]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Code"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-lua",children:"function PlayerPositionalInterpolator:getInterpolatedPosition()\n    return self.interpolatedPositionX, self.interpolatedPositionY, self.interpolatedPositionZ\nend\n\n"})}),"\n",(0,o.jsx)(n.h3,{id:"new",children:"new"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Description"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"Creates a new positional interpolator for the given player."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Definition"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"new(Player player, integer targetNodeType)"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Player"}),(0,o.jsx)(n.th,{children:"player"}),(0,o.jsx)(n.th,{children:"The player whose root or graphical node's position will be interpolated."})]})}),(0,o.jsx)(n.tbody,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"integer"}),(0,o.jsx)(n.td,{children:"targetNodeType"}),(0,o.jsx)(n.td,{children:"The INTERPOLATION_TARGET_ENUM determining what type of node is interpolated."})]})})]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Return Values"})}),"\n\n\n\n\n\n\n\n\n",(0,o.jsx)(n.table,{children:(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"integer"}),(0,o.jsx)(n.th,{children:"self"}),(0,o.jsx)(n.th,{children:"The created instance."})]})})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Code"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-lua",children:"function PlayerPositionalInterpolator.new(player, targetNodeType)\n\n    -- Create the instance.\n    local self = setmetatable( { } , PlayerPositionalInterpolator _mt)\n\n    -- The player owning the interpolator.\n    self.player = player\n\n    -- The type of node that is being moved by the interpolation.\n    self.targetNodeType = targetNodeType\n\n    self.timeInterpolator = InterpolationTime.new( 1.2 )\n\n    local playerPositionX, playerPositionY, playerPositionZ = self.player:getPosition()\n    self.positionInterpolator = InterpolatorPosition.new(playerPositionX, playerPositionY, playerPositionZ)\n\n    self.interpolatedPositionX = playerPositionX\n    self.interpolatedPositionY = playerPositionY\n    self.interpolatedPositionZ = playerPositionZ\n\n    self.interpolatedSpeed = 0\n    self.interpolatedVelocityX = 0\n    self.interpolatedVelocityY = 0\n    self.interpolatedVelocityZ = 0\n\n    local playerYaw = self.player:getYaw()\n    self.yawInterpolator = InterpolatorAngle.new(playerYaw)\n\n    local playerSpeed = self.player:getSpeed()\n    self.speedInterpolator = InterpolatorValue.new(playerSpeed)\n\n    local playerVerticalVelocity = self.player.mover.currentVelocityY\n    self.verticalVelocityInterpolator = InterpolatorValue.new(playerVerticalVelocity)\n\n    self.directionX, self.directionZ = 0 , 0\n\n    self.targetPhysicsIndex = - 1\n\n    self.player.mover.onPositionTeleport:registerListener( PlayerPositionalInterpolator.onPlayerPositionTeleport, self )\n\n    -- Return the created instance.\n    return self\nend\n\n"})}),"\n",(0,o.jsx)(n.h3,{id:"settargetposition",children:"setTargetPosition"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Description"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"Sets the target position of the position interpolator to the given position."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Definition"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"setTargetPosition(float targetPositionX, float targetPositionY, float targetPositionZ)"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"float"}),(0,o.jsx)(n.th,{children:"targetPositionX"}),(0,o.jsx)(n.th,{children:"The target x position."})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"float"}),(0,o.jsx)(n.td,{children:"targetPositionY"}),(0,o.jsx)(n.td,{children:"The target y position."})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"float"}),(0,o.jsx)(n.td,{children:"targetPositionZ"}),(0,o.jsx)(n.td,{children:"The target z position."})]})]})]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Code"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-lua",children:'function PlayerPositionalInterpolator:setTargetPosition(targetPositionX, targetPositionY, targetPositionZ)\n    if not self.player.isOwner then\n        -- log("setTargetPosition", targetPositionX, targetPositionY, targetPositionZ)\n        -- printCallstack()\n    end\n    self.positionInterpolator:setTargetPosition(targetPositionX, targetPositionY, targetPositionZ)\nend\n\n'})}),"\n",(0,o.jsx)(n.h3,{id:"settargetyaw",children:"setTargetYaw"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Description"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"Sets the target yaw of the yaw interpolator to the given angle."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Definition"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"setTargetYaw(float targetYaw)"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n",(0,o.jsx)(n.table,{children:(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"float"}),(0,o.jsx)(n.th,{children:"targetYaw"}),(0,o.jsx)(n.th,{children:"The target rotation around the y axis."})]})})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Code"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-lua",children:"function PlayerPositionalInterpolator:setTargetYaw(targetYaw)\n    targetYaw = MathUtil.getValidLimit(targetYaw)\n    self.yawInterpolator:setTargetAngle(targetYaw)\nend\n\n"})}),"\n",(0,o.jsx)(n.h3,{id:"update",children:"update"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Description"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"Updates the node based on the interpolated state."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Definition"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"update(float dt)"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n",(0,o.jsx)(n.table,{children:(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"float"}),(0,o.jsx)(n.th,{children:"dt"}),(0,o.jsx)(n.th,{children:"Delta time in ms."})]})})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Code"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-lua",children:'function PlayerPositionalInterpolator:update(dt)\n    local deltaTime = g_physicsDtUnclamped\n    self.timeInterpolator:update(deltaTime)\n\n    local alpha = self.timeInterpolator:getAlpha()\n    local interpolatedPositionX, interpolatedPositionY, interpolatedPositionZ = self.positionInterpolator:getInterpolatedValues(alpha)\n    local interpolatedYaw = self.yawInterpolator:getInterpolatedValue(alpha)\n\n    local dirX = interpolatedPositionX - self.interpolatedPositionX\n    local dirZ = interpolatedPositionZ - self.interpolatedPositionZ\n    local distance = MathUtil.vector2Length(dirX, dirZ)\n\n    if not self.player.isOwner then\n        -- log(string.format(" Intp: %.4f %.4f | %.4f %.4f %.4f", alpha, distance, interpolatedPositionX, interpolatedPositionY, interpolatedPositionZ))\n    end\n\n    local speedXZ = 0\n    local speedY = 0\n    if distance > 0 then\n        dirX, dirZ = MathUtil.vector2Normalize(dirX, dirZ)\n        speedXZ = distance / deltaTime\n        speedY = (interpolatedPositionY - self.interpolatedPositionY) / deltaTime\n    end\n\n    self.interpolatedPositionX = interpolatedPositionX\n    self.interpolatedPositionY = interpolatedPositionY\n    self.interpolatedPositionZ = interpolatedPositionZ\n    self.interpolatedYaw = interpolatedYaw\n    self.interpolatedSpeed = speedXZ * 1000\n    self.interpolatedVelocityX = dirX * speedXZ\n    self.interpolatedVelocityZ = dirZ * speedXZ\n    self.interpolatedVelocityY = speedY\n\n    -- If this interpolator is targeting the root node, then it drives the position of the player.\n    -- Otherwise; the interpolator is targeting the graphical node and it will return the interpolated position via getGraphicalPosition.\n    if self.targetNodeType = = PlayerPositionalInterpolator.INTERPOLATION_TARGET_ENUM.ROOT_NODE then\n        self.player.mover:setPosition(interpolatedPositionX, interpolatedPositionY, interpolatedPositionZ)\n        self.player.mover:setMovementYaw(interpolatedYaw)\n        self.player.mover:setSpeed(speedXZ)\n        self.player.mover:setVelocity( self.interpolatedVelocityX, self.interpolatedVelocityZ, self.interpolatedVelocityZ)\n    end\nend\n\n'})}),"\n",(0,o.jsx)(n.h3,{id:"updatetick",children:"updateTick"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Description"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"Runs every tick (around 30 times a second) and handles preparing the state."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Definition"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"updateTick(float dt)"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n",(0,o.jsx)(n.table,{children:(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"float"}),(0,o.jsx)(n.th,{children:"dt"}),(0,o.jsx)(n.th,{children:"Delta time in ms."})]})})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Code"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-lua",children:"function PlayerPositionalInterpolator:updateTick(dt)\n    if self.targetNodeType = = PlayerPositionalInterpolator.INTERPOLATION_TARGET_ENUM.GRAPHICAL_NODE then\n        local interpolator = self.positionInterpolator\n\n        if self.targetPhysicsIndex > = 0 then\n            -- Get the player's root position.\n            local x, y, z = self.player.mover:getPosition()\n\n            if not self.player.isOwner and getIsPhysicsUpdateIndexSimulated( self.targetPhysicsIndex) then\n                self.targetPhysicsIndex = - 1\n            else\n                    -- Get the current target position of the interpolation.\n                    local targetPositionX = interpolator.targetPositionX\n                    local targetPositionY = interpolator.targetPositionY\n                    local targetPositionZ = interpolator.targetPositionZ\n\n                    -- Calculate the distance between the target position and current position, and determine if they are very close.\n                        local distanceX = math.abs(x - targetPositionX)\n                        local distanceY = math.abs(y - targetPositionY)\n                        local distanceZ = math.abs(z - targetPositionZ)\n                        local isVeryClose = distanceX < 0.001 and distanceY < 0.001 and distanceZ < 0.001\n\n                        -- If the position is close enough, prevent jittering by setting the target to it.\n                        if isVeryClose then\n                            x = targetPositionX\n                            y = targetPositionY\n                            z = targetPositionZ\n                        end\n                    end\n\n                    self:setTargetPosition(x, y, z)\n\n                    -- Start a new time phase.\n                    self.timeInterpolator:startNewPhase( 75 )\n\n                    -- Set the other parameters with the same logic, use the target if it is close enough.\n                        local playerYaw = self.player:getYaw()\n                        local targetYaw = self.yawInterpolator.targetValue\n                        self:setTargetYaw( math.abs(playerYaw - targetYaw) < 0.005 and targetYaw or playerYaw)\n                    end\n                end\n            end\n\n"})})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}}}]);