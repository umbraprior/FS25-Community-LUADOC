"use strict";(globalThis.webpackChunkfs25_community_luadoc=globalThis.webpackChunkfs25_community_luadoc||[]).push([[75903],{1612(e,n,i){i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>s,default:()=>h,frontMatter:()=>d,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"script/Specializations/WorkParticles","title":"WorkParticles","description":"WorkParticles","source":"@site/../docs/script/Specializations/WorkParticles.md","sourceDirName":"script/Specializations","slug":"/script/Specializations/WorkParticles","permalink":"/FS25-Community-LUADOC/script/Specializations/WorkParticles","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1767161192000,"frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"WorkMode","permalink":"/FS25-Community-LUADOC/script/Specializations/WorkMode"},"next":{"title":"PlayerOnFootStateMachine","permalink":"/FS25-Community-LUADOC/script/StateMachine/PlayerOnFootStateMachine"}}');var l=i(74848),t=i(28453);const d={},s=void 0,a={},o=[{value:"WorkParticles",id:"workparticles",level:2},{value:"getDoGroundManipulation",id:"getdogroundmanipulation",level:3},{value:"getFillTypeFromWorkAreaIndex",id:"getfilltypefromworkareaindex",level:3},{value:"groundParticleI3DLoaded",id:"groundparticlei3dloaded",level:3},{value:"initSpecialization",id:"initspecialization",level:3},{value:"loadGroundAnimationMapping",id:"loadgroundanimationmapping",level:3},{value:"loadGroundAnimations",id:"loadgroundanimations",level:3},{value:"loadGroundEffects",id:"loadgroundeffects",level:3},{value:"loadGroundParticleMapping",id:"loadgroundparticlemapping",level:3},{value:"loadGroundParticles",id:"loadgroundparticles",level:3},{value:"loadGroundReferenceNode",id:"loadgroundreferencenode",level:3},{value:"onDeactivate",id:"ondeactivate",level:3},{value:"onDelete",id:"ondelete",level:3},{value:"onGroundAnimationI3DLoaded",id:"ongroundanimationi3dloaded",level:3},{value:"onLoad",id:"onload",level:3},{value:"onUpdateTick",id:"onupdatetick",level:3},{value:"prerequisitesPresent",id:"prerequisitespresent",level:3},{value:"registerEventListeners",id:"registereventlisteners",level:3},{value:"registerFunctions",id:"registerfunctions",level:3},{value:"registerGroundAnimationMappingXMLPaths",id:"registergroundanimationmappingxmlpaths",level:3},{value:"registerGroundParticleMappingXMLPaths",id:"registergroundparticlemappingxmlpaths",level:3},{value:"registerOverwrittenFunctions",id:"registeroverwrittenfunctions",level:3},{value:"updateGroundReferenceNode",id:"updategroundreferencenode",level:3}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h2,{id:"workparticles",children:"WorkParticles"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"Specialization for adding various particles to vehicles while working"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Functions"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#getdogroundmanipulation",children:"getDoGroundManipulation"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#getfilltypefromworkareaindex",children:"getFillTypeFromWorkAreaIndex"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#groundparticlei3dloaded",children:"groundParticleI3DLoaded"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#initspecialization",children:"initSpecialization"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#loadgroundanimationmapping",children:"loadGroundAnimationMapping"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#loadgroundanimations",children:"loadGroundAnimations"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#loadgroundeffects",children:"loadGroundEffects"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#loadgroundparticlemapping",children:"loadGroundParticleMapping"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#loadgroundparticles",children:"loadGroundParticles"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#loadgroundreferencenode",children:"loadGroundReferenceNode"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#ondeactivate",children:"onDeactivate"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#ondelete",children:"onDelete"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#ongroundanimationi3dloaded",children:"onGroundAnimationI3DLoaded"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#onload",children:"onLoad"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#onupdatetick",children:"onUpdateTick"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#prerequisitespresent",children:"prerequisitesPresent"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#registereventlisteners",children:"registerEventListeners"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#registerfunctions",children:"registerFunctions"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#registergroundanimationmappingxmlpaths",children:"registerGroundAnimationMappingXMLPaths"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#registergroundparticlemappingxmlpaths",children:"registerGroundParticleMappingXMLPaths"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#registeroverwrittenfunctions",children:"registerOverwrittenFunctions"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#updategroundreferencenode",children:"updateGroundReferenceNode"})}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"getdogroundmanipulation",children:"getDoGroundManipulation"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Definition"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"getDoGroundManipulation()"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Code"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:"function WorkParticles:getDoGroundManipulation()\n    return true\nend\n\n"})}),"\n",(0,l.jsx)(n.h3,{id:"getfilltypefromworkareaindex",children:"getFillTypeFromWorkAreaIndex"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Definition"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"getFillTypeFromWorkAreaIndex()"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,l.jsx)(n.table,{children:(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"any"}),(0,l.jsx)(n.th,{children:"workAreaIndex"})]})})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Code"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:"function WorkParticles:getFillTypeFromWorkAreaIndex(workAreaIndex)\n    local fillType = FillType.UNKNOWN\n    local workArea = self:getWorkAreaByIndex(workAreaIndex)\n    if workArea ~ = nil then\n        if workArea.fillType ~ = nil then\n            fillType = workArea.fillType\n        elseif workArea.fruitType ~ = nil then\n                fillType = g_fruitTypeManager:getFruitTypeIndexByFillTypeIndex(workArea.fruitType)\n            end\n        end\n        return fillType\n    end\n\n"})}),"\n",(0,l.jsx)(n.h3,{id:"groundparticlei3dloaded",children:"groundParticleI3DLoaded"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Definition"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"groundParticleI3DLoaded()"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"any"}),(0,l.jsx)(n.th,{children:"i3dNode"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"failedReason"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"args"})]})]})]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Code"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'function WorkParticles:groundParticleI3DLoaded(i3dNode, failedReason, args)\n    local xmlFile = args.xmlFile\n    local key = args.key\n    local particle = args.particle\n    local filename = args.filename\n\n    local j = 0\n    while true do\n        local nodeBaseName = string.format(key .. ".node(%d)" , j)\n        if not xmlFile:hasProperty(nodeBaseName) then\n            break\n        end\n\n        local mapping = { }\n        if self:loadGroundParticleMapping(xmlFile, nodeBaseName, mapping, j, i3dNode) then\n            table.insert(particle.mappings, mapping)\n        end\n        j = j + 1\n    end\n\n    if i3dNode ~ = 0 then\n        -- link after loading to make sure all indices are correct\n        for _, mapping in ipairs(particle.mappings) do\n            link(mapping.node, mapping.particleNode)\n            ParticleUtil.loadParticleSystemFromNode(mapping.particleNode, mapping.particleSystem, false , true )\n        end\n\n        particle.filename = filename\n        delete(i3dNode)\n    end\nend\n\n'})}),"\n",(0,l.jsx)(n.h3,{id:"initspecialization",children:"initSpecialization"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"Called on specialization initializing"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Definition"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"initSpecialization()"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Code"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'function WorkParticles.initSpecialization()\n    local schema = Vehicle.xmlSchema\n    schema:setXMLSpecializationType( "WorkParticles" )\n\n    schema:register(XMLValueType.STRING, "vehicle.workParticles.particleAnimation(?)#file" , "External effect i3d file" )\n    schema:register(XMLValueType.FLOAT, "vehicle.workParticles.particleAnimation(?)#speedThreshold" , "Speed threshold" , 0 )\n    WorkParticles.registerGroundAnimationMappingXMLPaths(schema, "vehicle.workParticles.particleAnimation(?).node(?)" )\n\n    schema:register(XMLValueType.STRING, "vehicle.workParticles.particle(?)#file" , "External effect i3d file" )\n    WorkParticles.registerGroundParticleMappingXMLPaths(schema, "vehicle.workParticles.particle(?).node(?)" )\n\n    schema:register(XMLValueType.BOOL, "vehicle.workParticles#requireField" , "The effects require the vehicle to be on a field to work" , true )\n\n    EffectManager.registerEffectXMLPaths(schema, "vehicle.workParticles.effect(?)" )\n    schema:register(XMLValueType.FLOAT, "vehicle.workParticles.effect(?)#speedThreshold" , "Speed threshold" , 0.5 )\n    schema:register(XMLValueType.INT, "vehicle.workParticles.effect(?)#activeDirection" , "Active Direction(effect will be turned off wen in opposite direction)" , 1 )\n    schema:register(XMLValueType.INT, "vehicle.workParticles.effect(?)#workAreaIndex" , "Work area index" )\n    schema:register(XMLValueType.INT, "vehicle.workParticles.effect(?)#groundReferenceNodeIndex" , "Index of ground reference node" )\n    schema:register(XMLValueType.BOOL, "vehicle.workParticles.effect(?)#needsSetIsTurnedOn" , "Needs set is turned on" , false )\n\n    schema:register(XMLValueType.NODE_INDEX, GroundReference.GROUND_REFERENCE_XML_KEY .. "#depthNode" , "Depth node" )\n\n    schema:setXMLSpecializationType()\nend\n\n'})}),"\n",(0,l.jsx)(n.h3,{id:"loadgroundanimationmapping",children:"loadGroundAnimationMapping"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Definition"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"loadGroundAnimationMapping()"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"any"}),(0,l.jsx)(n.th,{children:"xmlFile"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"key"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"mapping"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"index"})]})]})]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Code"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'function WorkParticles:loadGroundAnimationMapping(xmlFile, key, mapping, index)\n    XMLUtil.checkDeprecatedXMLElements( self.xmlFile, key .. "#index" , key .. "#node" ) --FS17 to FS19\n    XMLUtil.checkDeprecatedXMLElements( self.xmlFile, key .. "#animMeshIndex" , key .. "#animMeshNode" ) --FS17 to FS19\n\n    local node = xmlFile:getValue(key .. "#node" , nil , self.components, self.i3dMappings)\n    if node = = nil then\n        Logging.xmlWarning( self.xmlFile, "Invalid node \'%s\' for \'%s\'" , getXMLString(xmlFile.handle, key .. "#node" ), key)\n            return false\n        end\n\n        local groundRefIndex = xmlFile:getValue(key .. "#refNodeIndex" )\n        if groundRefIndex = = nil or self:getGroundReferenceNodeFromIndex(groundRefIndex) = = nil then\n            Logging.xmlWarning( self.xmlFile, "Invalid refNodeIndex \'%s\' for \'%s\'" , xmlFile:getValue(key .. "#refNodeIndex" ), key)\n                return false\n            end\n\n            local animNode\n            local animMeshNode = xmlFile:getValue(key .. "#animMeshNode" )\n            if animMeshNode ~ = nil then\n                animNode = I3DUtil.indexToObject(node, animMeshNode, self.i3dMappings)\n                if animNode = = nil then\n                    Logging.xmlWarning( self.xmlFile, "Invalid animMesh node \'%s\' \'%s\'" , xmlFile:getValue(key .. "#animMeshNode" ), key)\n                    return false\n                end\n            else\n                    local materialType = xmlFile:getValue(key .. "#materialType" )\n                    local materialId = xmlFile:getValue(key .. "#materialId" , 1 )\n                    if materialType = = nil then\n                        Logging.xmlWarning( self.xmlFile, "Missing materialType in \'%s\'" , key)\n                        return false\n                    end\n\n                    animNode = node\n\n                    local material = g_materialManager:getBaseMaterialByName(materialType)\n                    if material ~ = nil then\n                        setMaterial(node, material, 0 )\n                    else\n                            Logging.xmlWarning( self.xmlFile, "Invalid materialType \'%s\' or materialId \'%s\' in \'%s\'" , materialType, materialId, key)\n                        end\n\n                        setVisibility(animNode, false )\n                    end\n\n                    mapping.node = node\n                    mapping.animNode = animNode\n                    mapping.groundRefNode = self:getGroundReferenceNodeFromIndex(groundRefIndex)\n                    mapping.lastDepth = 0\n                    mapping.speed = 0\n                    mapping.maxWorkDepth = xmlFile:getValue(key .. "#maxDepth" , - 0.1 )\n\n                    return true\n                end\n\n'})}),"\n",(0,l.jsx)(n.h3,{id:"loadgroundanimations",children:"loadGroundAnimations"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Definition"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"loadGroundAnimations()"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"any"}),(0,l.jsx)(n.th,{children:"xmlFile"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"key"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"animation"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"index"})]})]})]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Code"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'function WorkParticles:loadGroundAnimations(xmlFile, key, animation, index)\n    animation.speedThreshold = xmlFile:getValue(key .. "#speedThreshold" , 0 )\n\n    animation.mappings = { }\n    local j = 0\n    while true do\n        local nodeBaseName = string.format(key .. ".node(%d)" , j)\n        if not self.xmlFile:hasProperty(nodeBaseName) then\n            break\n        end\n\n        local mapping = { }\n        if self:loadGroundAnimationMapping(xmlFile, nodeBaseName, mapping, j) then\n            table.insert(animation.mappings, mapping)\n        end\n        j = j + 1\n    end\n\n    local filenameStr = self.xmlFile:getValue(key .. "#file" )\n    if filenameStr ~ = nil then\n        filenameStr = Utils.getFilename(filenameStr, self.baseDirectory)\n        local arguments = {\n        filename = filenameStr,\n        animation = animation\n        }\n        animation.sharedLoadRequestId = self:loadSubSharedI3DFile(filenameStr, false , false , self.onGroundAnimationI3DLoaded, self , arguments)\n    end\n\n    return true\nend\n\n'})}),"\n",(0,l.jsx)(n.h3,{id:"loadgroundeffects",children:"loadGroundEffects"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Definition"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"loadGroundEffects()"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"any"}),(0,l.jsx)(n.th,{children:"xmlFile"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"key"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"effect"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"index"})]})]})]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Code"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'function WorkParticles:loadGroundEffects(xmlFile, key, effect, index)\n    effect.speedThreshold = xmlFile:getValue(key .. "#speedThreshold" , 0.5 )\n    effect.activeDirection = xmlFile:getValue(key .. "#activeDirection" , 1 )\n    effect.workAreaIndex = xmlFile:getValue(key .. "#workAreaIndex" )\n    effect.groundReferenceNodeIndex = xmlFile:getValue(key .. "#groundReferenceNodeIndex" )\n    effect.needsSetIsTurnedOn = xmlFile:getValue(key .. "#needsSetIsTurnedOn" , false )\n    effect.effect = g_effectManager:loadEffect(xmlFile, key, self.components, self , self.i3dMappings)\n\n    return true\nend\n\n'})}),"\n",(0,l.jsx)(n.h3,{id:"loadgroundparticlemapping",children:"loadGroundParticleMapping"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Definition"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"loadGroundParticleMapping()"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"any"}),(0,l.jsx)(n.th,{children:"xmlFile"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"key"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"mapping"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"index"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"i3dNode"})]})]})]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Code"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'function WorkParticles:loadGroundParticleMapping(xmlFile, key, mapping, index, i3dNode)\n    XMLUtil.checkDeprecatedXMLElements( self.xmlFile, key .. "#index" , key .. "#node" ) --FS17 to FS19\n    XMLUtil.checkDeprecatedXMLElements( self.xmlFile, key .. "#particleIndex" , key .. "#particleNode" ) --FS17 to FS19\n\n    mapping.particleSystem = { }\n\n    local node = xmlFile:getValue(key .. "#node" , nil , self.components, self.i3dMappings)\n    if node = = nil then\n        Logging.xmlWarning( self.xmlFile, "Invalid node \'%s\' for \'%s\'" , xmlFile:getValue(key .. "#node" ), key)\n            return false\n        end\n\n        local groundRefIndex = xmlFile:getValue(key .. "#refNodeIndex" )\n        if groundRefIndex = = nil or self:getGroundReferenceNodeFromIndex(groundRefIndex) = = nil then\n            Logging.xmlWarning( self.xmlFile, "Invalid refNodeIndex \'%s\' for \'%s\'" , xmlFile:getValue(key .. "#refNodeIndex" ), key)\n                return false\n            end\n\n            local particleNode\n            local particleNodeIndex = xmlFile:getValue(key .. "#particleNode" )\n            if particleNodeIndex ~ = nil then\n                particleNode = I3DUtil.indexToObject(i3dNode, particleNodeIndex, self.i3dMappings)\n                if particleNode = = nil then\n                    Logging.xmlWarning( self.xmlFile, "Invalid particle node \'%s\' \'%s\'" , xmlFile:getValue(key .. "#particleNode" ), key)\n                    return false\n                end\n            else\n                    particleNode = node\n\n                    local particleType = xmlFile:getValue(key .. "#particleType" )\n                    if particleType = = nil then\n                        Logging.xmlWarning( self.xmlFile, "Missing particleType in \'%s\'" , key)\n                        return false\n                    end\n\n                    local fillTypeStr = xmlFile:getValue(key .. "#fillType" )\n                    local fillType = Utils.getNoNil(g_fillTypeManager:getFillTypeIndexByName(fillTypeStr), FillType.UNKNOWN)\n\n                    local particleSystem = g_particleSystemManager:getParticleSystem(particleType)\n                    if particleSystem ~ = nil then\n                        if fillType ~ = FillType.UNKNOWN then\n                            local material = g_materialManager:getParticleMaterial(fillType, particleType, 1 )\n                            if material ~ = nil then\n                                ParticleUtil.setMaterial(particleSystem, material)\n                            end\n                        end\n\n                        mapping.particleSystem = ParticleUtil.copyParticleSystem(xmlFile, key, particleSystem, node)\n                    else\n                            return false\n                        end\n                    end\n\n                    mapping.node = node\n                    mapping.particleNode = particleNode\n                    mapping.groundRefNode = self:getGroundReferenceNodeFromIndex(groundRefIndex)\n                    mapping.speedThreshold = xmlFile:getValue(key .. "#speedThreshold" , 0.5 )\n                    mapping.movingDirection = xmlFile:getValue(key .. "#movingDirection" )\n\n                    return true\n                end\n\n'})}),"\n",(0,l.jsx)(n.h3,{id:"loadgroundparticles",children:"loadGroundParticles"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Definition"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"loadGroundParticles()"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"any"}),(0,l.jsx)(n.th,{children:"xmlFile"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"key"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"particle"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"index"})]})]})]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Code"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'function WorkParticles:loadGroundParticles(xmlFile, key, particle, index)\n    particle.mappings = { }\n\n    local filename = xmlFile:getValue(key .. "#file" )\n    if filename ~ = nil then\n        filename = Utils.getFilename(filename, self.baseDirectory)\n        local arguments = {\n        xmlFile = xmlFile,\n        key = key,\n        particle = particle,\n        filename = filename\n        }\n        particle.sharedLoadRequestId = g_i3DManager:loadSharedI3DFileAsync(filename, false , false , self.groundParticleI3DLoaded, self , arguments)\n    else\n            local j = 0\n            while true do\n                local nodeBaseName = string.format(key .. ".node(%d)" , j)\n                if not xmlFile:hasProperty(nodeBaseName) then\n                    break\n                end\n\n                local mapping = { }\n                if self:loadGroundParticleMapping(xmlFile, nodeBaseName, mapping, j) then\n                    table.insert(particle.mappings, mapping)\n                end\n                j = j + 1\n            end\n        end\n\n        return true\n    end\n\n'})}),"\n",(0,l.jsx)(n.h3,{id:"loadgroundreferencenode",children:"loadGroundReferenceNode"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Definition"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"loadGroundReferenceNode()"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"any"}),(0,l.jsx)(n.th,{children:"superFunc"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"xmlFile"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"key"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"groundReferenceNode"})]})]})]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Code"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'function WorkParticles:loadGroundReferenceNode(superFunc, xmlFile, key, groundReferenceNode)\n    local returnValue = superFunc( self , xmlFile, key, groundReferenceNode)\n\n    if returnValue then\n        groundReferenceNode.depthNode = xmlFile:getValue(key .. "#depthNode" , nil , self.components, self.i3dMappings)\n        groundReferenceNode.movedDistance = 0\n        groundReferenceNode.depth = 0\n        groundReferenceNode.movingDirection = 0\n    end\n\n    return returnValue\nend\n\n'})}),"\n",(0,l.jsx)(n.h3,{id:"ondeactivate",children:"onDeactivate"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Definition"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"onDeactivate()"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Code"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:"function WorkParticles:onDeactivate()\n    local spec = self.spec_workParticles\n\n    for _,ps in pairs(spec.particles) do\n        for _, mapping in ipairs(ps.mappings) do\n            ParticleUtil.setEmittingState(mapping.particleSystem, false )\n        end\n    end\n    for _, animation in ipairs(spec.particleAnimations) do\n        for _, mapping in ipairs(animation.mappings) do\n            setVisibility(mapping.animNode, false )\n        end\n    end\nend\n\n"})}),"\n",(0,l.jsx)(n.h3,{id:"ondelete",children:"onDelete"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Definition"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"onDelete()"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Code"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:"function WorkParticles:onDelete()\n    local spec = self.spec_workParticles\n\n    if spec.particleAnimations ~ = nil then\n        for _, animation in ipairs(spec.particleAnimations) do\n            if animation.sharedLoadRequestId ~ = nil then\n                g_i3DManager:releaseSharedI3DFile(animation.sharedLoadRequestId)\n                animation.sharedLoadRequestId = nil\n            end\n        end\n    end\n\n    if spec.particles ~ = nil then\n        for _, ps in pairs(spec.particles) do\n            for _, mapping in ipairs(ps.mappings) do\n                ParticleUtil.deleteParticleSystem(mapping.particleSystem)\n            end\n\n            if ps.sharedLoadRequestId ~ = nil then\n                g_i3DManager:releaseSharedI3DFile(ps.sharedLoadRequestId)\n                ps.sharedLoadRequestId = nil\n            end\n        end\n    end\n\n    if spec.effects ~ = nil then\n        for _, effect in pairs(spec.effects) do\n            g_effectManager:deleteEffects(effect.effect)\n        end\n    end\nend\n\n"})}),"\n",(0,l.jsx)(n.h3,{id:"ongroundanimationi3dloaded",children:"onGroundAnimationI3DLoaded"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Definition"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"onGroundAnimationI3DLoaded()"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"any"}),(0,l.jsx)(n.th,{children:"i3dNode"})]})}),(0,l.jsx)(n.tbody,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"args"})]})})]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Code"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:"function WorkParticles:onGroundAnimationI3DLoaded(i3dNode, args)\n    if i3dNode ~ = 0 then\n        local animation = args.animation\n        -- link after loading to make sure all indices are correct\n        for _, mapping in ipairs(animation.mappings) do\n            link(mapping.node, mapping.animNode)\n            setVisibility(mapping.animNode, false )\n        end\n\n        animation.filename = args.filename\n        delete(i3dNode)\n    end\nend\n\n"})}),"\n",(0,l.jsx)(n.h3,{id:"onload",children:"onLoad"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Definition"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"onLoad()"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,l.jsx)(n.table,{children:(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"any"}),(0,l.jsx)(n.th,{children:"savegame"})]})})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Code"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'function WorkParticles:onLoad(savegame)\n    local spec = self.spec_workParticles\n\n    XMLUtil.checkDeprecatedXMLElements( self.xmlFile, "vehicle.groundParticleAnimations.groundParticleAnimation" , "vehicle.workParticles.particleAnimation" ) --FS17 to FS19\n    XMLUtil.checkDeprecatedXMLElements( self.xmlFile, "vehicle.groundParticleAnimations.groundParticle" , "vehicle.workParticles.particle" ) --FS17 to FS19\n\n    if self.isClient then\n        spec.requireField = self.xmlFile:getValue( "vehicle.workParticles#requireField" , true )\n\n        spec.particleAnimations = { }\n        local i = 0\n        while true do\n            local key = string.format( "vehicle.workParticles.particleAnimation(%d)" , i)\n            if not self.xmlFile:hasProperty(key) then\n                break\n            end\n\n            local animation = { }\n            if self:loadGroundAnimations( self.xmlFile, key, animation, i) then\n                table.insert(spec.particleAnimations, animation)\n            end\n\n            i = i + 1\n        end\n\n        spec.particles = { }\n        i = 0\n        while true do\n            local key = string.format( "vehicle.workParticles.particle(%d)" , i)\n            if not self.xmlFile:hasProperty(key) then\n                break\n            end\n\n            local particle = { }\n            if self:loadGroundParticles( self.xmlFile, key, particle, i) then\n                table.insert(spec.particles, particle)\n            end\n\n            i = i + 1\n        end\n\n        spec.effects = { }\n        i = 0\n        while true do\n            local key = string.format( "vehicle.workParticles.effect(%d)" , i)\n            if not self.xmlFile:hasProperty(key) then\n                break\n            end\n\n            local effect = { }\n            if self:loadGroundEffects( self.xmlFile, key, effect, i) then\n                table.insert(spec.effects, effect)\n            end\n\n            i = i + 1\n        end\n    end\n\n    if not self.isClient then\n        SpecializationUtil.removeEventListener( self , "onDelete" , WorkParticles )\n        SpecializationUtil.removeEventListener( self , "onUpdateTick" , WorkParticles )\n        SpecializationUtil.removeEventListener( self , "onDeactivate" , WorkParticles )\n    end\nend\n\n'})}),"\n",(0,l.jsx)(n.h3,{id:"onupdatetick",children:"onUpdateTick"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Definition"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"onUpdateTick()"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"any"}),(0,l.jsx)(n.th,{children:"dt"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"isActiveForInput"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"isActiveForInputIgnoreSelection"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"isSelected"})]})]})]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Code"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'function WorkParticles:onUpdateTick(dt, isActiveForInput, isActiveForInputIgnoreSelection, isSelected)\n    local spec = self.spec_workParticles\n\n    local isOnField = self.isOnField or not spec.requireField\n\n    --#profile RemoteProfiler.zoneBeginN("particleAnimations")\n    for _, animation in ipairs(spec.particleAnimations) do\n        for _, mapping in ipairs(animation.mappings) do\n            local refNode = mapping.groundRefNode\n            if refNode ~ = nil and refNode.depthNode ~ = nil then\n                local depth = math.clamp(refNode.depth / mapping.maxWorkDepth, 0 , 1 )\n                if not isOnField then\n                    depth = 0\n                end\n\n                depth = math.clamp( math.min(depth, mapping.lastDepth + refNode.movingDirection * (refNode.movedDistance / 0.5 )), 0 , 1 )\n                mapping.lastDepth = depth\n                mapping.speed = mapping.speed - (refNode.movedDistance * refNode.movingDirection)\n                setVisibility(mapping.animNode, depth > 0 )\n                setShaderParameter(mapping.animNode, "VertxoffsetVertexdeformMotionUVscale" , - 6 , depth, mapping.speed, 1.5 , false )\n            end\n        end\n    end\n    --#profile RemoteProfiler.zoneEnd()\n\n    --#profile RemoteProfiler.zoneBeginN("state")\n    local lastSpeed = self:getLastSpeed( true )\n    local enabled = self:getDoGroundManipulation() and isOnField\n    --#profile RemoteProfiler.zoneEnd()\n\n    --#profile RemoteProfiler.zoneBeginN("particles")\n    for _,ps in pairs(spec.particles) do\n        for _, mapping in ipairs(ps.mappings) do\n            local nodeEnabled = enabled\n            if nodeEnabled then\n                nodeEnabled = mapping.groundRefNode.isActive and lastSpeed > mapping.speedThreshold\n            end\n            if mapping.movingDirection ~ = nil then\n                nodeEnabled = nodeEnabled and mapping.movingDirection = = self.movingDirection\n            end\n            ParticleUtil.setEmittingState(mapping.particleSystem, nodeEnabled)\n        end\n    end\n    --#profile RemoteProfiler.zoneEnd()\n\n    --#profile RemoteProfiler.zoneBeginN("effects")\n    for _,effect in pairs(spec.effects) do\n        local state = enabled and lastSpeed > effect.speedThreshold\n\n        if effect.needsSetIsTurnedOn then\n            if self.getIsTurnedOn ~ = nil then\n                local turnedOn = self:getIsTurnedOn()\n                if self.getAttacherVehicle ~ = nil then\n                    local attacherVehicle = self:getAttacherVehicle()\n                    if attacherVehicle ~ = nil then\n                        if attacherVehicle.getIsTurnedOn ~ = nil then\n                            turnedOn = turnedOn or attacherVehicle:getIsTurnedOn()\n                        end\n                    end\n                end\n\n                state = state and turnedOn\n            end\n        end\n\n        local workArea = self:getWorkAreaByIndex(effect.workAreaIndex)\n        if workArea ~ = nil then\n            if workArea.requiresGroundContact then\n                state = state and workArea.groundReferenceNode ~ = nil and workArea.groundReferenceNode.isActive\n            end\n        end\n\n        if effect.groundReferenceNodeIndex ~ = nil and effect.groundReferenceNode = = nil then\n            effect.groundReferenceNode = self:getGroundReferenceNodeFromIndex(effect.groundReferenceNodeIndex)\n            if effect.groundReferenceNode = = nil then\n                Logging.warning( "Unknown ground reference node \'%s\' for WorkParticle effect!" , effect.groundReferenceNodeIndex)\n                    effect.groundReferenceNodeIndex = nil\n                end\n            end\n\n            if effect.groundReferenceNode ~ = nil then\n                state = state and effect.groundReferenceNode.isActive\n            end\n\n            -- ignore direction 0\n            state = state and( self.movingDirection ~ = - effect.activeDirection or self:getLastSpeed() < 0.5 )\n\n            if state then\n                local fillType = self:getFillTypeFromWorkAreaIndex(effect.workAreaIndex)\n                g_effectManager:setEffectTypeInfo(effect.effect, fillType)\n                g_effectManager:startEffects(effect.effect)\n            else\n                    g_effectManager:stopEffects(effect.effect)\n                end\n            end\n            --#profile RemoteProfiler.zoneEnd()\n        end\n\n'})}),"\n",(0,l.jsx)(n.h3,{id:"prerequisitespresent",children:"prerequisitesPresent"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Definition"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"prerequisitesPresent()"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,l.jsx)(n.table,{children:(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"any"}),(0,l.jsx)(n.th,{children:"specializations"})]})})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Code"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:"function WorkParticles.prerequisitesPresent(specializations)\n    return true\nend\n\n"})}),"\n",(0,l.jsx)(n.h3,{id:"registereventlisteners",children:"registerEventListeners"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Definition"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"registerEventListeners()"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,l.jsx)(n.table,{children:(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"any"}),(0,l.jsx)(n.th,{children:"vehicleType"})]})})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Code"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'function WorkParticles.registerEventListeners(vehicleType)\n    SpecializationUtil.registerEventListener(vehicleType, "onLoad" , WorkParticles )\n    SpecializationUtil.registerEventListener(vehicleType, "onDelete" , WorkParticles )\n    SpecializationUtil.registerEventListener(vehicleType, "onUpdateTick" , WorkParticles )\n    SpecializationUtil.registerEventListener(vehicleType, "onDeactivate" , WorkParticles )\nend\n\n'})}),"\n",(0,l.jsx)(n.h3,{id:"registerfunctions",children:"registerFunctions"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Definition"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"registerFunctions()"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,l.jsx)(n.table,{children:(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"any"}),(0,l.jsx)(n.th,{children:"vehicleType"})]})})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Code"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'function WorkParticles.registerFunctions(vehicleType)\n    SpecializationUtil.registerFunction(vehicleType, "getDoGroundManipulation" , WorkParticles.getDoGroundManipulation)\n    SpecializationUtil.registerFunction(vehicleType, "loadGroundAnimations" , WorkParticles.loadGroundAnimations)\n    SpecializationUtil.registerFunction(vehicleType, "onGroundAnimationI3DLoaded" , WorkParticles.onGroundAnimationI3DLoaded)\n    SpecializationUtil.registerFunction(vehicleType, "loadGroundAnimationMapping" , WorkParticles.loadGroundAnimationMapping)\n    SpecializationUtil.registerFunction(vehicleType, "loadGroundParticles" , WorkParticles.loadGroundParticles)\n    SpecializationUtil.registerFunction(vehicleType, "groundParticleI3DLoaded" , WorkParticles.groundParticleI3DLoaded)\n    SpecializationUtil.registerFunction(vehicleType, "loadGroundParticleMapping" , WorkParticles.loadGroundParticleMapping)\n    SpecializationUtil.registerFunction(vehicleType, "loadGroundEffects" , WorkParticles.loadGroundEffects)\n    SpecializationUtil.registerFunction(vehicleType, "getFillTypeFromWorkAreaIndex" , WorkParticles.getFillTypeFromWorkAreaIndex)\nend\n\n'})}),"\n",(0,l.jsx)(n.h3,{id:"registergroundanimationmappingxmlpaths",children:"registerGroundAnimationMappingXMLPaths"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Definition"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"registerGroundAnimationMappingXMLPaths()"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"any"}),(0,l.jsx)(n.th,{children:"schema"})]})}),(0,l.jsx)(n.tbody,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"key"})]})})]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Code"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'function WorkParticles.registerGroundAnimationMappingXMLPaths(schema, key)\n    schema:register(XMLValueType.NODE_INDEX, key .. "#node" , "Link node in vehicle" )\n    schema:register(XMLValueType.INT, key .. "#refNodeIndex" , "Ground reference node index" )\n    schema:register(XMLValueType.STRING, key .. "#animMeshNode" , "Animation mesh node in external file" )\n\n    schema:register(XMLValueType.STRING, key .. "#materialType" , "Material type name(If external file is not given)" )\n    schema:register(XMLValueType.INT, key .. "#materialId" , "Material index(If external file is not given)" , 1 )\n\n    schema:register(XMLValueType.FLOAT, key .. "#maxDepth" , "Max.depth" , - 0.1 )\nend\n\n'})}),"\n",(0,l.jsx)(n.h3,{id:"registergroundparticlemappingxmlpaths",children:"registerGroundParticleMappingXMLPaths"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Definition"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"registerGroundParticleMappingXMLPaths()"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"any"}),(0,l.jsx)(n.th,{children:"schema"})]})}),(0,l.jsx)(n.tbody,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"key"})]})})]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Code"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'function WorkParticles.registerGroundParticleMappingXMLPaths(schema, key)\n    schema:register(XMLValueType.NODE_INDEX, key .. "#node" , "Link node in vehicle" )\n    schema:register(XMLValueType.INT, key .. "#refNodeIndex" , "Ground reference node index" )\n    schema:register(XMLValueType.STRING, key .. "#particleNode" , "Particle node in external file" )\n\n    schema:register(XMLValueType.STRING, key .. "#particleType" , "Particle type name(If external file is not given)" )\n    schema:register(XMLValueType.STRING, key .. "#fillType" , "Fill type for particles(If external file is not given)" , "UNKNOWN" )\n\n        schema:register(XMLValueType.FLOAT, key .. "#speedThreshold" , "Speed threshold" , 0.5 )\n        schema:register(XMLValueType.INT, key .. "#movingDirection" , "Moving direction" )\n\n        ParticleUtil.registerParticleCopyXMLPaths(schema, key)\n    end\n\n'})}),"\n",(0,l.jsx)(n.h3,{id:"registeroverwrittenfunctions",children:"registerOverwrittenFunctions"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Definition"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"registerOverwrittenFunctions()"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,l.jsx)(n.table,{children:(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"any"}),(0,l.jsx)(n.th,{children:"vehicleType"})]})})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Code"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'function WorkParticles.registerOverwrittenFunctions(vehicleType)\n    SpecializationUtil.registerOverwrittenFunction(vehicleType, "loadGroundReferenceNode" , WorkParticles.loadGroundReferenceNode)\n    SpecializationUtil.registerOverwrittenFunction(vehicleType, "updateGroundReferenceNode" , WorkParticles.updateGroundReferenceNode)\nend\n\n'})}),"\n",(0,l.jsx)(n.h3,{id:"updategroundreferencenode",children:"updateGroundReferenceNode"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Definition"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"updateGroundReferenceNode()"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"any"}),(0,l.jsx)(n.th,{children:"superFunc"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"groundReferenceNode"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"x"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"y"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"z"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"terrainHeight"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"densityHeight"})]})]})]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Code"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:"function WorkParticles:updateGroundReferenceNode(superFunc, groundReferenceNode, x, y, z, terrainHeight, densityHeight)\n\n    superFunc( self , groundReferenceNode, x, y, z, terrainHeight, densityHeight)\n    if self.isClient and groundReferenceNode.depthNode ~ = nil then\n        local newX, newY, newZ = getWorldTranslation(groundReferenceNode.depthNode)\n        if groundReferenceNode.lastPosition = = nil then\n            groundReferenceNode.lastPosition = { newX, newY, newZ }\n        end\n        local dx, dy, dz = worldDirectionToLocal(groundReferenceNode.depthNode, newX - groundReferenceNode.lastPosition[ 1 ], newY - groundReferenceNode.lastPosition[ 2 ], newZ - groundReferenceNode.lastPosition[ 3 ])\n        groundReferenceNode.movingDirection = 0\n        if dz > 0.0001 then\n            groundReferenceNode.movingDirection = 1\n        elseif dz < - 0.0001 then\n                groundReferenceNode.movingDirection = - 1\n            end\n            groundReferenceNode.movedDistance = MathUtil.vector3Length(dx, dy, dz)\n            groundReferenceNode.lastPosition[ 1 ], groundReferenceNode.lastPosition[ 2 ], groundReferenceNode.lastPosition[ 3 ] = newX, newY, newZ\n            local terrainHeightDepthNode = getTerrainHeightAtWorldPos(g_terrainNode, newX, newY, newZ)\n            groundReferenceNode.depth = newY - terrainHeightDepthNode\n        end\n    end\n\n"})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}},28453(e,n,i){i.d(n,{R:()=>d,x:()=>s});var r=i(96540);const l={},t=r.createContext(l);function d(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:d(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);