"use strict";(globalThis.webpackChunkfs25_community_luadoc=globalThis.webpackChunkfs25_community_luadoc||[]).push([[62496],{28453(e,n,t){t.d(n,{R:()=>s,x:()=>i});var r=t(96540);const l={},d=r.createContext(l);function s(e){const n=r.useContext(d);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:s(e.components),r.createElement(d.Provider,{value:n},e.children)}},38452(e,n,t){t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>i,default:()=>c,frontMatter:()=>s,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"script/Sounds/SoundMixer","title":"SoundMixer","description":"SoundMixer","source":"@site/../docs/script/Sounds/SoundMixer.md","sourceDirName":"script/Sounds","slug":"/script/Sounds/SoundMixer","permalink":"/FS25-Community-LUADOC/script/Sounds/SoundMixer","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1767161192000,"frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"SoundManager","permalink":"/FS25-Community-LUADOC/script/Sounds/SoundManager"},"next":{"title":"SpecializationManager","permalink":"/FS25-Community-LUADOC/script/Specialization/SpecializationManager"}}');var l=t(74848),d=t(28453);const s={},i=void 0,o={},a=[{value:"SoundMixer",id:"soundmixer",level:2},{value:"addVolumeChangedListener",id:"addvolumechangedlistener",level:3},{value:"delete",id:"delete",level:3},{value:"loadFromXML",id:"loadfromxml",level:3},{value:"new",id:"new",level:3},{value:"onGameStateChanged",id:"ongamestatechanged",level:3},{value:"setAudioGroupVolumeFactor",id:"setaudiogroupvolumefactor",level:3},{value:"setMasterVolume",id:"setmastervolume",level:3},{value:"update",id:"update",level:3}];function u(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h2,{id:"soundmixer",children:"SoundMixer"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"This class handles the mixing of sounds depending on the game state"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Functions"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#addvolumechangedlistener",children:"addVolumeChangedListener"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#delete",children:"delete"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#loadfromxml",children:"loadFromXML"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#new",children:"new"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#ongamestatechanged",children:"onGameStateChanged"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#setaudiogroupvolumefactor",children:"setAudioGroupVolumeFactor"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#setmastervolume",children:"setMasterVolume"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#update",children:"update"})}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"addvolumechangedlistener",children:"addVolumeChangedListener"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Definition"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"addVolumeChangedListener()"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"any"}),(0,l.jsx)(n.th,{children:"audioGroupIndex"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"func"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"target"})]})]})]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Code"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:"function SoundMixer:addVolumeChangedListener(audioGroupIndex, func, target)\n    if self.volumeChangedListeners[audioGroupIndex] = = nil then\n        self.volumeChangedListeners[audioGroupIndex] = { }\n    end\n\n    -- TODO:this will not prevent duplicates, use target as key instead?\n    table.addElement( self.volumeChangedListeners[audioGroupIndex], { func = func, target = target } )\nend\n\n"})}),"\n",(0,l.jsx)(n.h3,{id:"delete",children:"delete"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Definition"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"delete()"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Code"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'function SoundMixer:delete()\n    g_messageCenter:unsubscribeAll( self )\n\n    removeConsoleCommand( "gsSoundMixerDebug" )\nend\n\n'})}),"\n",(0,l.jsx)(n.h3,{id:"loadfromxml",children:"loadFromXML"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"Load sound mixer settings from given xml filepath"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Definition"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"loadFromXML(string xmlFilepath)"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n",(0,l.jsx)(n.table,{children:(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"string"}),(0,l.jsx)(n.th,{children:"xmlFilepath"}),(0,l.jsx)(n.th,{children:"filepath of the sound mixer settings xml file"})]})})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Code"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'function SoundMixer:loadFromXML(xmlFilepath)\n    -- ensure all audio groups are initialized in case new ones were added in script\n    for _, groupIndex in pairs(AudioGroup.groups) do\n        self.volumeFactors[groupIndex] = self.volumeFactors[groupIndex] or 1\n        self.volumeChangedListeners[groupIndex] = self.volumeChangedListeners[groupIndex] or { }\n    end\n\n    local xmlFile = loadXMLFile( "soundMixerXML" , xmlFilepath) -- TODO:update to new xml wrapper + schema\n\n    if xmlFile ~ = nil and xmlFile ~ = 0 then\n\n        local i = 0\n        while true do\n            local gameStateKey = string.format( "soundMixer.gameState(%d)" , i)\n            if not hasXMLProperty(xmlFile, gameStateKey) then\n                break\n            end\n\n            local gameStateName = getXMLString(xmlFile, gameStateKey .. "#name" )\n            local gameStateIndex = g_gameStateManager:getGameStateIndexByName(gameStateName)\n            if gameStateIndex ~ = nil then\n                local gameState = { }\n\n                local j = 0\n                while true do\n                    local audioGroupKey = string.format( "%s.audioGroup(%d)" , gameStateKey, j)\n                    if not hasXMLProperty(xmlFile, audioGroupKey) then\n                        break\n                    end\n\n                    local name = getXMLString(xmlFile, audioGroupKey .. "#name" )\n                    local volume = getXMLFloat(xmlFile, audioGroupKey .. "#volume" ) or 1.0\n                    local fadeInDuration = (getXMLFloat(xmlFile, audioGroupKey .. "#fadeOutDuration" ) or 0.5 ) * 1000\n                    local fadeOutDuration = (getXMLFloat(xmlFile, audioGroupKey .. "#fadeOutDuration" ) or 0.5 ) * 1000\n                    local audioGroupIndex = AudioGroup.getAudioGroupIndexByName(name)\n\n                    if audioGroupIndex ~ = nil then\n                        gameState[audioGroupIndex] = { volume = volume, fadeInDuration = fadeInDuration, fadeOutDuration = fadeOutDuration }\n                    else\n                            Logging.xmlWarning(xmlFile, "Audio-Group \'%s\' in game state \'%s\' (%s) is not defined!" , name, gameStateName, gameStateKey)\n                        end\n\n                        j = j + 1\n                    end\n\n                    self.gameStates[gameStateIndex] = gameState\n                else\n                        Logging.xmlWarning(xmlFile, "Game-State \'%s\' is not defined for state \'%s\'!" , gameStateName, gameStateKey)\n                        end\n\n                        i = i + 1\n                    end\n\n                    delete(xmlFile)\n                end\n\n                -- initialize self.volumes for all AudioGroups\n                    local currentGameState = g_gameStateManager:getGameState()\n                    local gameStateAudioGroups = self.gameStates[currentGameState] or self.gameStates[GameState.LOADING] -- current game state might not be included in mixer config\n\n                    for _, groupIndex in ipairs(AudioGroup.groups) do\n                        local data = gameStateAudioGroups and gameStateAudioGroups[groupIndex]\n                        local volume = 0 -- (data and data.volume) or 1\n                        self.volumes[groupIndex] = volume\n                        setAudioGroupVolume(groupIndex, volume)\n                    end\n                end\n\n'})}),"\n",(0,l.jsx)(n.h3,{id:"new",children:"new"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"Creating sound node"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Definition"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"new()"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,l.jsx)(n.table,{children:(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"any"}),(0,l.jsx)(n.th,{children:"customMt"})]})})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Return Values"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"any"}),(0,l.jsx)(n.th,{children:"instance"}),(0,l.jsx)(n.th,{children:"instance of object"})]})}),(0,l.jsx)(n.tbody,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"group"}),(0,l.jsx)(n.td,{children:"audio group"})]})})]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Code"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'function SoundMixer.new(customMt)\n    local self = setmetatable( { } , customMt or SoundMixer _mt)\n\n    g_messageCenter:subscribe(MessageType.GAME_STATE_CHANGED, self.onGameStateChanged, self )\n\n    self.masterVolume = 1\n\n    self.gameStates = { } -- GameState -> AudioGroup -> float volume [0 .. 1]\n    self.volumes = { } -- AudioGroup -> float volume [0 .. 1]\n    self.volumeFactors = { } -- AudioGroup -> float volume [0 .. 1]\n    self.volumeChangedListeners = { } -- AudioGroup -> array {func, target}\n\n    for _, groupIndex in pairs(AudioGroup.groups) do\n        self.volumeFactors[groupIndex] = 1\n        self.volumeChangedListeners[groupIndex] = { }\n    end\n\n    addConsoleCommand( "gsSoundMixerDebug" , "Toggle sound mixer debug mode" , "consoleCommandToggleDebug" , self )\n\n    return self\nend\n\n'})}),"\n",(0,l.jsx)(n.h3,{id:"ongamestatechanged",children:"onGameStateChanged"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Definition"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"onGameStateChanged()"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"any"}),(0,l.jsx)(n.th,{children:"gameStateId"})]})}),(0,l.jsx)(n.tbody,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"oldGameState"})]})})]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Code"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'function SoundMixer:onGameStateChanged(gameStateId, oldGameState)\n    local gameState = self.gameStates[gameStateId]\n    if gameState ~ = nil then\n        self.isDirty = true\n        --#debug else\n            --#debug Logging.warning("No sound mixing settings for game state %s", gameStateId)\n            end\n        end\n\n'})}),"\n",(0,l.jsx)(n.h3,{id:"setaudiogroupvolumefactor",children:"setAudioGroupVolumeFactor"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Definition"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"setAudioGroupVolumeFactor()"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"any"}),(0,l.jsx)(n.th,{children:"audioGroupIndex"})]})}),(0,l.jsx)(n.tbody,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"any"}),(0,l.jsx)(n.td,{children:"factor"})]})})]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Code"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:"function SoundMixer:setAudioGroupVolumeFactor(audioGroupIndex, factor)\n    if audioGroupIndex ~ = nil and self.volumeFactors[audioGroupIndex] ~ = nil then\n        self.volumeFactors[audioGroupIndex] = factor\n        self.isDirty = true\n    end\nend\n\n"})}),"\n",(0,l.jsx)(n.h3,{id:"setmastervolume",children:"setMasterVolume"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Definition"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"setMasterVolume()"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,l.jsx)(n.table,{children:(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"any"}),(0,l.jsx)(n.th,{children:"masterVolume"})]})})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Code"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:"function SoundMixer:setMasterVolume(masterVolume)\n    self.masterVolume = masterVolume\n    setMasterVolume(masterVolume)\nend\n\n"})}),"\n",(0,l.jsx)(n.h3,{id:"update",children:"update"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Description"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Definition"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"update()"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,l.jsx)(n.table,{children:(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"any"}),(0,l.jsx)(n.th,{children:"dt"})]})})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Code"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:"function SoundMixer:update(dt)\n    if self.isDirty then\n        local gameStateIndex = g_gameStateManager:getGameState()\n        local gameState = self.gameStates[gameStateIndex]\n        if gameState ~ = nil then\n            local isDone = true\n            for audioGroupIndex, data in pairs(gameState) do\n                local currentVolume = self.volumes[audioGroupIndex]\n                local target = data.volume * self.volumeFactors[audioGroupIndex]\n                if currentVolume ~ = target then\n                    isDone = false\n\n                    local dir = 1\n                    local func = math.min\n                    local fadeDuration = data.fadeInDuration\n                    if currentVolume > target then\n                        dir = - 1\n                        func = math.max\n                        fadeDuration = data.fadeOutDuration\n                    end\n\n                    local changePerFrame = 1\n                    if fadeDuration > 0 then\n                        changePerFrame = dt / fadeDuration\n                    end\n\n                    currentVolume = func(currentVolume + dir * changePerFrame, target)\n                    setAudioGroupVolume(audioGroupIndex, currentVolume)\n\n                    self.volumes[audioGroupIndex] = currentVolume\n                    for _, listener in ipairs( self.volumeChangedListeners[audioGroupIndex]) do\n                        listener.func(listener.target, audioGroupIndex, currentVolume)\n                    end\n                end\n            end\n\n            if isDone then\n                self.isDirty = false\n            end\n        end\n    end\nend\n\n"})})]})}function c(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(u,{...e})}):u(e)}}}]);