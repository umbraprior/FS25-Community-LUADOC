"use strict";(globalThis.webpackChunkfs25_community_luadoc=globalThis.webpackChunkfs25_community_luadoc||[]).push([[19061],{28453(e,n,r){r.d(n,{R:()=>t,x:()=>s});var l=r(96540);const a={},i=l.createContext(a);function t(e){const n=l.useContext(i);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:t(e.components),l.createElement(i.Provider,{value:n},e.children)}},34947(e,n,r){r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>s,default:()=>h,frontMatter:()=>t,metadata:()=>l,toc:()=>d});const l=JSON.parse('{"id":"script/Specializations/Crawlers","title":"Crawlers","description":"Crawlers","source":"@site/../docs/script/Specializations/Crawlers.md","sourceDirName":"script/Specializations","slug":"/script/Specializations/Crawlers","permalink":"/FS25-Community-LUADOC/script/Specializations/Crawlers","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1767161192000,"frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"CrabSteering","permalink":"/FS25-Community-LUADOC/script/Specializations/CrabSteering"},"next":{"title":"CropRowAdjustedNodes","permalink":"/FS25-Community-LUADOC/script/Specializations/CropRowAdjustedNodes"}}');var a=r(74848),i=r(28453);const t={},s=void 0,o={},d=[{value:"Crawlers",id:"crawlers",level:2},{value:"getCrawlerWheelMovedDistance",id:"getcrawlerwheelmoveddistance",level:3},{value:"getShallowWaterParameters",id:"getshallowwaterparameters",level:3},{value:"initSpecialization",id:"initspecialization",level:3},{value:"loadCrawlerFromConfigFile",id:"loadcrawlerfromconfigfile",level:3},{value:"loadCrawlerFromXML",id:"loadcrawlerfromxml",level:3},{value:"onCrawlerI3DLoaded",id:"oncrawleri3dloaded",level:3},{value:"onDelete",id:"ondelete",level:3},{value:"onLoad",id:"onload",level:3},{value:"onLoadFinished",id:"onloadfinished",level:3},{value:"onUpdate",id:"onupdate",level:3},{value:"onWheelConfigurationChanged",id:"onwheelconfigurationchanged",level:3},{value:"prerequisitesPresent",id:"prerequisitespresent",level:3},{value:"registerEventListeners",id:"registereventlisteners",level:3},{value:"registerFunctions",id:"registerfunctions",level:3},{value:"registerOverwrittenFunctions",id:"registeroverwrittenfunctions",level:3},{value:"updateCrawler",id:"updatecrawler",level:3},{value:"validateWashableNode",id:"validatewashablenode",level:3}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h2,{id:"crawlers",children:"Crawlers"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Description"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"Specialization for crawlers and tracks with rotating and/or scrolling elements"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Functions"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#getcrawlerwheelmoveddistance",children:"getCrawlerWheelMovedDistance"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#getshallowwaterparameters",children:"getShallowWaterParameters"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#initspecialization",children:"initSpecialization"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#loadcrawlerfromconfigfile",children:"loadCrawlerFromConfigFile"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#loadcrawlerfromxml",children:"loadCrawlerFromXML"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#oncrawleri3dloaded",children:"onCrawlerI3DLoaded"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#ondelete",children:"onDelete"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#onload",children:"onLoad"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#onloadfinished",children:"onLoadFinished"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#onupdate",children:"onUpdate"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#onwheelconfigurationchanged",children:"onWheelConfigurationChanged"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#prerequisitespresent",children:"prerequisitesPresent"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#registereventlisteners",children:"registerEventListeners"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#registerfunctions",children:"registerFunctions"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#registeroverwrittenfunctions",children:"registerOverwrittenFunctions"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#updatecrawler",children:"updateCrawler"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#validatewashablenode",children:"validateWashableNode"})}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"getcrawlerwheelmoveddistance",children:"getCrawlerWheelMovedDistance"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Description"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"Returns min. rotation difference or moved distance from the crawler wheels that have ground contact"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Definition"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"getCrawlerWheelMovedDistance(table crawler, string lastName, boolean useOnlyRotation)"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"table"}),(0,a.jsx)(n.th,{children:"crawler"}),(0,a.jsx)(n.th,{children:"crawler"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"string"}),(0,a.jsx)(n.td,{children:"lastName"}),(0,a.jsx)(n.td,{children:"name of last variable"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"boolean"}),(0,a.jsx)(n.td,{children:"useOnlyRotation"}),(0,a.jsx)(n.td,{children:"if true only the rotation difference is returned, if false the moved distance is returned"})]})]})]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Return Values"})}),"\n\n\n\n\n\n\n\n\n",(0,a.jsx)(n.table,{children:(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"boolean"}),(0,a.jsx)(n.th,{children:"value"}),(0,a.jsx)(n.th,{children:"value"})]})})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Code"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-lua",children:"function Crawlers:getCrawlerWheelMovedDistance(crawler, lastName, useOnlyRotation)\n    local minMovedDistance = math.huge\n    local direction = 1\n\n    for i = 1 , #crawler.wheels do\n        local wheelData = crawler.wheels[i]\n        if wheelData.wheel.physics.contact ~ = WheelContactType.NONE or #crawler.wheels = = 1 then\n            local newX, _, _ = getRotation(wheelData.wheel.driveNode)\n            if wheelData[lastName] = = nil then\n                wheelData[lastName] = newX\n            end\n\n            local lastRotation = wheelData[lastName]\n\n            if newX - lastRotation < - math.pi then\n                lastRotation = lastRotation - 2 * math.pi\n            elseif newX - lastRotation > math.pi then\n                    lastRotation = lastRotation + 2 * math.pi\n                end\n\n                local distance = wheelData.wheel.physics.radius * (newX - lastRotation)\n                if math.abs(wheelData.wheel.physics.steeringAngle) > math.pi * 0.5 then\n                    distance = - distance\n                end\n\n                if useOnlyRotation then\n                    distance = newX - lastRotation\n                end\n\n                if distance < 0 then\n                    if distance > - minMovedDistance then\n                        minMovedDistance = - distance\n                        direction = - 1\n                    end\n                else\n                        if distance < minMovedDistance then\n                            minMovedDistance = distance\n                            direction = 1\n                        end\n                    end\n\n                    wheelData[lastName] = newX\n                end\n            end\n\n            if minMovedDistance ~ = math.huge then\n                return minMovedDistance * direction\n            end\n\n            return 0\n        end\n\n"})}),"\n",(0,a.jsx)(n.h3,{id:"getshallowwaterparameters",children:"getShallowWaterParameters"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Description"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Definition"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"getShallowWaterParameters()"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,a.jsx)(n.table,{children:(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"any"}),(0,a.jsx)(n.th,{children:"crawler"})]})})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Code"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-lua",children:"function Crawlers.getShallowWaterParameters(crawler)\n    local velocity = crawler.vehicle.lastSignedSpeed * 1000\n\n    local ox, oz = 0 , 0\n    -- add random factor if wheel is slipping\n        if crawler.wheel.physics ~ = nil then\n            local slip = crawler.wheel.physics.netInfo.slip\n            if slip > 0.1 then\n                ox, oz = math.random() * 2 - 1 * slip, math.random() * 2 - 1 * slip\n            end\n        end\n\n        -- if wheel is not slipping add random factor if it is moving\n            if ox = = 0 and math.abs(velocity) > 0.27 then\n                ox, oz = math.random() * 2 - 1 , math.random() * 2 - 1\n            end\n\n            local dx, _, dz = localDirectionToWorld(crawler.linkNode, 0 , 0 , 1 )\n            local yRot = MathUtil.getYRotationFromDirection(dx, dz)\n            dx, dz = dx * velocity, dz * velocity\n            return dx + ox, dz + oz, yRot\n        end\n\n"})}),"\n",(0,a.jsx)(n.h3,{id:"initspecialization",children:"initSpecialization"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Description"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Definition"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"initSpecialization()"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Code"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-lua",children:'function Crawlers.initSpecialization()\n    g_storeManager:addVRamUsageFunction( Crawlers.getVRamUsageFromXML)\n\n    local schema = Vehicle.xmlSchema\n    schema:setXMLSpecializationType( "Crawlers" )\n\n    local crawlerKey = "vehicle.wheels.wheelConfigurations.wheelConfiguration(?).crawlers.crawler(?)"\n\n    schema:register(XMLValueType.NODE_INDEX, crawlerKey .. "#linkNode" , "Link node" )\n    schema:register(XMLValueType.NODE_INDICES, crawlerKey .. "#linkWheelNodes" , "Back and front wheels which are used to link the crawler.Wheels are also used for speed reference." )\n        schema:register(XMLValueType.BOOL, crawlerKey .. "#isLeft" , "Is left crawler" , false )\n        schema:register(XMLValueType.FLOAT, crawlerKey .. "#trackWidth" , "Track width" , 1 )\n        schema:register(XMLValueType.BOOL, crawlerKey .. "#hasShallowWaterObstacle" , "Crawler has a shallow water obstacle between the defined wheels" )\n        schema:register(XMLValueType.STRING, crawlerKey .. "#filename" , "Crawler filename" )\n        schema:register(XMLValueType.VECTOR_TRANS, crawlerKey .. "#offset" , "Crawler position offset" )\n        schema:register(XMLValueType.INT, crawlerKey .. "#wheelIndex" , "Speed reference wheel index" )\n        schema:register(XMLValueType.VECTOR_N, crawlerKey .. "#wheelIndices" , "Multiple speed reference wheels.The average speed of the wheels WITH ground contact is used" )\n        schema:register(XMLValueType.NODE_INDICES, crawlerKey .. "#wheelNodes" , "Multiple speed reference wheels(defined by any node of the wheel).The average speed of the wheels WITH ground contact is used" )\n        schema:register(XMLValueType.NODE_INDEX, crawlerKey .. "#speedReferenceNode" , "Speed reference node" )\n        schema:register(XMLValueType.FLOAT, crawlerKey .. "#fieldDirtMultiplier" , "Field dirt multiplier" , 75 )\n        schema:register(XMLValueType.FLOAT, crawlerKey .. "#streetDirtMultiplier" , "Street dirt multiplier" , - 150 )\n        schema:register(XMLValueType.FLOAT, crawlerKey .. "#waterWetnessFactor" , "Factor for crawler wetness while driving in water" , 20 )\n            schema:register(XMLValueType.FLOAT, crawlerKey .. "#minDirtPercentage" , "Min.dirt while getting clean on non field ground" , 0.35 )\n                schema:register(XMLValueType.FLOAT, crawlerKey .. "#maxDirtOffset" , "Max.dirt amount offset to global dirt node" , 0.5 )\n                schema:register(XMLValueType.FLOAT, crawlerKey .. "#dirtColorChangeSpeed" , "Defines speed to change the dirt color(sec)" , 20 )\n                VehicleMaterial.registerXMLPaths(schema, crawlerKey .. ".rimMaterial" )\n\n                schema:setXMLSpecializationType()\n\n                local crawlerSchema = XMLSchema.new( "crawler" )\n                crawlerSchema:shareDelayedRegistrationFuncs(schema) -- share the same delayed registration funcs since we have AnimatedVehicle elements in crawler schema\n                crawlerSchema:register(XMLValueType.STRING, "crawler.file#name" , "Crawler i3d filename" )\n                crawlerSchema:register(XMLValueType.NODE_INDEX, "crawler.file#leftNode" , "Crawler left node in i3d" )\n                crawlerSchema:register(XMLValueType.NODE_INDEX, "crawler.file#rightNode" , "Crawler right node in i3d" )\n\n                crawlerSchema:register(XMLValueType.NODE_INDEX, "crawler.scrollerNodes.scrollerNode(?)#node" , "Scroller node" )\n                crawlerSchema:register(XMLValueType.FLOAT, "crawler.scrollerNodes.scrollerNode(?)#scrollSpeed" , "Scroll speed" , 1 )\n                crawlerSchema:register(XMLValueType.FLOAT, "crawler.scrollerNodes.scrollerNode(?)#scrollLength" , "Scroll length" , 1 )\n                crawlerSchema:register(XMLValueType.STRING, "crawler.scrollerNodes.scrollerNode(?)#shaderParameterName" , "Shader parameter name" , "offsetUV" )\n                crawlerSchema:register(XMLValueType.STRING, "crawler.scrollerNodes.scrollerNode(?)#shaderParameterNamePrev" , "Shader parameter name(Prev)" , "#shaderParameterName prefixed with \'prev\'" )\n                crawlerSchema:register(XMLValueType.INT, "crawler.scrollerNodes.scrollerNode(?)#shaderParameterComponent" , "Shader paramater component" , 1 )\n                crawlerSchema:register(XMLValueType.FLOAT, "crawler.scrollerNodes.scrollerNode(?)#maxSpeed" , "Max.speed in m/s" , "unlimited" )\n                crawlerSchema:register(XMLValueType.FLOAT, "crawler.scrollerNodes.scrollerNode(?)#isTrackPart" , "Is part of track(Track width is set as scale X)" )\n\n                crawlerSchema:register(XMLValueType.NODE_INDEX, "crawler.rotatingParts.rotatingPart(?)#node" , "Rotating node" )\n                crawlerSchema:register(XMLValueType.FLOAT, "crawler.rotatingParts.rotatingPart(?)#radius" , "Radius" )\n                crawlerSchema:register(XMLValueType.FLOAT, "crawler.rotatingParts.rotatingPart(?)#speedScale" , "Speed scale" )\n\n                crawlerSchema:register(XMLValueType.NODE_INDEX, "crawler.dirtNodes.dirtNode(?)#node" , "Nodes that act the same way as wheels and get dirty faster when on field.If not defined everything gets dirty faster." )\n\n                crawlerSchema:register(XMLValueType.BOOL, "crawler.animations.animation(?)#isLeft" , "Load for left crawler" , false )\n                    AnimatedVehicle.registerAnimationXMLPaths(crawlerSchema, "crawler.animations.animation(?)" )\n\n                    ObjectChangeUtil.registerObjectChangeSingleXMLPaths(crawlerSchema, "crawler" )\n\n                    Crawlers.xmlSchema = crawlerSchema\n                end\n\n'})}),"\n",(0,a.jsx)(n.h3,{id:"loadcrawlerfromconfigfile",children:"loadCrawlerFromConfigFile"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Description"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Definition"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"loadCrawlerFromConfigFile()"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"any"}),(0,a.jsx)(n.th,{children:"crawler"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"any"}),(0,a.jsx)(n.td,{children:"xmlFilename"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"any"}),(0,a.jsx)(n.td,{children:"linkNode"})]})]})]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Code"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-lua",children:'function Crawlers:loadCrawlerFromConfigFile(crawler, xmlFilename, linkNode)\n    xmlFilename = Utils.getFilename(xmlFilename, self.baseDirectory)\n    local xmlFile = XMLFile.load( "crawlerXml" , xmlFilename, Crawlers.xmlSchema)\n    if xmlFile ~ = nil then\n        local filename = xmlFile:getValue( "crawler.file#name" )\n        if filename ~ = nil then\n            local spec = self.spec_crawlers\n            spec.xmlLoadingHandles[xmlFile] = true\n\n            crawler.filename = Utils.getFilename(filename, self.baseDirectory)\n\n            local arguments = {\n            xmlFile = xmlFile,\n            crawler = crawler\n            }\n            local sharedLoadRequestId = self:loadSubSharedI3DFile(crawler.filename, false , false , self.onCrawlerI3DLoaded, self , arguments)\n            table.insert(spec.sharedLoadRequestIds, sharedLoadRequestId)\n        else\n                Logging.xmlWarning(xmlFile, "Failed to open crawler i3d file \'%s\' in \'%s\'" , filename, xmlFilename)\n                xmlFile:delete()\n            end\n        else\n                Logging.xmlWarning( self.xmlFile, "Failed to open crawler config file \'%s\'" , xmlFilename)\n            end\n        end\n\n'})}),"\n",(0,a.jsx)(n.h3,{id:"loadcrawlerfromxml",children:"loadCrawlerFromXML"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Description"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"Load crawlers from xml"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Definition"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"loadCrawlerFromXML(XMLFile xmlFile, )"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"XMLFile"}),(0,a.jsx)(n.th,{children:"xmlFile"}),(0,a.jsx)(n.th,{children:"XMLFile instance"})]})}),(0,a.jsx)(n.tbody,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"any"}),(0,a.jsx)(n.td,{children:"key"}),(0,a.jsx)(n.td,{})]})})]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Code"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-lua",children:'function Crawlers:loadCrawlerFromXML(xmlFile, key)\n    XMLUtil.checkDeprecatedXMLElements(xmlFile, key .. "#crawlerIndex" , "Moved to external crawler config file" ) -- FS17 to FS19\n    XMLUtil.checkDeprecatedXMLElements(xmlFile, key .. "#length" , "Moved to external crawler config file" ) -- FS17 to FS19\n    XMLUtil.checkDeprecatedXMLElements(xmlFile, key .. "#shaderParameterComponent" , "Moved to external crawler config file" ) -- FS17 to FS19\n    XMLUtil.checkDeprecatedXMLElements(xmlFile, key .. "#shaderParameterName" , "Moved to external crawler config file" ) -- FS17 to FS19\n    XMLUtil.checkDeprecatedXMLElements(xmlFile, key .. "#scrollLength" , "Moved to external crawler config file" ) -- FS17 to FS19\n    XMLUtil.checkDeprecatedXMLElements(xmlFile, key .. "#scrollSpeed" , "Moved to external crawler config file" ) -- FS17 to FS19\n    XMLUtil.checkDeprecatedXMLElements(xmlFile, key .. "#index" , "Moved to external crawler config file" ) -- FS17 to FS19\n    XMLUtil.checkDeprecatedXMLElements(xmlFile, key .. ".rotatingPart" , "Moved to external crawler config file" ) -- FS17 to FS19\n\n    local crawler = { }\n    crawler.vehicle = self\n    crawler.wheels = { }\n\n    XMLUtil.checkDeprecatedXMLElements(xmlFile, key .. "#linkIndex" , key .. "#linkNode" ) -- FS17 to FS19\n    local linkNode = xmlFile:getValue(key .. "#linkNode" , nil , self.components, self.i3dMappings)\n\n    local linkWheelNodes = xmlFile:getValue(key .. "#linkWheelNodes" , nil , self.components, self.i3dMappings, true )\n    if linkWheelNodes ~ = nil then\n        local numLinkWheelNodes = #linkWheelNodes\n        if numLinkWheelNodes = = 2 then\n            local backWheel = self:getWheelByWheelNode(linkWheelNodes[ 1 ])\n            local frontWheel = self:getWheelByWheelNode(linkWheelNodes[ 2 ])\n            if backWheel ~ = nil and frontWheel ~ = nil then\n                if linkNode = = nil then\n                    linkNode = createTransformGroup( "crawlerLinkNode" )\n                end\n\n                link(backWheel.repr, linkNode)\n                setWorldTranslation(linkNode, getWorldTranslation(backWheel.driveNode))\n                setWorldRotation(linkNode, getWorldRotation(backWheel.driveNode))\n\n                crawler.positionReferenceNode = backWheel.driveNode\n                crawler.referenceNode = frontWheel.driveNode\n                crawler.referenceFrame = backWheel.repr\n\n                -- if possible we use the first visual tire node as reference, as we might have a rimOffset\n                    -- delayed to first frame when all external wheels have been loaded\n                    crawler.positionReferenceWheel = backWheel\n                    crawler.referenceWheel = frontWheel\n\n                    table.insert(crawler.wheels, { wheel = backWheel } )\n                    table.insert(crawler.wheels, { wheel = frontWheel } )\n                else\n                        Logging.xmlWarning( self.xmlFile, "Unknown link wheel nodes found in \'%s\'" , key)\n                    end\n                elseif numLinkWheelNodes ~ = 0 then\n                        Logging.xmlWarning( self.xmlFile, "The \'linkWheelNodes\' attribute in crawlers requires exactly two nodes! \'%s\'" , key)\n                    end\n                end\n\n                if linkNode = = nil then\n                    Logging.xmlWarning( self.xmlFile, "Missing link node for crawler \'%s\'" , key)\n                        return\n                    end\n\n                    crawler.linkNode = linkNode\n                    crawler.isLeft = xmlFile:getValue(key .. "#isLeft" , false )\n                    crawler.trackWidth = xmlFile:getValue(key .. "#trackWidth" , 1 )\n\n                    crawler.translationOffset = xmlFile:getValue(key .. "#offset" , "0 0 0" , true )\n\n                    XMLUtil.checkDeprecatedXMLElements(xmlFile, key .. "#speedRefWheel" , key .. "#wheelIndex" ) -- FS17 to FS19\n                    local wheelIndex = xmlFile:getValue(key .. "#wheelIndex" )\n                    local wheelIndices = xmlFile:getValue(key .. "#wheelIndices" , nil , true )\n                    local wheelNodes = xmlFile:getValue(key .. "#wheelNodes" , nil , self.components, self.i3dMappings, true )\n                    if wheelIndex ~ = nil or wheelIndices ~ = nil or #wheelNodes > 0 then\n                        if wheelIndex ~ = nil then\n                            wheelIndices = wheelIndices or { }\n                            table.insert(wheelIndices, wheelIndex)\n                        end\n\n                        if wheelIndices ~ = nil then\n                            for _, wheelIndex in ipairs(wheelIndices) do\n                                local wheel = self:getWheelFromWheelIndex(wheelIndex)\n                                if wheel ~ = nil then\n                                    table.insert(crawler.wheels, { wheel = wheel } )\n                                end\n                            end\n                        end\n\n                        if wheelNodes ~ = nil then\n                            for _, wheelNode in ipairs(wheelNodes) do\n                                local wheel = self:getWheelByWheelNode(wheelNode)\n                                if wheel ~ = nil then\n                                    table.insert(crawler.wheels, { wheel = wheel } )\n                                end\n                            end\n                        end\n                    end\n\n                    local numWheels = #crawler.wheels\n                    if numWheels > 0 then\n                        local crawlerLength = 0\n                        for _, wheelData in ipairs(crawler.wheels) do\n                            for _, otherWheelData in ipairs(crawler.wheels) do\n                                if wheelData ~ = otherWheelData then\n                                    local distance = calcDistanceFrom(wheelData.wheel.driveNode, otherWheelData.wheel.driveNode)\n                                    crawlerLength = math.max(crawlerLength, distance)\n                                end\n                            end\n                        end\n\n                        for wheelIndex, wheelData in ipairs(crawler.wheels) do\n                            wheelData.wheel.syncContactState = true\n                            wheelData.wheel.transRatio = 1\n                            if wheelData.wheel.physics.showSteeringAngle = = nil then\n                                wheelData.wheel.physics.showSteeringAngle = false\n                            end\n\n                            local hasWaterEffects = false\n                            if numWheels > 1 then\n                                if wheelIndex = = 1 then\n                                    wheelData.wheel.effects.waterParticleDirection = - 1 -- back wheel\n                                    hasWaterEffects = true\n                                elseif wheelIndex = = 2 then\n                                        wheelData.wheel.effects.waterParticleDirection = 1 -- front wheel\n                                        hasWaterEffects = true\n                                    end\n\n                                    wheelData.wheel.effects.waterEffectReferenceRadius = math.min(crawlerLength * 0.5 , 1 )\n                                else\n                                        hasWaterEffects = true\n                                    end\n\n                                    if hasWaterEffects then\n                                        if wheelData.wheel.effects.hasWaterParticles = = nil then\n                                            wheelData.wheel.effects:addWaterEffectsToPhysicsData()\n                                        end\n                                    else\n                                            wheelData.wheel.effects:removeWaterEffects()\n                                        end\n\n                                        if not wheelData.wheel.physics.isSynchronized then\n                                            Logging.xmlWarning( self.xmlFile, "Wheel \'%s\' for crawler \'%s\' in not synchronized! It won\'t rotate on the client side." , getName(wheelData.wheel.repr), key)\n                                            end\n                                        end\n\n                                        crawler.wheel = crawler.wheels[ 1 ].wheel\n\n                                        crawler.hasShallowWaterObstacle = xmlFile:getValue(key .. "#hasShallowWaterObstacle" , true )\n                                        if crawler.hasShallowWaterObstacle and self.propertyState ~ = VehiclePropertyState.SHOP_CONFIG then -- avoid interference with water planes while in shop under the map\n                                            local minX, minY, minZ = math.huge, math.huge, math.huge\n                                            local maxX, maxY, maxZ = - math.huge, - math.huge, - math.huge\n\n                                            for _, wheelData in ipairs(crawler.wheels) do\n                                                local wheel = wheelData.wheel\n                                                local x1, y1, z1 = localToLocal(wheel.driveNode, linkNode, (wheel.physics.wheelShapeWidth * 0.5 ) + wheel.physics.wheelShapeWidthOffset, wheel.physics.radius, wheel.physics.radius)\n                                                local x2, y2, z2 = localToLocal(wheel.driveNode, linkNode, - ((wheel.physics.wheelShapeWidth * 0.5 ) - wheel.physics.wheelShapeWidthOffset), - wheel.physics.radius, - wheel.physics.radius)\n\n                                                minX, minY, minZ = math.min(minX, x1, x2), math.min(minY, y1, y2), math.min(minZ, z1, z2)\n                                                maxX, maxY, maxZ = math.max(maxX, x1, x2), math.max(maxY, y1, y2), math.max(maxZ, z1, z2)\n                                            end\n\n                                            local sizeX, sizeY, sizeZ = maxX - minX, maxY - minY, maxZ - minZ\n                                            local cx, cy, cz = (minX + maxX) * 0.5 , (minY + maxY) * 0.5 , (minZ + maxZ) * 0.5\n\n                                            crawler.shallowWaterObstacle = g_currentMission.shallowWaterSimulation:addObstacle(linkNode, sizeX, sizeY, sizeZ, Crawlers.getShallowWaterParameters, crawler, { cx, cy, cz } )\n                                        end\n                                    end\n\n                                    XMLUtil.checkDeprecatedXMLElements( self.xmlFile, self.configFileName, key .. "#speedRefNode" , key .. "#speedReferenceNode" ) -- FS17 to FS19\n                                    crawler.speedReferenceNode = xmlFile:getValue(key .. "#speedReferenceNode" , nil , self.components, self.i3dMappings)\n                                    crawler.movedDistance = 0\n\n                                    crawler.fieldDirtMultiplier = xmlFile:getValue(key .. "#fieldDirtMultiplier" , 75 )\n                                    crawler.streetDirtMultiplier = xmlFile:getValue(key .. "#streetDirtMultiplier" , - 150 )\n                                    crawler.waterWetnessFactor = xmlFile:getValue(key .. "#waterWetnessFactor" , 20 )\n                                    crawler.minDirtPercentage = xmlFile:getValue(key .. "#minDirtPercentage" , 0.35 )\n                                    crawler.maxDirtOffset = xmlFile:getValue(key .. "#maxDirtOffset" , 0.5 )\n                                    crawler.dirtColorChangeSpeed = 1 / (xmlFile:getValue(key .. "#dirtColorChangeSpeed" , 20 ) * 1000 )\n\n                                    local rimMaterial = VehicleMaterial.new( self.baseDirectory)\n                                    if rimMaterial:loadFromXML(xmlFile, key .. ".rimMaterial" , self.customEnvironment) then\n                                        crawler.rimMaterial = rimMaterial\n                                    end\n\n                                    local filename = xmlFile:getValue(key .. "#filename" )\n                                    self:loadCrawlerFromConfigFile(crawler, filename, linkNode)\n                                end\n\n'})}),"\n",(0,a.jsx)(n.h3,{id:"oncrawleri3dloaded",children:"onCrawlerI3DLoaded"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Description"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Definition"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"onCrawlerI3DLoaded()"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"any"}),(0,a.jsx)(n.th,{children:"i3dNode"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"any"}),(0,a.jsx)(n.td,{children:"failedReason"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"any"}),(0,a.jsx)(n.td,{children:"args"})]})]})]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Code"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-lua",children:'function Crawlers:onCrawlerI3DLoaded(i3dNode, failedReason, args)\n    local xmlFile = args.xmlFile\n    local crawler = args.crawler\n    local spec = self.spec_crawlers\n\n    if i3dNode ~ = 0 then\n        local leftRightKey = (crawler.isLeft and "leftNode" ) or "rightNode"\n        crawler.loadedCrawler = xmlFile:getValue( "crawler.file#" .. leftRightKey, nil , i3dNode)\n        if crawler.loadedCrawler ~ = nil then\n            link(crawler.linkNode, crawler.loadedCrawler)\n\n            if crawler.translationOffset ~ = nil then\n                setTranslation(crawler.loadedCrawler, unpack(crawler.translationOffset))\n            end\n\n            setRotation(crawler.loadedCrawler, 0 , 0 , 0 )\n\n            crawler.scrollerNodes = { }\n            local j = 0\n            while true do\n                local key = string.format( "crawler.scrollerNodes.scrollerNode(%d)" , j)\n                if not xmlFile:hasProperty(key) then\n                    break\n                end\n\n                local entry = { }\n                entry.node = xmlFile:getValue(key .. "#node" , nil , crawler.loadedCrawler)\n                if entry.node ~ = nil then\n                    entry.scrollSpeed = xmlFile:getValue(key .. "#scrollSpeed" , 1 )\n                    entry.scrollLength = xmlFile:getValue(key .. "#scrollLength" , 1 )\n                    entry.shaderParameterName = xmlFile:getValue(key .. "#shaderParameterName" , "offsetUV" )\n                    entry.shaderParameterNamePrev = xmlFile:getValue(key .. "#shaderParameterNamePrev" )\n                    if entry.shaderParameterNamePrev ~ = nil then\n                        if not getHasShaderParameter(entry.node, entry.shaderParameterNamePrev) then\n                            Logging.xmlWarning(xmlFile, "Node \'%s\' has no shader parameter \'%s\' (prev) for crawler node \'%s\'!" , getName(entry.node), entry.shaderParameterNamePrev, key)\n                                return\n                            end\n                        else\n                                local prevName = "prev" .. string.upper( string.sub(entry.shaderParameterName, 1 , 1 )) .. string.sub(entry.shaderParameterName, 2 ) -- uppercase first letter of parameter name\n                                if getHasShaderParameter(entry.node, prevName) then\n                                    entry.shaderParameterNamePrev = prevName\n                                end\n                            end\n\n                            entry.nodes = { }\n                            I3DUtil.getNodesByShaderParam(crawler.loadedCrawler, entry.shaderParameterName, entry.nodes)\n\n                            entry.shaderParameterComponent = xmlFile:getValue(key .. "#shaderParameterComponent" , 1 )\n                            entry.maxSpeed = xmlFile:getValue(key .. "#maxSpeed" , math.huge) / 1000\n                            entry.scrollPosition = 0\n\n                            if crawler.trackWidth ~ = 1 then\n                                if xmlFile:getValue(key .. "#isTrackPart" , true ) then\n                                    setScale(entry.node, crawler.trackWidth, 1 , 1 )\n                                end\n                            end\n\n                            table.insert(crawler.scrollerNodes, entry)\n                        end\n                        j = j + 1\n                    end\n\n                    crawler.rotatingParts = { }\n                    j = 0\n                    while true do\n                        local key = string.format( "crawler.rotatingParts.rotatingPart(%d)" , j)\n                        if not xmlFile:hasProperty(key) then\n                            break\n                        end\n\n                        local entry = { }\n                        entry.node = xmlFile:getValue(key .. "#node" , nil , crawler.loadedCrawler)\n                        if entry.node ~ = nil then\n                            entry.radius = xmlFile:getValue(key .. "#radius" )\n                            entry.speedScale = xmlFile:getValue(key .. "#speedScale" )\n                            if entry.speedScale = = nil and entry.radius ~ = nil then\n                                entry.speedScale = 1.0 / entry.radius\n                            end\n\n                            table.insert(crawler.rotatingParts, entry)\n                        end\n\n                        j = j + 1\n                    end\n\n                    crawler.hasDirtNodes = false\n                    crawler.dirtNodes = { }\n                    j = 0\n                    while true do\n                        local key = string.format( "crawler.dirtNodes.dirtNode(%d)" , j)\n                        if not xmlFile:hasProperty(key) then\n                            break\n                        end\n\n                        local node = xmlFile:getValue(key .. "#node" , nil , crawler.loadedCrawler)\n                        if node ~ = nil then\n                            crawler.dirtNodes[node] = node\n                            crawler.hasDirtNodes = true\n                        end\n\n                        j = j + 1\n                    end\n\n                    crawler.objectChanges = { }\n                    ObjectChangeUtil.loadObjectChangeFromXML(xmlFile, "crawler" , crawler.objectChanges, crawler.loadedCrawler, self )\n                    ObjectChangeUtil.setObjectChanges(crawler.objectChanges, true )\n\n                    local i = 0\n                    while true do\n                        local key = string.format( "crawler.animations.animation(%d)" , i)\n                        if not xmlFile:hasProperty(key) then\n                            break\n                        end\n\n                        if crawler.isLeft = = xmlFile:getValue(key .. "#isLeft" , false ) then\n                            local animation = { }\n                            if self:loadAnimation(xmlFile, key, animation, crawler.loadedCrawler) then\n                                self.spec_animatedVehicle.animations[animation.name] = animation\n                            end\n                        end\n\n                        i = i + 1\n                    end\n\n                    table.insert( self.spec_crawlers.crawlers, crawler)\n                end\n\n                delete(i3dNode)\n            else\n                    if not( self.isDeleted or self.isDeleting) then\n                        Logging.xmlWarning(xmlFile, "Failed to find crawler in i3d file \'%s\'" , crawler.filename)\n                    end\n                end\n\n                xmlFile:delete()\n                spec.xmlLoadingHandles[xmlFile] = nil\n            end\n\n'})}),"\n",(0,a.jsx)(n.h3,{id:"ondelete",children:"onDelete"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Description"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"Called on deleting"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Definition"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"onDelete()"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Code"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-lua",children:"function Crawlers:onDelete()\n    local spec = self.spec_crawlers\n    if spec.xmlLoadingHandles ~ = nil then\n        for xmlFile, _ in pairs(spec.xmlLoadingHandles) do\n            xmlFile:delete()\n        end\n        table.clear(spec.xmlLoadingHandles)\n    end\n\n    if spec.crawlers ~ = nil then\n        for _, crawler in pairs(spec.crawlers) do\n            if crawler.shallowWaterObstacle ~ = nil then\n                g_currentMission.shallowWaterSimulation:removeObstacle(crawler.shallowWaterObstacle)\n                crawler.shallowWaterObstacle = nil\n            end\n        end\n        table.clear(spec.crawlers)\n    end\n\n    if spec.sharedLoadRequestIds ~ = nil then\n        for _, sharedLoadRequestId in ipairs(spec.sharedLoadRequestIds) do\n            g_i3DManager:releaseSharedI3DFile(sharedLoadRequestId)\n        end\n        spec.sharedLoadRequestIds = nil\n    end\nend\n\n"})}),"\n",(0,a.jsx)(n.h3,{id:"onload",children:"onLoad"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Description"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"Called on loading"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Definition"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"onLoad(table savegame)"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n",(0,a.jsx)(n.table,{children:(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"table"}),(0,a.jsx)(n.th,{children:"savegame"}),(0,a.jsx)(n.th,{children:"savegame"})]})})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Code"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-lua",children:'function Crawlers:onLoad(savegame)\n    local spec = self.spec_crawlers\n\n    local wheelConfigId = Utils.getNoNil( self.configurations[ "wheel" ], 1 )\n    local wheelKey = string.format( "vehicle.wheels.wheelConfigurations.wheelConfiguration(%d)" , wheelConfigId - 1 )\n\n    spec.crawlers = { }\n    spec.sharedLoadRequestIds = { }\n    spec.xmlLoadingHandles = { }\n    self.xmlFile:iterate(wheelKey .. ".crawlers.crawler" , function (_, key)\n        self:loadCrawlerFromXML( self.xmlFile, key)\n    end )\nend\n\n'})}),"\n",(0,a.jsx)(n.h3,{id:"onloadfinished",children:"onLoadFinished"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Description"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"Called on loading"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Definition"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"onLoadFinished(table savegame)"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n",(0,a.jsx)(n.table,{children:(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"table"}),(0,a.jsx)(n.th,{children:"savegame"}),(0,a.jsx)(n.th,{children:"savegame"})]})})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Code"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-lua",children:'function Crawlers:onLoadFinished(savegame)\n    local spec = self.spec_crawlers\n    if #spec.crawlers = = 0 then\n        SpecializationUtil.removeEventListener( self , "onUpdate" , Crawlers )\n    else\n            for i, crawler in ipairs(spec.crawlers) do\n                if crawler.rimMaterial ~ = nil then\n                    crawler.rimMaterial:apply(crawler.loadedCrawler, "rim_inner_mat" )\n                    crawler.rimMaterial:apply(crawler.loadedCrawler, "rim_outer_mat" )\n                end\n\n                self:updateCrawler(crawler, 999 )\n            end\n        end\n    end\n\n'})}),"\n",(0,a.jsx)(n.h3,{id:"onupdate",children:"onUpdate"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Description"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"Called on update"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Definition"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"onUpdate(float dt, boolean isActive, boolean isActiveForInput, boolean isSelected)"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"float"}),(0,a.jsx)(n.th,{children:"dt"}),(0,a.jsx)(n.th,{children:"time since last call in ms"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"boolean"}),(0,a.jsx)(n.td,{children:"isActive"}),(0,a.jsx)(n.td,{children:"true if vehicle is active"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"boolean"}),(0,a.jsx)(n.td,{children:"isActiveForInput"}),(0,a.jsx)(n.td,{children:"true if vehicle is active for input"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"boolean"}),(0,a.jsx)(n.td,{children:"isSelected"}),(0,a.jsx)(n.td,{children:"true if vehicle is selected"})]})]})]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Code"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-lua",children:"function Crawlers:onUpdate(dt, isActiveForInput, isActiveForInputIgnoreSelection, isSelected)\n    local spec = self.spec_crawlers\n    local updateCrawlers = self.currentUpdateDistance < Crawlers.MAX_UPDATE_DISTANCE\n    for _, crawler in pairs(spec.crawlers) do\n        if updateCrawlers then\n            self:updateCrawler(crawler, dt)\n        elseif crawler.lastPosition ~ = nil then\n                crawler.lastPosition = nil\n            end\n        end\n    end\n\n"})}),"\n",(0,a.jsx)(n.h3,{id:"onwheelconfigurationchanged",children:"onWheelConfigurationChanged"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Description"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Definition"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"onWheelConfigurationChanged()"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Code"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-lua",children:"function Crawlers:onWheelConfigurationChanged()\n    local spec = self.spec_crawlers\n    for _, crawler in pairs(spec.crawlers) do\n        local washableNode = self:getWashableNodeByCustomIndex(crawler)\n        if washableNode ~ = nil then\n            self:setNodeDirtAmount(washableNode, 0 , true )\n        end\n    end\nend\n\n"})}),"\n",(0,a.jsx)(n.h3,{id:"prerequisitespresent",children:"prerequisitesPresent"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Description"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"Checks if all prerequisite specializations are loaded"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Definition"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"prerequisitesPresent(table specializations)"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n",(0,a.jsx)(n.table,{children:(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"table"}),(0,a.jsx)(n.th,{children:"specializations"}),(0,a.jsx)(n.th,{children:"specializations"})]})})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Return Values"})}),"\n\n\n\n\n\n\n\n\n",(0,a.jsx)(n.table,{children:(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"table"}),(0,a.jsx)(n.th,{children:"hasPrerequisite"}),(0,a.jsx)(n.th,{children:"true if all prerequisite specializations are loaded"})]})})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Code"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-lua",children:"function Crawlers.prerequisitesPresent(specializations)\n    return SpecializationUtil.hasSpecialization( Wheels , specializations)\nend\n\n"})}),"\n",(0,a.jsx)(n.h3,{id:"registereventlisteners",children:"registerEventListeners"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Description"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Definition"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"registerEventListeners()"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,a.jsx)(n.table,{children:(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"any"}),(0,a.jsx)(n.th,{children:"vehicleType"})]})})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Code"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-lua",children:'function Crawlers.registerEventListeners(vehicleType)\n    SpecializationUtil.registerEventListener(vehicleType, "onLoad" , Crawlers )\n    SpecializationUtil.registerEventListener(vehicleType, "onLoadFinished" , Crawlers )\n    SpecializationUtil.registerEventListener(vehicleType, "onDelete" , Crawlers )\n    SpecializationUtil.registerEventListener(vehicleType, "onUpdate" , Crawlers )\n    SpecializationUtil.registerEventListener(vehicleType, "onWheelConfigurationChanged" , Crawlers )\nend\n\n'})}),"\n",(0,a.jsx)(n.h3,{id:"registerfunctions",children:"registerFunctions"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Description"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Definition"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"registerFunctions()"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,a.jsx)(n.table,{children:(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"any"}),(0,a.jsx)(n.th,{children:"vehicleType"})]})})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Code"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-lua",children:'function Crawlers.registerFunctions(vehicleType)\n    SpecializationUtil.registerFunction(vehicleType, "updateCrawler" , Crawlers.updateCrawler)\n    SpecializationUtil.registerFunction(vehicleType, "loadCrawlerFromXML" , Crawlers.loadCrawlerFromXML)\n    SpecializationUtil.registerFunction(vehicleType, "loadCrawlerFromConfigFile" , Crawlers.loadCrawlerFromConfigFile)\n    SpecializationUtil.registerFunction(vehicleType, "onCrawlerI3DLoaded" , Crawlers.onCrawlerI3DLoaded)\n    SpecializationUtil.registerFunction(vehicleType, "getCrawlerWheelMovedDistance" , Crawlers.getCrawlerWheelMovedDistance)\nend\n\n'})}),"\n",(0,a.jsx)(n.h3,{id:"registeroverwrittenfunctions",children:"registerOverwrittenFunctions"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Description"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Definition"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"registerOverwrittenFunctions()"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,a.jsx)(n.table,{children:(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"any"}),(0,a.jsx)(n.th,{children:"vehicleType"})]})})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Code"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-lua",children:'function Crawlers.registerOverwrittenFunctions(vehicleType)\n    SpecializationUtil.registerOverwrittenFunction(vehicleType, "validateWashableNode" , Crawlers.validateWashableNode)\nend\n\n'})}),"\n",(0,a.jsx)(n.h3,{id:"updatecrawler",children:"updateCrawler"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Description"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Definition"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"updateCrawler()"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"any"}),(0,a.jsx)(n.th,{children:"crawler"})]})}),(0,a.jsx)(n.tbody,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"any"}),(0,a.jsx)(n.td,{children:"dt"})]})})]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Code"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-lua",children:'function Crawlers:updateCrawler(crawler, dt)\n    crawler.movedDistance = 0\n\n    --#profile RemoteProfiler.zoneBeginN("Crawlers-updateCrawler-updateLastPos")\n    if crawler.speedReferenceNode ~ = nil then\n        local newX, newY, newZ = getWorldTranslation(crawler.speedReferenceNode)\n        if crawler.lastPosition = = nil then\n            crawler.lastPosition = { newX, newY, newZ }\n        end\n        local dx, dy, dz = worldDirectionToLocal(crawler.speedReferenceNode, newX - crawler.lastPosition[ 1 ], newY - crawler.lastPosition[ 2 ], newZ - crawler.lastPosition[ 3 ])\n        local movingDirection = 0\n        if dz > 0.0001 then\n            movingDirection = 1\n        elseif dz < - 0.0001 then\n                movingDirection = - 1\n            end\n            crawler.movedDistance = MathUtil.vector3Length(dx, dy, dz) * movingDirection\n            crawler.lastPosition[ 1 ] = newX\n            crawler.lastPosition[ 2 ] = newY\n            crawler.lastPosition[ 3 ] = newZ\n        else\n                crawler.movedDistance = self:getCrawlerWheelMovedDistance(crawler, "lastRotationScroll" , false )\n            end\n            --#profile RemoteProfiler.zoneEnd()\n\n            --#profile RemoteProfiler.zoneBeginN("Crawlers-updateCrawler-updateShader")\n            for _, scrollerNode in pairs(crawler.scrollerNodes) do\n                local movedDistance = crawler.movedDistance * scrollerNode.scrollSpeed\n                local moveDirection = math.sign(movedDistance)\n                movedDistance = math.min( math.abs(movedDistance), scrollerNode.maxSpeed) * moveDirection\n                scrollerNode.scrollPosition = (scrollerNode.scrollPosition + movedDistance) % scrollerNode.scrollLength\n\n                for _, node in pairs(scrollerNode.nodes) do\n                    local x, y, z, w = getShaderParameter(node, scrollerNode.shaderParameterName)\n                    if scrollerNode.shaderParameterComponent = = 1 then\n                        x = scrollerNode.scrollPosition\n                    else\n                            y = scrollerNode.scrollPosition\n                        end\n\n                        if scrollerNode.shaderParameterNamePrev ~ = nil then\n                            g_animationManager:setPrevShaderParameter(node, scrollerNode.shaderParameterName, x, y, z, w, false , scrollerNode.shaderParameterNamePrev)\n                        else\n                                setShaderParameter(node, scrollerNode.shaderParameterName, x, y, z, w, false )\n                            end\n                        end\n                    end\n                    --#profile RemoteProfiler.zoneEnd()\n\n                    --#profile RemoteProfiler.zoneBeginN("Crawlers-updateCrawler-rotateNodes")\n                    local rotationDifference = self:getCrawlerWheelMovedDistance(crawler, "lastRotationRot" , true )\n                    for _, rotatingPart in pairs(crawler.rotatingParts) do\n                        if crawler.wheel ~ = nil and rotatingPart.speedScale = = nil then\n                            rotate(rotatingPart.node, rotationDifference, 0 , 0 )\n                        elseif rotatingPart.speedScale ~ = nil then\n                                rotate(rotatingPart.node, rotatingPart.speedScale * crawler.movedDistance, 0 , 0 )\n                            end\n                        end\n                        --#profile RemoteProfiler.zoneEnd()\n\n                        --#profile RemoteProfiler.zoneBeginN("Crawlers-updateCrawler-updateAlignment")\n                        if crawler.referenceNode ~ = nil then\n                            -- resolve the tires nodes on the first update, when the wheel mesh data has been loaded\n                            if crawler.positionReferenceWheel ~ = nil then\n                                crawler.positionReferenceNode = crawler.positionReferenceWheel:getFirstTireNode() or crawler.positionReferenceNode\n                                crawler.positionReferenceWheel = nil\n                            end\n                            if crawler.referenceWheel ~ = nil then\n                                crawler.referenceNode = crawler.referenceWheel:getFirstTireNode() or crawler.referenceNode\n                                crawler.referenceWheel = nil\n                            end\n\n                            if self.currentUpdateDistance < Crawlers.MAX_UPDATE_DISTANCE_ALIGNMENT then\n                                local x, y, z = getWorldTranslation(crawler.positionReferenceNode)\n                                local refX, refY, refZ = getWorldTranslation(crawler.referenceNode)\n\n                                local dx, dy, dz = MathUtil.vector3Normalize(refX - x, refY - y, refZ - z)\n                                local upX, upY, upZ = localDirectionToWorld(crawler.referenceFrame, 0 , 1 , 0 )\n\n                                setWorldTranslation(crawler.linkNode, x, y, z)\n                                setWorldDirection(crawler.linkNode, dx, dy, dz, upX, upY, upZ)\n                            end\n                        end\n                        --#profile RemoteProfiler.zoneEnd()\n                    end\n\n'})}),"\n",(0,a.jsx)(n.h3,{id:"validatewashablenode",children:"validateWashableNode"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Description"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Definition"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"validateWashableNode()"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"any"}),(0,a.jsx)(n.th,{children:"superFunc"})]})}),(0,a.jsx)(n.tbody,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"any"}),(0,a.jsx)(n.td,{children:"node"})]})})]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Code"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-lua",children:'function Crawlers:validateWashableNode(superFunc, node)\n    local spec = self.spec_crawlers\n    for _, crawler in pairs(spec.crawlers) do\n        if crawler.wheel ~ = nil then\n            local crawlerNodes = crawler.dirtNodes\n            if not crawler.hasDirtNodes then\n                I3DUtil.getNodesByShaderParam(crawler.loadedCrawler, "scratches_dirt_snow_wetness" , crawlerNodes)\n            end\n\n            if crawler.crawlerMudMeshes = = nil then\n                crawler.crawlerMudMeshes = { }\n                I3DUtil.getNodesByShaderParam(crawler.loadedCrawler, "mudAmount" , crawler.crawlerMudMeshes)\n            end\n\n            if crawlerNodes[node] ~ = nil then\n                local nodeData = { }\n                nodeData.wheel = crawler.wheel\n                nodeData.fieldDirtMultiplier = crawler.fieldDirtMultiplier\n                nodeData.streetDirtMultiplier = crawler.streetDirtMultiplier\n                nodeData.minDirtPercentage = crawler.minDirtPercentage\n                nodeData.maxDirtOffset = crawler.maxDirtOffset\n                nodeData.dirtColorChangeSpeed = crawler.dirtColorChangeSpeed\n                nodeData.waterWetnessFactor = crawler.waterWetnessFactor\n                nodeData.isSnowNode = true\n\n                nodeData.loadFromSavegameFunc = function (xmlFile, key)\n                    nodeData.wheel.physics.snowScale = xmlFile:getValue(key .. "#snowScale" , 0 )\n\n                    local defaultColor, snowColor = g_currentMission.environment:getDirtColors()\n                    local r, g, b = MathUtil.vector3ArrayLerp(defaultColor, snowColor, nodeData.wheel.physics.snowScale)\n                    local washableNode = self:getWashableNodeByCustomIndex(crawler)\n                    self:setNodeDirtColor(washableNode, r, g, b, true )\n                end\n                nodeData.saveToSavegameFunc = function (xmlFile, key)\n                    xmlFile:setValue(key .. "#snowScale" , nodeData.wheel.physics.snowScale)\n                end\n\n                return false , self.updateWheelDirtAmount, crawler, nodeData\n            end\n\n            if crawler.crawlerMudMeshes[node] ~ = nil then\n                local nodeData = { }\n                nodeData.wheel = crawler.wheel\n                nodeData.fieldDirtMultiplier = crawler.fieldDirtMultiplier\n                nodeData.streetDirtMultiplier = crawler.streetDirtMultiplier\n                nodeData.minDirtPercentage = crawler.minDirtPercentage\n                nodeData.maxDirtOffset = crawler.maxDirtOffset\n                nodeData.dirtColorChangeSpeed = crawler.dirtColorChangeSpeed\n                nodeData.waterWetnessFactor = crawler.waterWetnessFactor\n                nodeData.isSnowNode = true\n                nodeData.cleaningMultiplier = 4\n\n                return false , self.updateWheelMudAmount, crawler.crawlerMudMeshes, nodeData\n            end\n        end\n    end\n\n    return superFunc( self , node)\nend\n\n'})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}}}]);