"use strict";(globalThis.webpackChunkfs25_community_luadoc=globalThis.webpackChunkfs25_community_luadoc||[]).push([[51358],{28453(e,n,l){l.d(n,{R:()=>o,x:()=>r});var i=l(96540);const s={},t=i.createContext(s);function o(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(t.Provider,{value:n},e.children)}},79704(e,n,l){l.r(n),l.d(n,{assets:()=>h,contentTitle:()=>r,default:()=>c,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"script/Handtools/HandToolFlashlight","title":"HandToolFlashlight","description":"HandToolFlashlight","source":"@site/../docs/script/Handtools/HandToolFlashlight.md","sourceDirName":"script/Handtools","slug":"/script/Handtools/HandToolFlashlight","permalink":"/FS25-Community-LUADOC/script/Handtools/HandToolFlashlight","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1767161192000,"frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"HandToolChainsaw","permalink":"/FS25-Community-LUADOC/script/Handtools/HandToolChainsaw"},"next":{"title":"HandToolHPWLance","permalink":"/FS25-Community-LUADOC/script/Handtools/HandToolHPWLance"}}');var s=l(74848),t=l(28453);const o={},r=void 0,h={},d=[{value:"HandToolFlashlight",id:"handtoolflashlight",level:2},{value:"onDelete",id:"ondelete",level:3},{value:"onHeldEnd",id:"onheldend",level:3},{value:"onLoad",id:"onload",level:3},{value:"onUpdate",id:"onupdate",level:3},{value:"prerequisitesPresent",id:"prerequisitespresent",level:3},{value:"registerEventListeners",id:"registereventlisteners",level:3},{value:"registerFunctions",id:"registerfunctions",level:3},{value:"registerXMLPaths",id:"registerxmlpaths",level:3},{value:"setFlashlightIsActive",id:"setflashlightisactive",level:3},{value:"updateTransform",id:"updatetransform",level:3}];function a(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"handtoolflashlight",children:"HandToolFlashlight"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"The hand tool specialisation for hand tools that shine a light from a node."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Functions"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#ondelete",children:"onDelete"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#onheldend",children:"onHeldEnd"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#onload",children:"onLoad"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#onupdate",children:"onUpdate"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#prerequisitespresent",children:"prerequisitesPresent"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#registereventlisteners",children:"registerEventListeners"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#registerfunctions",children:"registerFunctions"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#registerxmlpaths",children:"registerXMLPaths"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#setflashlightisactive",children:"setFlashlightIsActive"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#updatetransform",children:"updateTransform"})}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"ondelete",children:"onDelete"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"onDelete()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function HandToolFlashlight:onDelete()\n    local spec = self.spec_flashlight\n    if spec.lightNode ~ = nil then\n        -- The light node comes with the i3d file, but is relinked to the root node, so must be manually deleted.\n        delete(spec.lightNode)\n        spec.lightNode = nil\n    end\n\n    g_soundManager:deleteSamples(spec.samples)\n\n    if spec.lightNodeParent ~ = nil then\n        delete(spec.lightNodeParent)\n        spec.lightNodeParent = nil\n    end\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"onheldend",children:"onHeldEnd"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"onHeldEnd()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function HandToolFlashlight:onHeldEnd()\n    self:setFlashlightIsActive( false , true )\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"onload",children:"onLoad"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"onLoad()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"xmlFile"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'function HandToolFlashlight:onLoad(xmlFile)\n    local spec = self.spec_flashlight\n\n    spec.isActive = false\n\n    self.isFlashlight = true\n\n    -- The light node.\n    spec.lightNode = xmlFile:getValue( "handTool.flashlight.light#node" , nil , self.components, self.i3dMappings)\n    spec.lightMeshNode = xmlFile:getValue( "handTool.flashlight.light#mesh" , nil , self.components, self.i3dMappings)\n    spec.lightNodeParent = getParent(spec.lightNode)\n    spec.lightNodeOffsetX, spec.lightNodeOffsetY, spec.lightNodeOffsetZ = getTranslation(spec.lightNode)\n    spec.lightNodeForwardX, spec.lightNodeForwardY, spec.lightNodeForwardZ = localDirectionToLocal(spec.lightNode, spec.lightNodeParent, 0 , 0 , 1 )\n\n    -- Link the light node to the root node, so that it does not get hidden with the main hand tool.\n    link(getRootNode(), spec.lightNode)\n\n    -- The parameters.\n    spec.distance = xmlFile:getValue( "handTool.flashlight.light#distance" , 100 )\n    spec.coneAngle = xmlFile:getValue( "handTool.flashlight.light#coneAngle" , 60 )\n    spec.color = Color.fromVector(xmlFile:getValue( "handTool.flashlight.light#color" , { 1 , 1 , 1 , 1 } , true ))\n    spec.dropOff = xmlFile:getValue( "handTool.flashlight.light#dropOff" , 5 )\n\n    if spec.lightNode = = nil then\n        Logging.xmlError(xmlFile, "Flashlight\'s light node could not be resolved!" )\n        return\n    end\n\n    -- Set the light parameters.\n    setLightRange(spec.lightNode, spec.distance)\n    setLightColor(spec.lightNode, spec.color.r, spec.color.g, spec.color.b)\n    setLightDropOff(spec.lightNode, spec.dropOff)\n    setLightConeAngle(spec.lightNode, spec.coneAngle)\n\n    local iesProfileFilename = xmlFile:getValue( "handTool.flashlight.light#iesProfile" )\n    if iesProfileFilename ~ = nil then\n        iesProfileFilename = Utils.getFilename(iesProfileFilename, self.baseDirectory)\n        setLightIESProfile(spec.lightNode, iesProfileFilename)\n    end\n\n    if self.isClient then\n        spec.samples = { }\n        spec.samples.toggle = g_soundManager:loadSampleFromXML(xmlFile, "handTool.flashlight.sounds" , "toggle" , self.baseDirectory, self.components, 1 , AudioGroup.VEHICLE, self.i3dMappings, self )\n    end\n\n    -- Start with the light off.\n    self:setFlashlightIsActive( false , true )\nend\n\n'})}),"\n",(0,s.jsx)(n.h3,{id:"onupdate",children:"onUpdate"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"onUpdate()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"dt"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function HandToolFlashlight:onUpdate(dt)\n    self:updateTransform( self:getIsHeld())\n    self:raiseActive()\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"prerequisitespresent",children:"prerequisitesPresent"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"prerequisitesPresent()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"specializations"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function HandToolFlashlight.prerequisitesPresent(specializations)\n    return true\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"registereventlisteners",children:"registerEventListeners"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"registerEventListeners()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"handToolType"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'function HandToolFlashlight.registerEventListeners(handToolType)\n    SpecializationUtil.registerEventListener(handToolType, "onLoad" , HandToolFlashlight )\n    SpecializationUtil.registerEventListener(handToolType, "onDelete" , HandToolFlashlight )\n    SpecializationUtil.registerEventListener(handToolType, "onUpdate" , HandToolFlashlight )\n    SpecializationUtil.registerEventListener(handToolType, "onHeldEnd" , HandToolFlashlight )\nend\n\n'})}),"\n",(0,s.jsx)(n.h3,{id:"registerfunctions",children:"registerFunctions"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"registerFunctions()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"handToolType"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'function HandToolFlashlight.registerFunctions(handToolType)\n    SpecializationUtil.registerFunction(handToolType, "setFlashlightIsActive" , HandToolFlashlight.setFlashlightIsActive)\n    SpecializationUtil.registerFunction(handToolType, "updateTransform" , HandToolFlashlight.updateTransform)\nend\n\n'})}),"\n",(0,s.jsx)(n.h3,{id:"registerxmlpaths",children:"registerXMLPaths"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"registerXMLPaths()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"xmlSchema"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'function HandToolFlashlight.registerXMLPaths(xmlSchema)\n    xmlSchema:setXMLSpecializationType( "HandToolFlashlight" )\n    xmlSchema:register(XMLValueType.NODE_INDEX, "handTool.flashlight.light#node" , "The light node on the flashlight" )\n    xmlSchema:register(XMLValueType.NODE_INDEX, "handTool.flashlight.light#mesh" , "The self illum mesh of the flashlight" )\n    xmlSchema:register(XMLValueType.FLOAT, "handTool.flashlight.light#distance" , "The distance of the light" )\n    xmlSchema:register(XMLValueType.ANGLE, "handTool.flashlight.light#coneAngle" , "The cone angle of the light" )\n    xmlSchema:register(XMLValueType.COLOR, "handTool.flashlight.light#color" , "The color of the light" )\n    xmlSchema:register(XMLValueType.FLOAT, "handTool.flashlight.light#dropOff" , "The drop off of the light" )\n    xmlSchema:register(XMLValueType.STRING, "handTool.flashlight.light#iesProfile" , "The IES Profile" )\n    SoundManager.registerSampleXMLPaths(xmlSchema, "handTool.flashlight.sounds" , "toggle" )\n    xmlSchema:setXMLSpecializationType()\nend\n\n'})}),"\n",(0,s.jsx)(n.h3,{id:"setflashlightisactive",children:"setFlashlightIsActive"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"setFlashlightIsActive()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"isActive"})]})}),(0,s.jsx)(n.tbody,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"any"}),(0,s.jsx)(n.td,{children:"noEventSend"})]})})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function HandToolFlashlight:setFlashlightIsActive(isActive, noEventSend)\n    local spec = self.spec_flashlight\n\n    local changed = spec.isActive ~ = isActive\n    spec.isActive = isActive\n\n    if spec.lightNode ~ = nil then\n        setVisibility(spec.lightNode, isActive)\n    end\n    if spec.lightMeshNode ~ = nil then\n        setVisibility(spec.lightMeshNode, isActive)\n    end\n\n    if changed and spec.samples ~ = nil then\n        if not g_soundManager:getIsSamplePlaying(spec.samples.toggle) then\n            g_soundManager:playSample(spec.samples.toggle)\n        end\n    end\n\n    FlashlightToggleLightEvent.sendEvent( self , spec.isActive, noEventSend)\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"updatetransform",children:"updateTransform"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"updateTransform()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"isHeld"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function HandToolFlashlight:updateTransform(isHeld)\n\n    local spec = self.spec_flashlight\n\n    -- If the flashlight is held, position the light so that it comes out of the tool model.\n    if isHeld then\n\n        -- Ensure the parent of the light node still exists.\n        if spec.lightNodeParent = = nil or not entityExists(spec.lightNodeParent) then\n            spec.lightNodeParent = nil\n            return\n        end\n\n        local worldPositionX, worldPositionY, worldPositionZ = localToWorld(spec.lightNodeParent, spec.lightNodeOffsetX, spec.lightNodeOffsetY, spec.lightNodeOffsetZ)\n        local worldForwardX, worldForwardY, worldForwardZ = localDirectionToLocal(spec.lightNodeParent, getRootNode(), spec.lightNodeForwardX, spec.lightNodeForwardY, spec.lightNodeForwardZ)\n\n        setWorldTranslation(spec.lightNode, worldPositionX, worldPositionY, worldPositionZ)\n        setDirection(spec.lightNode, worldForwardX, worldForwardY, worldForwardZ, 0 , 1 , 0 )\n        return\n    end\n\n    -- Get the carrying player.If there is none, do nothing more.\n        local player = self:getCarryingPlayer()\n        if player = = nil then\n            return\n        end\n\n        -- If the player has a camera and is in first person, position the light so that it follows the camera.\n        if player.camera ~ = nil and player.camera.isFirstPerson then\n            local cameraPositionX, cameraPositionY, cameraPositionZ = player.camera:getCameraPosition()\n            local cameraPitch, cameraYaw = player.camera:getRotation()\n\n            setWorldTranslation(spec.lightNode, cameraPositionX, cameraPositionY, cameraPositionZ)\n            setWorldRotation(spec.lightNode, - cameraPitch, MathUtil.getValidLimit(cameraYaw + math.pi), 0 )\n            return\n        end\n\n        local graphics = player.graphicsComponent\n        if graphics = = nil then\n            return\n        end\n\n        local model = graphics.model\n        -- If the player has no loaded model; do nothing.\n            if model = = nil or model.thirdPersonHeadNode = = nil or not entityExists(model.thirdPersonHeadNode) then\n                return\n            end\n\n            -- Position the light to point in the player's graphical direction, without pitch.\n            local yaw = graphics:getModelYaw()\n            local headPositionX, headPositionY, headPositionZ = localToWorld(model.thirdPersonHeadNode, 0 , - 0.2 , 0 )\n\n            setWorldTranslation(spec.lightNode, headPositionX, headPositionY, headPositionZ)\n            setWorldRotation(spec.lightNode, 0 , MathUtil.getValidLimit(yaw + math.pi), 0 )\n        end\n\n"})})]})}function c(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}}}]);