"use strict";(globalThis.webpackChunkfs25_community_luadoc=globalThis.webpackChunkfs25_community_luadoc||[]).push([[73857],{1818(e,n,i){i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>l,toc:()=>o});const l=JSON.parse('{"id":"script/Jobs/AIJobLoadAndDeliver","title":"AIJobLoadAndDeliver","description":"AIJobLoadAndDeliver","source":"@site/../docs/script/Jobs/AIJobLoadAndDeliver.md","sourceDirName":"script/Jobs","slug":"/script/Jobs/AIJobLoadAndDeliver","permalink":"/FS25-Community-LUADOC/script/Jobs/AIJobLoadAndDeliver","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1767161192000,"frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"AIJobGoTo","permalink":"/FS25-Community-LUADOC/script/Jobs/AIJobGoTo"},"next":{"title":"CharacterLine","permalink":"/FS25-Community-LUADOC/script/Materials/CharacterLine"}}');var t=i(74848),s=i(28453);const a={},r=void 0,d={},o=[{value:"AIJobLoadAndDeliver",id:"aijobloadanddeliver",level:2},{value:"applyCurrentState",id:"applycurrentstate",level:3},{value:"canContinueWork",id:"cancontinuework",level:3},{value:"getDescription",id:"getdescription",level:3},{value:"getIsAvailableForVehicle",id:"getisavailableforvehicle",level:3},{value:"getIsLooping",id:"getislooping",level:3},{value:"getIsStartable",id:"getisstartable",level:3},{value:"getIsStartErrorText",id:"getisstarterrortext",level:3},{value:"getNextTaskIndex",id:"getnexttaskindex",level:3},{value:"getStartTaskIndex",id:"getstarttaskindex",level:3},{value:"getTitle",id:"gettitle",level:3},{value:"new",id:"new",level:3},{value:"onParameterValueChanged",id:"onparametervaluechanged",level:3},{value:"setValues",id:"setvalues",level:3},{value:"start",id:"start",level:3},{value:"startTask",id:"starttask",level:3},{value:"stop",id:"stop",level:3},{value:"updateFillTypes",id:"updatefilltypes",level:3},{value:"validate",id:"validate",level:3}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"aijobloadanddeliver",children:"AIJobLoadAndDeliver"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Description"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"AIJobDeliver"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Parent"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"?version=script&category=54&class=546",children:"AIJob"})}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Functions"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#applycurrentstate",children:"applyCurrentState"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#cancontinuework",children:"canContinueWork"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#getdescription",children:"getDescription"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#getisavailableforvehicle",children:"getIsAvailableForVehicle"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#getislooping",children:"getIsLooping"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#getisstartable",children:"getIsStartable"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#getisstarterrortext",children:"getIsStartErrorText"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#getnexttaskindex",children:"getNextTaskIndex"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#getstarttaskindex",children:"getStartTaskIndex"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#gettitle",children:"getTitle"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#new",children:"new"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#onparametervaluechanged",children:"onParameterValueChanged"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#setvalues",children:"setValues"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#start",children:"start"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#starttask",children:"startTask"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#stop",children:"stop"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#updatefilltypes",children:"updateFillTypes"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#validate",children:"validate"})}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"applycurrentstate",children:"applyCurrentState"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Description"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Definition"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"applyCurrentState()"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"any"}),(0,t.jsx)(n.th,{children:"vehicle"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"any"}),(0,t.jsx)(n.td,{children:"mission"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"any"}),(0,t.jsx)(n.td,{children:"farmId"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"any"}),(0,t.jsx)(n.td,{children:"isDirectStart"})]})]})]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Code"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:"function AIJobLoadAndDeliver:applyCurrentState(vehicle, mission, farmId, isDirectStart)\n    AIJobLoadAndDeliver:superClass().applyCurrentState( self , vehicle, mission, farmId, isDirectStart)\n\n    self.vehicleParameter:setVehicle(vehicle)\n    self.loopingParameter:setIsLooping( true )\n\n    if vehicle.getLastJob ~ = nil then\n        local lastJob = vehicle:getLastJob()\n        if lastJob ~ = nil and lastJob:isa( AIJobLoadAndDeliver ) then\n            self.unloadingStationParameter:setUnloadingStation(lastJob.unloadingStationParameter:getUnloadingStation())\n            self.loadingStationParameter:setLoadingStation(lastJob.loadingStationParameter:getLoadingStation())\n            self.loopingParameter:setIsLooping(lastJob.loopingParameter:getIsLooping())\n        end\n    end\n\n    local unloadingStations = { }\n    for _, unloadingStation in pairs(g_currentMission.storageSystem:getUnloadingStations()) do\n        if g_currentMission.accessHandler:canPlayerAccess(unloadingStation) and unloadingStation:isa( UnloadingStation ) then\n            local fillTypes = unloadingStation:getAISupportedFillTypes()\n            if next(fillTypes) ~ = nil then\n                table.insert(unloadingStations, unloadingStation)\n            end\n        end\n    end\n    table.sort(unloadingStations, function (a, b) return a:getName() < b:getName() end )\n    self.unloadingStationParameter:setValidUnloadingStations(unloadingStations)\n\n    local loadingStations = { }\n    for _, loadingStation in pairs(g_currentMission.storageSystem:getLoadingStations()) do\n        if g_currentMission.accessHandler:canPlayerAccess(loadingStation) then\n            local fillTypes = loadingStation:getAISupportedFillTypes()\n            if next(fillTypes) ~ = nil then\n                table.insert(loadingStations, loadingStation)\n            end\n        end\n    end\n    table.sort(loadingStations, function (a, b) return a:getName() < b:getName() end )\n    self.loadingStationParameter:setValidLoadingStations(loadingStations)\n\n    local loadingStation = self.loadingStationParameter:getLoadingStation()\n    self:updateFillTypes(loadingStation)\nend\n\n"})}),"\n",(0,t.jsx)(n.h3,{id:"cancontinuework",children:"canContinueWork"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Description"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Definition"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"canContinueWork()"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Code"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:"function AIJobLoadAndDeliver:canContinueWork()\n    local vehicle = self.vehicleParameter:getVehicle()\n    if vehicle = = nil then\n        return false , AIMessageErrorVehicleDeleted.new()\n    end\n\n    local loadingStation = self.loadingStationParameter:getLoadingStation()\n    if loadingStation = = nil then\n        return false , AIMessageErrorLoadingStationDeleted.new()\n    end\n\n    local unloadingStation = self.unloadingStationParameter:getUnloadingStation()\n    if unloadingStation = = nil then\n        return false , AIMessageErrorUnloadingStationDeleted.new()\n    end\n\n    local fillTypeIndex = self.fillTypeParameter:getFillTypeIndex()\n    if unloadingStation:getFreeCapacity(fillTypeIndex, self.startedFarmId) < = 0 then\n        return false , AIMessageErrorUnloadingStationFull.new()\n    end\n\n    if self.currentTaskIndex = = self.loadingTask.taskIndex then\n        if loadingStation:getFillLevel(fillTypeIndex, self.startedFarmId) < = 0 then\n            local isEmpty = true\n            for _, loadingNodeInfo in ipairs( self.loadingNodeInfos) do\n                local loadingVehicle = loadingNodeInfo.vehicle\n                local fillUnitIndex = loadingNodeInfo.fillUnitIndex\n                if loadingVehicle:getFillUnitFillLevel(fillUnitIndex) > 0 and loadingVehicle:getFillUnitFillType(fillUnitIndex) = = fillTypeIndex then\n                    isEmpty = false\n                    break\n                end\n            end\n\n            if isEmpty then\n                return false , AIMessageSuccessSiloEmpty.new()\n            end\n        end\n    end\n\n    return true , nil\nend\n\n"})}),"\n",(0,t.jsx)(n.h3,{id:"getdescription",children:"getDescription"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Description"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Definition"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"getDescription()"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Code"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:'function AIJobLoadAndDeliver:getDescription()\n    local desc = AIJobLoadAndDeliver:superClass().getDescription( self )\n\n    local nextTask = self:getTaskByIndex( self.currentTaskIndex)\n    if nextTask = = self.driveToLoadingTask then\n        desc = desc .. " - " .. g_i18n:getText( "ai_taskDescriptionDriveToLoadingStation" )\n    elseif nextTask = = self.loadingTask then\n            desc = desc .. " - " .. g_i18n:getText( "ai_taskDescriptionLoading" )\n        elseif nextTask = = self.driveToUnloadingTask then\n                desc = desc .. " - " .. g_i18n:getText( "ai_taskDescriptionDriveToUnloadingStation" )\n            elseif nextTask = = self.dischargeTask then\n                    desc = desc .. " - " .. g_i18n:getText( "ai_taskDescriptionUnloading" )\n                end\n\n                return desc\n            end\n\n'})}),"\n",(0,t.jsx)(n.h3,{id:"getisavailableforvehicle",children:"getIsAvailableForVehicle"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Description"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Definition"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"getIsAvailableForVehicle()"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,t.jsx)(n.table,{children:(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"any"}),(0,t.jsx)(n.th,{children:"vehicle"})]})})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Code"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:"function AIJobLoadAndDeliver:getIsAvailableForVehicle(vehicle)\n    if vehicle.createAgent = = nil or vehicle.setAITarget = = nil or not vehicle:getCanStartAIVehicle() then\n        return false\n    end\n\n    if not vehicle:getIsAIJobSupported(ClassUtil.getClassNameByObject( self )) then\n        return false\n    end\n\n    local vehicles = vehicle:getChildVehicles()\n    for _, childVehicle in ipairs(vehicles) do\n        if childVehicle.getAIDischargeNodes ~ = nil then\n            local nodes = childVehicle:getAIDischargeNodes()\n            if next(nodes) ~ = nil then\n                return true\n            end\n        end\n    end\n\n    local foundDischargeNodes = false\n    if vehicle.getAIDischargeNodes ~ = nil then\n        local nodes = vehicle:getAIDischargeNodes()\n        if next(nodes) ~ = nil then\n            foundDischargeNodes = true\n        end\n    end\n\n    if not foundDischargeNodes then\n        vehicles = vehicle:getChildVehicles()\n        for _, childVehicle in ipairs(vehicles) do\n            if childVehicle.getAIDischargeNodes ~ = nil then\n                local nodes = childVehicle:getAIDischargeNodes()\n                if next(nodes) ~ = nil then\n                    foundDischargeNodes = true\n                    break\n                end\n            end\n        end\n    end\n\n    if not foundDischargeNodes then\n        return false\n    end\n\n    local foundLoadingNodes = false\n    if vehicle.getAIFillUnits ~ = nil then\n        local fillUnits = vehicle:getAIFillUnits()\n        if next(fillUnits) ~ = nil then\n            foundLoadingNodes = true\n        end\n    end\n\n    if not foundLoadingNodes then\n        vehicles = vehicle:getChildVehicles()\n        for _, childVehicle in ipairs(vehicles) do\n            if childVehicle.getAIFillUnits ~ = nil then\n                local fillUnits = childVehicle:getAIFillUnits()\n                if next(fillUnits) ~ = nil then\n                    foundLoadingNodes = true\n                    break\n                end\n            end\n        end\n    end\n\n    if not foundLoadingNodes then\n        return false\n    end\n\n    return true\nend\n\n"})}),"\n",(0,t.jsx)(n.h3,{id:"getislooping",children:"getIsLooping"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Description"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Definition"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"getIsLooping()"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Code"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:"function AIJobLoadAndDeliver:getIsLooping()\n    return self.loopingParameter:getIsLooping()\nend\n\n"})}),"\n",(0,t.jsx)(n.h3,{id:"getisstartable",children:"getIsStartable"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Description"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Definition"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"getIsStartable()"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,t.jsx)(n.table,{children:(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"any"}),(0,t.jsx)(n.th,{children:"connection"})]})})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Code"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:'function AIJobLoadAndDeliver:getIsStartable(connection)\n    if g_currentMission.aiSystem:getAILimitedReached() then\n        return false , AIJobLoadAndDeliver.START_ERROR_LIMIT_REACHED\n    end\n\n    local vehicle = self.vehicleParameter:getVehicle()\n    if vehicle = = nil then\n        return false , AIJobLoadAndDeliver.START_ERROR_VEHICLE_DELETED\n    end\n\n    if not g_currentMission:getHasPlayerPermission( "hireAssistant" , connection, vehicle:getOwnerFarmId()) then\n        return false , AIJobLoadAndDeliver.START_ERROR_NO_PERMISSION\n    end\n\n    if vehicle:getIsInUse(connection) then\n        return false , AIJobLoadAndDeliver.START_ERROR_VEHICLE_IN_USE\n    end\n\n    return true , AIJob.START_SUCCESS\nend\n\n'})}),"\n",(0,t.jsx)(n.h3,{id:"getisstarterrortext",children:"getIsStartErrorText"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Description"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Definition"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"getIsStartErrorText()"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,t.jsx)(n.table,{children:(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"any"}),(0,t.jsx)(n.th,{children:"state"})]})})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Code"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:'function AIJobLoadAndDeliver.getIsStartErrorText(state)\n    if state = = AIJobLoadAndDeliver.START_ERROR_LIMIT_REACHED then\n        return g_i18n:getText( "ai_startStateLimitReached" )\n    elseif state = = AIJobLoadAndDeliver.START_ERROR_VEHICLE_DELETED then\n            return g_i18n:getText( "ai_startStateVehicleDeleted" )\n        elseif state = = AIJobLoadAndDeliver.START_ERROR_NO_PERMISSION then\n                return g_i18n:getText( "ai_startStateNoPermission" )\n            elseif state = = AIJobLoadAndDeliver.START_ERROR_VEHICLE_IN_USE then\n                    return g_i18n:getText( "ai_startStateVehicleInUse" )\n                end\n\n                return g_i18n:getText( "ai_startStateSuccess" )\n            end\n\n'})}),"\n",(0,t.jsx)(n.h3,{id:"getnexttaskindex",children:"getNextTaskIndex"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Description"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Definition"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"getNextTaskIndex()"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,t.jsx)(n.table,{children:(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"any"}),(0,t.jsx)(n.th,{children:"isSkipTask"})]})})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Code"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:'function AIJobLoadAndDeliver:getNextTaskIndex(isSkipTask)\n    if self.currentTaskIndex = = self.driveToLoadingTask.taskIndex or self.currentTaskIndex = = self.loadingTask.taskIndex then\n        -- check if there are more loadingNodes that need loading\n            for _, loadingNodeInfo in ipairs( self.loadingNodeInfos) do\n                if loadingNodeInfo.isDirty then\n                    local vehicle = loadingNodeInfo.vehicle\n                    local fillUnitIndex = loadingNodeInfo.fillUnitIndex\n                    if vehicle:getFillUnitFillLevel(fillUnitIndex) = = 0 then\n                        self.loadingTask:setFillUnit(vehicle, fillUnitIndex, loadingNodeInfo.offsetZ)\n                        loadingNodeInfo.isDirty = false\n                        --#debug log("drive to loading next fillunit")\n                        return self.loadingTask.taskIndex\n                    end\n\n                    loadingNodeInfo.isDirty = false\n                end\n            end\n\n        elseif self.currentTaskIndex = = self.driveToUnloadingTask.taskIndex or self.currentTaskIndex = = self.dischargeTask.taskIndex then\n                local fillTypeIndex = self.fillTypeParameter:getFillTypeIndex()\n                for _, dischargeNodeInfo in ipairs( self.dischargeNodeInfos) do\n                    if dischargeNodeInfo.isDirty then\n                        local vehicle = dischargeNodeInfo.vehicle\n                        local fillUnitIndex = dischargeNodeInfo.dischargeNode.fillUnitIndex\n                        if vehicle:getFillUnitFillLevel(fillUnitIndex) > 1 and vehicle:getFillUnitFillType(fillUnitIndex) = = fillTypeIndex then\n                            self.dischargeTask:setDischargeNode(vehicle, dischargeNodeInfo.dischargeNode, dischargeNodeInfo.offsetZ)\n                            dischargeNodeInfo.isDirty = false\n                            --#debug log("drive to discharge next trailer")\n                            return self.dischargeTask.taskIndex\n                        end\n\n                        dischargeNodeInfo.isDirty = false\n                    end\n                end\n            end\n\n            local nextTaskIndex = AIJobLoadAndDeliver:superClass().getNextTaskIndex( self , isSkipTask)\n            --#debug log("AIJobLoadAndDeliver:getNextTaskIndex(): ", self.currentTaskIndex, "->", nextTaskIndex)\n            return nextTaskIndex\n        end\n\n'})}),"\n",(0,t.jsx)(n.h3,{id:"getstarttaskindex",children:"getStartTaskIndex"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Description"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Definition"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"getStartTaskIndex()"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Code"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:"function AIJobLoadAndDeliver:getStartTaskIndex()\n    local hasOneEmptyFillUnit = false\n    for _, loadingNodeInfo in ipairs( self.loadingNodeInfos) do\n        local vehicle = loadingNodeInfo.vehicle\n        local fillUnitIndex = loadingNodeInfo.fillUnitIndex\n        if vehicle:getFillUnitFillLevel(fillUnitIndex) = = 0 then\n            hasOneEmptyFillUnit = true\n            break\n        end\n    end\n\n    if not hasOneEmptyFillUnit then\n        return self.driveToUnloadingTask.taskIndex\n    end\n\n    return self.driveToLoadingTask.taskIndex\nend\n\n"})}),"\n",(0,t.jsx)(n.h3,{id:"gettitle",children:"getTitle"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Description"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Definition"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"getTitle()"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Code"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:'function AIJobLoadAndDeliver:getTitle()\n    local vehicle = self.vehicleParameter:getVehicle()\n    if vehicle ~ = nil then\n        return vehicle:getName()\n    end\n\n    return ""\nend\n\n'})}),"\n",(0,t.jsx)(n.h3,{id:"new",children:"new"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Description"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Definition"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"new()"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"any"}),(0,t.jsx)(n.th,{children:"isServer"})]})}),(0,t.jsx)(n.tbody,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"any"}),(0,t.jsx)(n.td,{children:"customMt"})]})})]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Code"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:'function AIJobLoadAndDeliver.new(isServer, customMt)\n    local self = AIJob.new(isServer, customMt or AIJobLoadAndDeliver _mt)\n\n    self.dischargeNodeInfos = { }\n    self.loadingNodeInfos = { }\n\n    self.driveToLoadingTask = AITaskDriveTo.new(isServer, self )\n    self.loadingTask = AITaskLoading.new(isServer, self )\n    self.driveToUnloadingTask = AITaskDriveTo.new(isServer, self )\n    self.dischargeTask = AITaskDischarge.new(isServer, self )\n\n    self:addTask( self.driveToLoadingTask)\n    self:addTask( self.loadingTask)\n    self:addTask( self.driveToUnloadingTask)\n    self:addTask( self.dischargeTask)\n\n    self.vehicleParameter = AIParameterVehicle.new()\n    self.unloadingStationParameter = AIParameterUnloadingStation.new()\n    self.loadingStationParameter = AIParameterLoadingStation.new()\n    self.fillTypeParameter = AIParameterFillType.new()\n    self.loopingParameter = AIParameterLooping.new()\n\n    self:addNamedParameter( "vehicle" , self.vehicleParameter)\n    self:addNamedParameter( "loadingStation" , self.loadingStationParameter)\n    self:addNamedParameter( "fillType" , self.fillTypeParameter)\n    self:addNamedParameter( "unloadingStation" , self.unloadingStationParameter)\n    self:addNamedParameter( "looping" , self.loopingParameter)\n\n    local vehicleGroup = AIParameterGroup.new(g_i18n:getText( "ai_parameterGroupTitleVehicle" ))\n    vehicleGroup:addParameter( self.vehicleParameter)\n\n    local loadTargetGroup = AIParameterGroup.new(g_i18n:getText( "ai_parameterGroupTitleLoadingStation" ))\n    loadTargetGroup:addParameter( self.loadingStationParameter)\n    loadTargetGroup:addParameter( self.fillTypeParameter)\n\n    local unloadTargetGroup = AIParameterGroup.new(g_i18n:getText( "ai_parameterGroupTitleUnloadingStation" ))\n    unloadTargetGroup:addParameter( self.unloadingStationParameter)\n\n    local loopingGroup = AIParameterGroup.new(g_i18n:getText( "ai_parameterGroupTitleLooping" ))\n    loopingGroup:addParameter( self.loopingParameter)\n\n    table.insert( self.groupedParameters, vehicleGroup)\n    table.insert( self.groupedParameters, loadTargetGroup)\n    table.insert( self.groupedParameters, unloadTargetGroup)\n    table.insert( self.groupedParameters, loopingGroup)\n\n    return self\nend\n\n'})}),"\n",(0,t.jsx)(n.h3,{id:"onparametervaluechanged",children:"onParameterValueChanged"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Description"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Definition"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"onParameterValueChanged()"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,t.jsx)(n.table,{children:(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"any"}),(0,t.jsx)(n.th,{children:"parameter"})]})})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Code"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:"function AIJobLoadAndDeliver:onParameterValueChanged(parameter)\n    if parameter = = self.loadingStationParameter then\n        local loadingStation = self.loadingStationParameter:getLoadingStation()\n        self:updateFillTypes(loadingStation)\n    end\nend\n\n"})}),"\n",(0,t.jsx)(n.h3,{id:"setvalues",children:"setValues"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Description"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Definition"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"setValues()"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Code"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:"function AIJobLoadAndDeliver:setValues()\n    self:resetTasks()\n\n    local vehicle = self.vehicleParameter:getVehicle()\n    if vehicle = = nil then\n        return\n    end\n    local loadingStation = self.loadingStationParameter:getLoadingStation()\n    if loadingStation = = nil then\n        return\n    end\n    local unloadingStation = self.unloadingStationParameter:getUnloadingStation()\n    if unloadingStation = = nil then\n        return\n    end\n    local fillTypeIndex = self.fillTypeParameter:getFillTypeIndex()\n\n    self.loadingTask:setVehicle(vehicle)\n    self.driveToUnloadingTask:setVehicle(vehicle)\n    self.driveToLoadingTask:setVehicle(vehicle)\n    self.dischargeTask:setVehicle(vehicle)\n\n    self.loadingNodeInfos = { }\n    self.dischargeNodeInfos = { }\n\n    if vehicle.getAIFillUnits ~ = nil then\n        for _, fillUnit in ipairs(vehicle:getAIFillUnits()) do\n            local fillUnitIndex = fillUnit.fillUnitIndex\n            local _, _, z = vehicle:getAILoadingNodeZAlignedOffset(fillUnitIndex, vehicle)\n            table.insert( self.loadingNodeInfos, { vehicle = vehicle, fillUnitIndex = fillUnitIndex, offsetZ = z, isDirty = true } )\n        end\n    end\n\n    if vehicle.getAIDischargeNodes ~ = nil then\n        for _, dischargeNode in ipairs(vehicle:getAIDischargeNodes()) do\n            local _, _, z = vehicle:getAIDischargeNodeZAlignedOffset(dischargeNode, vehicle)\n            table.insert( self.dischargeNodeInfos, { vehicle = vehicle, dischargeNode = dischargeNode, offsetZ = z, isDirty = true } )\n        end\n    end\n\n    local childVehicles = vehicle:getChildVehicles()\n    for _, childVehicle in ipairs(childVehicles) do\n        if childVehicle.getAIDischargeNodes ~ = nil then\n            for _, dischargeNode in ipairs(childVehicle:getAIDischargeNodes()) do\n                local _, _, z = childVehicle:getAIDischargeNodeZAlignedOffset(dischargeNode, vehicle)\n                table.insert( self.dischargeNodeInfos, { vehicle = childVehicle, dischargeNode = dischargeNode, offsetZ = z, isDirty = true } )\n            end\n        end\n\n        if childVehicle.getAIFillUnits ~ = nil then\n            for _, fillUnit in ipairs(childVehicle:getAIFillUnits()) do\n                local fillUnitIndex = fillUnit.fillUnitIndex\n                local _, _, z = childVehicle:getAILoadingNodeZAlignedOffset(fillUnitIndex, vehicle)\n                table.insert( self.loadingNodeInfos, { vehicle = childVehicle, fillUnitIndex = fillUnitIndex, offsetZ = z, isDirty = true } )\n            end\n        end\n    end\n\n    table.sort( self.dischargeNodeInfos, function (a, b)\n        return a.offsetZ > b.offsetZ\n    end )\n\n    table.sort( self.loadingNodeInfos, function (a, b)\n        return a.offsetZ > b.offsetZ\n    end )\n\n    local maxDischargeOffset = 0\n    if # self.dischargeNodeInfos > 0 then\n        maxDischargeOffset = self.dischargeNodeInfos[# self.dischargeNodeInfos].offsetZ\n    end\n    self.driveToUnloadingTask:setTargetOffset( - maxDischargeOffset)\n\n    local maxLoadingOffset = 0\n    if # self.loadingNodeInfos > 0 then\n        maxLoadingOffset = self.loadingNodeInfos[# self.loadingNodeInfos].offsetZ\n    end\n    self.driveToLoadingTask:setTargetOffset( - maxLoadingOffset)\n\n    if fillTypeIndex ~ = nil then\n        if loadingStation ~ = nil then\n            local x, z, dirX, dirZ, trigger = loadingStation:getAITargetPositionAndDirection(fillTypeIndex)\n            if trigger ~ = nil then\n                self.driveToLoadingTask:setTargetPosition(x, z)\n                self.driveToLoadingTask:setTargetDirection(dirX, dirZ)\n                self.loadingTask:setLoadTrigger(trigger)\n            end\n        end\n        if unloadingStation ~ = nil then\n            local x, z, dirX, dirZ, trigger = unloadingStation:getAITargetPositionAndDirection(fillTypeIndex)\n            if trigger ~ = nil then\n                self.driveToUnloadingTask:setTargetPosition(x, z)\n                self.driveToUnloadingTask:setTargetDirection(dirX, dirZ)\n                self.dischargeTask:setUnloadTrigger(trigger)\n            end\n        end\n\n        self.loadingTask:setFillType(fillTypeIndex)\n    end\nend\n\n"})}),"\n",(0,t.jsx)(n.h3,{id:"start",children:"start"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Description"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Definition"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"start()"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,t.jsx)(n.table,{children:(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"any"}),(0,t.jsx)(n.th,{children:"farmId"})]})})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Code"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:"function AIJobLoadAndDeliver:start(farmId)\n    -- Client start notification will be done by vehicle\n    AIJobLoadAndDeliver:superClass().start( self , farmId)\n\n    if self.isServer then\n        local vehicle = self.vehicleParameter:getVehicle()\n        vehicle:createAgent( self.helperIndex)\n        vehicle:aiJobStarted( self , self.helperIndex, farmId)\n    end\nend\n\n"})}),"\n",(0,t.jsx)(n.h3,{id:"starttask",children:"startTask"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Description"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Definition"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"startTask()"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,t.jsx)(n.table,{children:(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"any"}),(0,t.jsx)(n.th,{children:"task"})]})})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Code"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:"function AIJobLoadAndDeliver:startTask(task)\n    if task = = self.driveToLoadingTask then\n        -- mark all discharge infos as isDirty\n        for _, dischargeNodeInfo in ipairs( self.dischargeNodeInfos) do\n            dischargeNodeInfo.isDirty = true\n        end\n    elseif task = = self.driveToUnloadingTask then\n            -- mark all fillunit infos as isDirty\n            for _, loadingNodeInfo in ipairs( self.loadingNodeInfos) do\n                loadingNodeInfo.isDirty = true\n            end\n        end\n\n        AIJobLoadAndDeliver:superClass().startTask( self , task)\n    end\n\n"})}),"\n",(0,t.jsx)(n.h3,{id:"stop",children:"stop"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Description"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Definition"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"stop()"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,t.jsx)(n.table,{children:(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"any"}),(0,t.jsx)(n.th,{children:"aiMessage"})]})})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Code"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:"function AIJobLoadAndDeliver:stop(aiMessage)\n    -- Client stop notifcation will be done by vehicle\n    if self.isServer then\n        local vehicle = self.vehicleParameter:getVehicle()\n        vehicle:deleteAgent()\n        vehicle:aiJobFinished()\n    end\n\n    AIJobLoadAndDeliver:superClass().stop( self , aiMessage)\n\n    self.loadingNodeInfos = { }\n    self.dischargeNodeInfos = { }\nend\n\n"})}),"\n",(0,t.jsx)(n.h3,{id:"updatefilltypes",children:"updateFillTypes"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Description"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Definition"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"updateFillTypes()"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,t.jsx)(n.table,{children:(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"any"}),(0,t.jsx)(n.th,{children:"loadingStation"})]})})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Code"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:"function AIJobLoadAndDeliver:updateFillTypes(loadingStation)\n    local fillTypes = { }\n\n    if loadingStation ~ = nil then\n        for fillTypeIndex, _ in pairs(loadingStation:getAISupportedFillTypes()) do\n            fillTypes[fillTypeIndex] = loadingStation:getFillLevel(fillTypeIndex, g_localPlayer.farmId)\n        end\n    end\n\n    self.fillTypeParameter:setValidFillTypes(fillTypes)\nend\n\n"})}),"\n",(0,t.jsx)(n.h3,{id:"validate",children:"validate"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Description"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Definition"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"validate()"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,t.jsx)(n.table,{children:(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"any"}),(0,t.jsx)(n.th,{children:"farmId"})]})})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Code"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:'function AIJobLoadAndDeliver:validate(farmId)\n    self:setParameterValid( true )\n\n    local isVehicleValid, vehicleErrorMessage = self.vehicleParameter:validate()\n    if isVehicleValid then\n        if # self.dischargeNodeInfos = = 0 then\n            isVehicleValid = false\n            vehicleErrorMessage = g_i18n:getText( "ai_validationErrorNoAIDischargeNodesFound" )\n        elseif # self.loadingNodeInfos = = 0 then\n                isVehicleValid = false\n                vehicleErrorMessage = g_i18n:getText( "ai_validationErrorNoAILoadingNodesFound" )\n            end\n        end\n        if not isVehicleValid then\n            self.vehicleParameter:setIsValid( false )\n        end\n\n        local isFillTypeValid, fillTypeErrorMessage = self.fillTypeParameter:validate()\n        if not isFillTypeValid then\n            self.fillTypeParameter:setIsValid( false )\n        end\n\n        local fillTypeIndex = self.fillTypeParameter:getFillTypeIndex()\n\n        local isLoadingStationValid, loadingStationErrorMessage = self.loadingStationParameter:validate(fillTypeIndex, farmId)\n        if not isLoadingStationValid then\n            self.loadingStationParameter:setIsValid( false )\n        end\n\n        local isUnloadingStationValid, unloadingStationErrorMessage = self.unloadingStationParameter:validate(fillTypeIndex, farmId)\n        if not isUnloadingStationValid then\n            self.unloadingStationParameter:setIsValid( false )\n        end\n\n        local isValid = isVehicleValid and isFillTypeValid and isLoadingStationValid and isUnloadingStationValid\n        local errorMessage = vehicleErrorMessage or fillTypeErrorMessage or loadingStationErrorMessage or unloadingStationErrorMessage\n\n        return isValid, errorMessage\n    end\n\n'})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},28453(e,n,i){i.d(n,{R:()=>a,x:()=>r});var l=i(96540);const t={},s=l.createContext(t);function a(e){const n=l.useContext(s);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),l.createElement(s.Provider,{value:n},e.children)}}}]);