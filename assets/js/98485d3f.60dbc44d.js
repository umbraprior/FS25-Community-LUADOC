"use strict";(globalThis.webpackChunkfs25_community_luadoc=globalThis.webpackChunkfs25_community_luadoc||[]).push([[9432],{28453(e,n,t){t.d(n,{R:()=>l,x:()=>i});var r=t(96540);const o={},s=r.createContext(o);function l(e){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),r.createElement(s.Provider,{value:n},e.children)}},34053(e,n,t){t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>i,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"script/Networking/PlayerLocalNetworkComponent","title":"PlayerLocalNetworkComponent","description":"PlayerLocalNetworkComponent","source":"@site/../docs/script/Networking/PlayerLocalNetworkComponent.md","sourceDirName":"script/Networking","slug":"/script/Networking/PlayerLocalNetworkComponent","permalink":"/FS25-Community-LUADOC/script/Networking/PlayerLocalNetworkComponent","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1767161192000,"frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"MissionManager","permalink":"/FS25-Community-LUADOC/script/Missions/MissionManager"},"next":{"title":"PlayerNetworkComponent","permalink":"/FS25-Community-LUADOC/script/Networking/PlayerNetworkComponent"}}');var o=t(74848),s=t(28453);const l={},i=void 0,a={},c=[{value:"PlayerLocalNetworkComponent",id:"playerlocalnetworkcomponent",level:2},{value:"new",id:"new",level:3},{value:"readUpdateStream",id:"readupdatestream",level:3},{value:"update",id:"update",level:3},{value:"updateTick",id:"updatetick",level:3},{value:"writeUpdateStream",id:"writeupdatestream",level:3}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h2,{id:"playerlocalnetworkcomponent",children:"PlayerLocalNetworkComponent"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Description"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"A wrapped collection of historical inputs, positions, and states. Used to keep a history of the local gamestate for\nreconcilation purposes.\nThis only exists on clients, and only for the controlling player. It mainly non-instrusively gathers data from the\nplayer and network, and only makes changes to reconcile."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Parent"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"?version=script&category=61&class=568",children:"PlayerNetworkComponent"})}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Functions"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#new",children:"new"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#readupdatestream",children:"readUpdateStream"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#update",children:"update"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#updatetick",children:"updateTick"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#writeupdatestream",children:"writeUpdateStream"})}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"new",children:"new"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Description"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"Creates a new network history for the given player."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Definition"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"new(Player player)"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n",(0,o.jsx)(n.table,{children:(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Player"}),(0,o.jsx)(n.th,{children:"player"}),(0,o.jsx)(n.th,{children:"The player who owns this history."})]})})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Return Values"})}),"\n\n\n\n\n\n\n\n\n",(0,o.jsx)(n.table,{children:(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Player"}),(0,o.jsx)(n.th,{children:"instance"}),(0,o.jsx)(n.th,{children:"The created instance."})]})})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Code"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-lua",children:"function PlayerLocalNetworkComponent.new(player)\n    local self = PlayerNetworkComponent.new(player, PlayerLocalNetworkComponent _mt)\n\n    self.player = player\n\n    self.tickHistory = { }\n    self.currentTickIndex = 0\n\n    self.movementX = 0\n    self.movementY = 0\n    self.movementZ = 0\n    self.movementYaw = 0\n\n    return self\nend\n\n"})}),"\n",(0,o.jsx)(n.h3,{id:"readupdatestream",children:"readUpdateStream"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Description"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"Reads the positional data from the incoming network stream and reconciles any desync."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Definition"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"readUpdateStream(integer streamId, Connection connection, integer timestamp)"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"integer"}),(0,o.jsx)(n.th,{children:"streamId"}),(0,o.jsx)(n.th,{children:"The id of the stream from which to read."})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"Connection"}),(0,o.jsx)(n.td,{children:"connection"}),(0,o.jsx)(n.td,{children:"The connection between the server and the client."})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"integer"}),(0,o.jsx)(n.td,{children:"timestamp"}),(0,o.jsx)(n.td,{children:"The current timestamp for synchronisation purposes."})]})]})]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Code"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-lua",children:"function PlayerLocalNetworkComponent:readUpdateStream(streamId, connection, timestamp)\n    PlayerLocalNetworkComponent:superClass().readUpdateStream( self , streamId, connection, timestamp)\n\n    -- read the data that the PlayerServerNetworkComponent sends to target players\n    local tickIndex = streamReadUInt32(streamId)\n\n    local isControlled = streamReadBool(streamId)\n    local skipModel = streamReadBool(streamId)\n    local skipMover = streamReadBool(streamId)\n    self.player:updateControlledState(isControlled, skipModel, skipMover)\n\n    local receivedPositionX = streamReadFloat32(streamId)\n    local receivedPositionY = streamReadFloat32(streamId)\n    local receivedPositionZ = streamReadFloat32(streamId)\n\n    -- Set the position of the player.\n    self.player.mover:setPosition(receivedPositionX, receivedPositionY, receivedPositionZ)\n\n    local historyToDelete = self.tickHistory[ 1 ]\n    while historyToDelete ~ = nil and historyToDelete.tickIndex < = tickIndex do\n        table.remove( self.tickHistory, 1 )\n        historyToDelete = self.tickHistory[ 1 ]\n    end\n\n    local numHistoryEntries = # self.tickHistory\n    local numAggregationTicks = math.ceil(numHistoryEntries / 5 )\n\n    local totalMovementX, totalMovementY, totalMovementZ = nil , nil , nil\n    local numSteps = 0\n    for _, history in ipairs( self.tickHistory) do\n\n        if totalMovementX = = nil then\n            totalMovementX, totalMovementY, totalMovementZ = 0 , 0 , 0\n        end\n        totalMovementX = totalMovementX + history.movementX\n        totalMovementY = totalMovementY + history.movementY\n        totalMovementZ = totalMovementZ + history.movementZ\n\n        numSteps = numSteps + 1\n\n        if numSteps > = numAggregationTicks then\n            self.player.capsuleController:move(totalMovementX, totalMovementY, totalMovementZ)\n            totalMovementX = nil\n            numSteps = 0\n        end\n    end\n\n    if numSteps > 0 then\n        self.player.capsuleController:move(totalMovementX, totalMovementY, totalMovementZ)\n    end\nend\n\n"})}),"\n",(0,o.jsx)(n.h3,{id:"update",children:"update"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Description"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"Updates the player based on the network state every frame."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Definition"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"update(float dt)"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n",(0,o.jsx)(n.table,{children:(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"float"}),(0,o.jsx)(n.th,{children:"dt"}),(0,o.jsx)(n.th,{children:"delta time in ms"})]})})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Code"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-lua",children:"function PlayerLocalNetworkComponent:update(dt)\n    if self.needNewTick then\n        self.currentTickIndex = self.currentTickIndex + 1\n\n        while # self.tickHistory > PlayerLocalNetworkComponent.NETWORK_HISTORY_MAX_LENGTH do\n            table.remove( self.tickHistory, 1 )\n        end\n\n        local history = {\n        tickIndex = self.currentTickIndex,\n        movementX = 0 ,\n        movementY = 0 ,\n        movementZ = 0\n        }\n\n        table.insert( self.tickHistory, history)\n        self.needNewTick = false\n    end\n\n    self.movementX = self.movementX + self.player.mover.positionDeltaX\n    self.movementY = self.movementY + self.player.mover.positionDeltaY\n    self.movementZ = self.movementZ + self.player.mover.positionDeltaZ\n    self.movementYaw = self.player.mover:getMovementYaw()\n\n    local currentTickHistory = self.tickHistory[# self.tickHistory]\n    if currentTickHistory ~ = nil then\n        currentTickHistory.movementX = currentTickHistory.movementX + self.player.mover.positionDeltaX\n        currentTickHistory.movementY = currentTickHistory.movementY + self.player.mover.positionDeltaY\n        currentTickHistory.movementZ = currentTickHistory.movementZ + self.player.mover.positionDeltaZ\n    end\nend\n\n"})}),"\n",(0,o.jsx)(n.h3,{id:"updatetick",children:"updateTick"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Description"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"Runs every tick and handles preparing the state."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Definition"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"updateTick(float dt)"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n",(0,o.jsx)(n.table,{children:(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"float"}),(0,o.jsx)(n.th,{children:"dt"}),(0,o.jsx)(n.th,{children:"Delta time in ms."})]})})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Code"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-lua",children:"function PlayerLocalNetworkComponent:updateTick(dt)\n    -- update tick index in next frame\n    self.needNewTick = true\nend\n\n"})}),"\n",(0,o.jsx)(n.h3,{id:"writeupdatestream",children:"writeUpdateStream"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Description"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"Writes the state into the outgoing network stream."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Definition"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"writeUpdateStream(integer streamId, Connection connection, integer dirtyMask)"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"integer"}),(0,o.jsx)(n.th,{children:"streamId"}),(0,o.jsx)(n.th,{children:"The id of the stream into which to write."})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"Connection"}),(0,o.jsx)(n.td,{children:"connection"}),(0,o.jsx)(n.td,{children:"The connection between the server and the client."})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"integer"}),(0,o.jsx)(n.td,{children:"dirtyMask"}),(0,o.jsx)(n.td,{children:"The current dirty mask."})]})]})]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Code"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-lua",children:'function PlayerLocalNetworkComponent:writeUpdateStream(streamId, connection, dirtyMask)\n\n    --#debug Assert.isTrue(self.player.isOwner, "PlayerLocalNetworkComponent only works with the owner player!")\n\n    PlayerLocalNetworkComponent:superClass().writeUpdateStream( self , streamId, connection, dirtyMask)\n\n    streamWriteUInt32(streamId, self.currentTickIndex)\n    streamWriteFloat32(streamId, self.movementX)\n    streamWriteFloat32(streamId, self.movementY)\n    streamWriteFloat32(streamId, self.movementZ)\n    NetworkUtil.writeCompressedAngle(streamId, self.movementYaw)\n    streamWriteBool(streamId, self.player.camera.isFirstPerson)\n    streamWriteBool(streamId, self.player.mover.isCrouching)\n\n    self.movementX = 0\n    self.movementY = 0\n    self.movementZ = 0\n    self.movementYaw = 0\nend\n\n'})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}}}]);