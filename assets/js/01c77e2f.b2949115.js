"use strict";(globalThis.webpackChunkfs25_community_luadoc=globalThis.webpackChunkfs25_community_luadoc||[]).push([[31540],{10524(e,n,i){i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"script/Specializations/Locomotive","title":"Locomotive","description":"Locomotive","source":"@site/../docs/script/Specializations/Locomotive.md","sourceDirName":"script/Specializations","slug":"/script/Specializations/Locomotive","permalink":"/FS25-Community-LUADOC/script/Specializations/Locomotive","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1767161192000,"frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"LivestockTrailer","permalink":"/FS25-Community-LUADOC/script/Specializations/LivestockTrailer"},"next":{"title":"ManureBarrel","permalink":"/FS25-Community-LUADOC/script/Specializations/ManureBarrel"}}');var s=i(74848),r=i(28453);const l={},o=void 0,c={},a=[{value:"Locomotive",id:"locomotive",level:2},{value:"alignToSplineTime",id:"aligntosplinetime",level:3},{value:"getAreSurfaceSoundsActive",id:"getaresurfacesoundsactive",level:3},{value:"getBrakeAcceleration",id:"getbrakeacceleration",level:3},{value:"getCanBeReset",id:"getcanbereset",level:3},{value:"getDistanceToRequestedPosition",id:"getdistancetorequestedposition",level:3},{value:"getDownhillForce",id:"getdownhillforce",level:3},{value:"getFullName",id:"getfullname",level:3},{value:"getIsEnterable",id:"getisenterable",level:3},{value:"getIsMapHotspotVisible",id:"getismaphotspotvisible",level:3},{value:"getIsMotorStarted",id:"getismotorstarted",level:3},{value:"getIsReadyForAutomatedTrainTravel",id:"getisreadyforautomatedtraintravel",level:3},{value:"getLocomotiveSpeed",id:"getlocomotivespeed",level:3},{value:"getMapHotspotPosition",id:"getmaphotspotposition",level:3},{value:"getMotorRpmReal",id:"getmotorrpmreal",level:3},{value:"getStopMotorOnLeave",id:"getstopmotoronleave",level:3},{value:"getTraveledDistanceStatsActive",id:"gettraveleddistancestatsactive",level:3},{value:"initSpecialization",id:"initspecialization",level:3},{value:"notifyPlayerFarmChanged",id:"notifyplayerfarmchanged",level:3},{value:"onDelete",id:"ondelete",level:3},{value:"onEnterVehicle",id:"onentervehicle",level:3},{value:"onLeaveVehicle",id:"onleavevehicle",level:3},{value:"onLoad",id:"onload",level:3},{value:"onReadStream",id:"onreadstream",level:3},{value:"onUpdate",id:"onupdate",level:3},{value:"onWriteStream",id:"onwritestream",level:3},{value:"prerequisitesPresent",id:"prerequisitespresent",level:3},{value:"registerEventListeners",id:"registereventlisteners",level:3},{value:"registerEvents",id:"registerevents",level:3},{value:"registerFunctions",id:"registerfunctions",level:3},{value:"registerOverwrittenFunctions",id:"registeroverwrittenfunctions",level:3},{value:"setLocomotiveState",id:"setlocomotivestate",level:3},{value:"setRequestedSplinePosition",id:"setrequestedsplineposition",level:3},{value:"setTrainSystem",id:"settrainsystem",level:3},{value:"startAutomatedTrainTravel",id:"startautomatedtraintravel",level:3},{value:"updateVehiclePhysics",id:"updatevehiclephysics",level:3}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"locomotive",children:"Locomotive"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Specialization for locomotives (railroad vehicle)"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Functions"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#aligntosplinetime",children:"alignToSplineTime"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#getaresurfacesoundsactive",children:"getAreSurfaceSoundsActive"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#getbrakeacceleration",children:"getBrakeAcceleration"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#getcanbereset",children:"getCanBeReset"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#getdistancetorequestedposition",children:"getDistanceToRequestedPosition"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#getdownhillforce",children:"getDownhillForce"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#getfullname",children:"getFullName"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#getisenterable",children:"getIsEnterable"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#getismaphotspotvisible",children:"getIsMapHotspotVisible"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#getismotorstarted",children:"getIsMotorStarted"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#getisreadyforautomatedtraintravel",children:"getIsReadyForAutomatedTrainTravel"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#getlocomotivespeed",children:"getLocomotiveSpeed"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#getmaphotspotposition",children:"getMapHotspotPosition"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#getmotorrpmreal",children:"getMotorRpmReal"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#getstopmotoronleave",children:"getStopMotorOnLeave"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#gettraveleddistancestatsactive",children:"getTraveledDistanceStatsActive"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#initspecialization",children:"initSpecialization"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#notifyplayerfarmchanged",children:"notifyPlayerFarmChanged"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#ondelete",children:"onDelete"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#onentervehicle",children:"onEnterVehicle"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#onleavevehicle",children:"onLeaveVehicle"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#onload",children:"onLoad"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#onreadstream",children:"onReadStream"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#onupdate",children:"onUpdate"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#onwritestream",children:"onWriteStream"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#prerequisitespresent",children:"prerequisitesPresent"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#registereventlisteners",children:"registerEventListeners"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#registerevents",children:"registerEvents"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#registerfunctions",children:"registerFunctions"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#registeroverwrittenfunctions",children:"registerOverwrittenFunctions"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#setlocomotivestate",children:"setLocomotiveState"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#setrequestedsplineposition",children:"setRequestedSplinePosition"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#settrainsystem",children:"setTrainSystem"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#startautomatedtraintravel",children:"startAutomatedTrainTravel"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#updatevehiclephysics",children:"updateVehiclePhysics"})}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"aligntosplinetime",children:"alignToSplineTime"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"alignToSplineTime()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"superFunc"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"any"}),(0,s.jsx)(n.td,{children:"spline"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"any"}),(0,s.jsx)(n.td,{children:"yOffset"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"any"}),(0,s.jsx)(n.td,{children:"tFront"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'function Locomotive:alignToSplineTime(superFunc, spline, yOffset, tFront)\n    local retValue = superFunc( self , spline, yOffset, tFront)\n\n    if retValue ~ = nil then\n        local spec = self.spec_locomotive\n        if spec.powerArm ~ = nil and spec.electricitySpline ~ = nil then\n            local x, y, z = getWorldTranslation(spec.powerArm)\n            local cx, cy, cz = getWorldTranslation(g_cameraManager:getActiveCamera())\n            if MathUtil.vector3Length(x - cx, y - cy, z - cz) < 50 then\n                local _\n                retValue = SplineUtil.getValidSplineTime(retValue)\n                x, y, z, _ = getLocalClosestSplinePosition(spec.electricitySpline, retValue, spec.electricitySplineSearchTime, x, y, z, 0.01 )\n\n                _, y, _ = worldToLocal(getParent(spec.powerArm), x, y, z)\n                x, _, z = getTranslation(spec.powerArm)\n                setTranslation(spec.powerArm, x, y, z)\n                if spec.powerArm ~ = nil then\n                    self:setMovingToolDirty(spec.powerArm)\n                end\n\n                -- local x, y, z = getSplinePosition(spec.electricitySpline, newTime)\n                -- local dx, dy, dz = getSplineDirection(spec.electricitySpline, newTime)\n                -- log(string.format("%.4f %.4f %.4f %.4f", retValue, electricityTime, dif, newTime))\n                -- DebugGizmo.renderAtPosition(x, y, z, dx, dy, dz, 0, 1, 0, "E " .. tFront .. " " .. electricityTime .. " " .. newTime)\n            end\n        end\n    end\n\n    if not self.isServer then\n        self:updateMapHotspot()\n    end\n\n    return retValue\nend\n\n'})}),"\n",(0,s.jsx)(n.h3,{id:"getaresurfacesoundsactive",children:"getAreSurfaceSoundsActive"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"getAreSurfaceSoundsActive()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"superFunc"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function Locomotive:getAreSurfaceSoundsActive(superFunc)\n    return self:getLastSpeed() > 0.1\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"getbrakeacceleration",children:"getBrakeAcceleration"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"getBrakeAcceleration()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"self"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function Locomotive.getBrakeAcceleration( self )\n    local spec = self.spec_locomotive\n    local downhillForce = self:getDownhillForce()\n    local maxBrakeForce = self.serverMass * 9.81 * 0.18\n    local brakeForce\n\n    if math.abs(spec.speed) < 0.3 or not self:getIsControlled() then\n        brakeForce = maxBrakeForce\n    else\n            brakeForce = maxBrakeForce * 0.05\n        end\n\n        local sign = 1\n        -- do it explicit with if because math.sign returns 0 for zero speed\n            if spec.speed < 0 then\n                sign = - 1\n            end\n\n            brakeForce = brakeForce * sign\n\n            local brakeForceSum = - brakeForce - downhillForce\n            if math.abs(brakeForceSum) < 0.0001 then\n                -- if brake force is near zero we take only 95% of the downhillForce into account.Braking should always be possible ingame\n                    brakeForceSum = - brakeForce - downhillForce * 0.95\n                end\n\n                return( 1 / self.serverMass) * brakeForceSum\n            end\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"getcanbereset",children:"getCanBeReset"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"getCanBeReset()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"superFunc"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function Locomotive:getCanBeReset(superFunc)\n    return false\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"getdistancetorequestedposition",children:"getDistanceToRequestedPosition"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"getDistanceToRequestedPosition()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function Locomotive:getDistanceToRequestedPosition()\n    local spec = self.spec_locomotive\n    if spec.state = = Locomotive.STATE_REQUESTED_POSITION_BRAKING or spec.state = = Locomotive.STATE_REQUESTED_POSITION then\n        local currentPosition = self:getCurrentSplinePosition()\n        local requestedPosition = spec.requestedSplinePosition % 1\n\n        local distanceToGo = math.abs(requestedPosition - currentPosition)\n        if spec.state = = Locomotive.STATE_REQUESTED_POSITION_BRAKING and distanceToGo > 0.5 then\n            -- if we brake a bit late and go over the requested position\n                return 0\n            end\n\n            return distanceToGo * self.trainSystem:getSplineLength()\n        end\n\n        return 0\n    end\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"getdownhillforce",children:"getDownhillForce"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"getDownhillForce()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function Locomotive:getDownhillForce()\n    local dirX, dirY, dirZ = localDirectionToWorld( self.rootNode, 0 , 0 , 1 )\n    local angleX = math.acos(dirY / MathUtil.vector3Length(dirX, dirY, dirZ)) - 0.5 * math.pi\n\n    return self.serverMass * 9.81 * math.sin( - angleX)\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"getfullname",children:"getFullName"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"getFullName()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"superFunc"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function Locomotive:getFullName(superFunc)\n    local storeItem = g_storeManager:getItemByXMLFilename( self.configFileName)\n    return storeItem.name\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"getisenterable",children:"getIsEnterable"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"getIsEnterable()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"superFunc"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function Locomotive:getIsEnterable(superFunc)\n    if not superFunc( self ) then\n        return false\n    end\n\n    if self.trainSystem ~ = nil and not self.trainSystem:getIsTrainInDriveableRange() then\n        return false\n    end\n\n    local spec = self.spec_locomotive\n    return spec.state = = Locomotive.STATE_MANUAL_TRAVEL_ACTIVE or spec.state = = Locomotive.STATE_MANUAL_TRAVEL_INACTIVE\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"getismaphotspotvisible",children:"getIsMapHotspotVisible"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"getIsMapHotspotVisible()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"superFunc"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function Locomotive:getIsMapHotspotVisible(superFunc)\n    if not superFunc( self ) then\n        return false\n    end\n\n    if self.trainSystem ~ = nil and not self.trainSystem:getIsTrainInDriveableRange() then\n        return false\n    end\n\n    local x, _, z = getWorldTranslation( self.rootNode)\n    if math.abs(x) > g_currentMission.terrainSize * 0.5 or math.abs(z) > g_currentMission.terrainSize * 0.5 then\n        return false\n    end\n\n    return true\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"getismotorstarted",children:"getIsMotorStarted"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"getIsMotorStarted()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"superFunc"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function Locomotive:getIsMotorStarted(superFunc)\n    local spec = self.spec_locomotive\n    return superFunc( self )\n    or spec.state = = Locomotive.STATE_AUTOMATIC_TRAVEL_ACTIVE\n    or spec.state = = Locomotive.STATE_REQUESTED_POSITION\n    or spec.state = = Locomotive.STATE_REQUESTED_POSITION_BRAKING\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"getisreadyforautomatedtraintravel",children:"getIsReadyForAutomatedTrainTravel"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"getIsReadyForAutomatedTrainTravel()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"superFunc"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function Locomotive:getIsReadyForAutomatedTrainTravel(superFunc)\n    if self:getIsControlled() then\n        return false\n    end\n\n    return superFunc( self )\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"getlocomotivespeed",children:"getLocomotiveSpeed"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"getLocomotiveSpeed()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function Locomotive:getLocomotiveSpeed()\n    return self.spec_locomotive.speed\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"getmaphotspotposition",children:"getMapHotspotPosition"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"getMapHotspotPosition()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"superFunc"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function Locomotive:getMapHotspotPosition(superFunc)\n    if self.trainSystem = = nil then\n        return 0 , 0 , 0\n    end\n\n    return self.trainSystem:getTrainPosition()\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"getmotorrpmreal",children:"getMotorRpmReal"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"getMotorRpmReal()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"superFunc"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function Locomotive:getMotorRpmReal(superFunc)\n    return self.spec_locomotive.lastVirtualRpm\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"getstopmotoronleave",children:"getStopMotorOnLeave"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"getStopMotorOnLeave()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"superFunc"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function Locomotive:getStopMotorOnLeave(superFunc)\n    return self.spec_locomotive.state = = Locomotive.STATE_MANUAL_TRAVEL_ACTIVE or self.spec_locomotive.state = = Locomotive.STATE_MANUAL_TRAVEL_INACTIVE\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"gettraveleddistancestatsactive",children:"getTraveledDistanceStatsActive"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"getTraveledDistanceStatsActive()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"superFunc"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function Locomotive:getTraveledDistanceStatsActive(superFunc)\n    local spec = self.spec_locomotive\n    return spec.state = = Locomotive.STATE_MANUAL_TRAVEL_ACTIVE\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"initspecialization",children:"initSpecialization"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"initSpecialization()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'function Locomotive.initSpecialization()\n    local schema = Vehicle.xmlSchema\n    schema:setXMLSpecializationType( "Locomotive" )\n\n    schema:register(XMLValueType.NODE_INDEX, "vehicle.locomotive.powerArm#node" , "Power arm node" )\n\n    schema:setXMLSpecializationType()\nend\n\n'})}),"\n",(0,s.jsx)(n.h3,{id:"notifyplayerfarmchanged",children:"notifyPlayerFarmChanged"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"notifyPlayerFarmChanged()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function Locomotive:notifyPlayerFarmChanged()\n    if self.trainSystem ~ = nil then\n        self:setIsTabbable( self.trainSystem.isRented and g_localPlayer.farmId = = self.trainSystem.rentFarmId)\n    end\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"ondelete",children:"onDelete"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"onDelete()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function Locomotive:onDelete()\n    g_messageCenter:unsubscribeAll( self )\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"onentervehicle",children:"onEnterVehicle"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"onEnterVehicle()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function Locomotive:onEnterVehicle()\n    local spec = self.spec_locomotive\n    spec.requestedSplinePosition = nil\n    spec.automaticTravelStartTime = nil\n\n    if not g_currentMission.missionInfo.automaticMotorStartEnabled then\n        if spec.state = = Locomotive.STATE_AUTOMATIC_TRAVEL_ACTIVE or spec.state = = Locomotive.STATE_REQUESTED_POSITION or spec.state = = Locomotive.STATE_REQUESTED_POSITION_BRAKING then\n            self:startMotor( true )\n        end\n    end\n\n    self:setLocomotiveState( Locomotive.STATE_MANUAL_TRAVEL_ACTIVE)\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"onleavevehicle",children:"onLeaveVehicle"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"onLeaveVehicle()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function Locomotive:onLeaveVehicle()\n    local spec = self.spec_locomotive\n    if spec.state ~ = Locomotive.STATE_AUTOMATIC_TRAVEL_ACTIVE then\n        if self:getIsReadyForAutomatedTrainTravel() then\n            spec.automaticTravelStartTime = g_ time + Locomotive.AUTOMATIC_DRIVE_DELAY\n        end\n\n        self:setLocomotiveState( Locomotive.STATE_MANUAL_TRAVEL_INACTIVE)\n        self:raiseActive()\n\n        spec.requestedSplinePosition = nil\n    end\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"onload",children:"onLoad"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Called on loading"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"onLoad(table savegame)"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"table"}),(0,s.jsx)(n.th,{children:"savegame"}),(0,s.jsx)(n.th,{children:"savegame"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'function Locomotive:onLoad(savegame)\n    local spec = self.spec_locomotive\n\n    self.serverMass = 1 -- set serverMass ~ = 0 to prevent dib by zero issues after load\n\n    spec.powerArm = self.xmlFile:getValue( "vehicle.locomotive.powerArm#node" , nil , self.components, self.i3dMappings)\n    spec.electricitySpline = nil\n\n    spec.lastVirtualRpm = self:getMotor():getMinRpm()\n    spec.speed = 0\n    spec.lastAcceleration = 0\n    spec.nextMovingDirection = 0\n    spec.sellingDirection = 1\n\n    spec.startBrakeDistance = 0\n    spec.startBrakeSpeed = 0\n\n    self:setLocomotiveState( Locomotive.STATE_NONE)\n\n    spec.motor = self:getMotor()\n\n    spec.doStartCheck = true\n\n    g_messageCenter:subscribe(MessageType.PLAYER_FARM_CHANGED, self.notifyPlayerFarmChanged, self )\n    g_messageCenter:subscribe(MessageType.PLAYER_CREATED, self.notifyPlayerFarmChanged, self )\nend\n\n'})}),"\n",(0,s.jsx)(n.h3,{id:"onreadstream",children:"onReadStream"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Called on client side on join"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"onReadStream(integer streamId, Connection connection)"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"integer"}),(0,s.jsx)(n.th,{children:"streamId"}),(0,s.jsx)(n.th,{children:"streamId"})]})}),(0,s.jsx)(n.tbody,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Connection"}),(0,s.jsx)(n.td,{children:"connection"}),(0,s.jsx)(n.td,{children:"connection"})]})})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function Locomotive:onReadStream(streamId, connection)\n    self.spec_locomotive.state = streamReadUIntN(streamId, Locomotive.NUM_BITS_STATE)\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"onupdate",children:"onUpdate"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"onUpdate()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"dt"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"any"}),(0,s.jsx)(n.td,{children:"isActiveForInput"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"any"}),(0,s.jsx)(n.td,{children:"isActiveForInputIgnoreSelection"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"any"}),(0,s.jsx)(n.td,{children:"isSelected"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'function Locomotive:onUpdate(dt, isActiveForInput, isActiveForInputIgnoreSelection, isSelected)\n    local spec = self.spec_locomotive\n\n    if spec.doStartCheck then\n        if self.trainSystem ~ = nil then\n            if not self.trainSystem:getIsRented() then\n                self:startAutomatedTrainTravel()\n            else\n                    self:setLocomotiveState( Locomotive.STATE_MANUAL_TRAVEL_ACTIVE)\n                end\n\n                self:raiseActive()\n                spec.doStartCheck = false\n            end\n        end\n\n        -- update motor as long as locomotive is still moving but no player has entered\n        if self.isServer then\n            if spec.state = = Locomotive.STATE_AUTOMATIC_TRAVEL_ACTIVE then\n                self:raiseActive()\n                self:updateVehiclePhysics( 1 , 0 , 0 , dt)\n                SpecializationUtil.raiseEvent( self , "onAutomatedTrainTravelActive" , dt)\n            elseif spec.state = = Locomotive.STATE_REQUESTED_POSITION then\n                    if spec.requestedSplinePosition ~ = nil then\n                        local splineLength = self.trainSystem:getSplineLength()\n                        local currentPosition = self:getCurrentSplinePosition() % 1\n                        local requestedPosition = spec.requestedSplinePosition % 1\n\n                        local targetDirection = math.sign(requestedPosition - currentPosition)\n                        local brakeAcceleration = Locomotive.getBrakeAcceleration( self )\n                        local brakeDistance = math.abs((spec.speed ^ 2 ) / ( 2 * brakeAcceleration))\n                        local brakePoint = (requestedPosition - (brakeDistance / splineLength) * targetDirection) % 1\n                        local pendingDirectionChange = not(targetDirection = = self.movingDirection or self.movingDirection = = 0 )\n                        if not pendingDirectionChange and((targetDirection > = 0 and(currentPosition > brakePoint and currentPosition < brakePoint + 0.5 ))\n                            or(targetDirection < 0 and(currentPosition < brakePoint and currentPosition > brakePoint - 0.5 ))) then\n                            self:setLocomotiveState( Locomotive.STATE_REQUESTED_POSITION_BRAKING)\n\n                            spec.startBrakeDistance = brakeDistance\n                            spec.startBrakeSpeed = spec.speed\n                        else\n                                self:updateVehiclePhysics(targetDirection, 0 , 0 , dt)\n                            end\n                            self:raiseActive()\n                        end\n                    elseif spec.state = = Locomotive.STATE_REQUESTED_POSITION_BRAKING then\n                            -- if we detect that we could stop way earlier(e.g.due to changing slope) we release the brake again\n                                local brakeAcceleration = Locomotive.getBrakeAcceleration( self )\n                                local brakeDistance = math.abs((spec.startBrakeSpeed ^ 2 ) / ( 2 * brakeAcceleration))\n                                if brakeDistance < spec.startBrakeDistance - 10 then\n                                    self:setLocomotiveState( Locomotive.STATE_REQUESTED_POSITION)\n                                end\n\n                                if self.movingDirection > 0 then\n                                    self:updateVehiclePhysics( - 1 , 0 , 0 , dt)\n                                else\n                                        self:updateVehiclePhysics( 1 , 0 , 0 , dt)\n                                    end\n\n                                    self:raiseActive()\n                                    if spec.speed = = 0 then\n                                        self:setLocomotiveState( Locomotive.STATE_MANUAL_TRAVEL_ACTIVE)\n\n                                        self:stopMotor()\n                                    end\n                                elseif spec.state = = Locomotive.STATE_MANUAL_TRAVEL_INACTIVE then\n                                        if self.movingDirection > 0 then\n                                            self:updateVehiclePhysics( - 1 , 0 , 0 , dt)\n                                        elseif self.movingDirection < 0 then\n                                                self:updateVehiclePhysics( 1 , 0 , 0 , dt)\n                                            end\n                                            self:raiseActive()\n                                        end\n                                    else\n                                            if spec.state = = Locomotive.STATE_AUTOMATIC_TRAVEL_ACTIVE\n                                                or spec.state = = Locomotive.STATE_REQUESTED_POSITION\n                                                or spec.state = = Locomotive.STATE_REQUESTED_POSITION_BRAKING then\n                                                self:raiseActive()\n                                            end\n                                        end\n                                    end\n\n'})}),"\n",(0,s.jsx)(n.h3,{id:"onwritestream",children:"onWriteStream"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Called on server side on join"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"onWriteStream(integer streamId, Connection connection)"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"integer"}),(0,s.jsx)(n.th,{children:"streamId"}),(0,s.jsx)(n.th,{children:"streamId"})]})}),(0,s.jsx)(n.tbody,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Connection"}),(0,s.jsx)(n.td,{children:"connection"}),(0,s.jsx)(n.td,{children:"connection"})]})})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function Locomotive:onWriteStream(streamId, connection)\n    streamWriteUIntN(streamId, self.spec_locomotive.state, Locomotive.NUM_BITS_STATE)\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"prerequisitespresent",children:"prerequisitesPresent"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Checks if all prerequisite specializations are loaded"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"prerequisitesPresent(table specializations)"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"table"}),(0,s.jsx)(n.th,{children:"specializations"}),(0,s.jsx)(n.th,{children:"specializations"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Return Values"})}),"\n\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"table"}),(0,s.jsx)(n.th,{children:"hasPrerequisite"}),(0,s.jsx)(n.th,{children:"true if all prerequisite specializations are loaded"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function Locomotive.prerequisitesPresent(specializations)\n    return SpecializationUtil.hasSpecialization( SplineVehicle , specializations) and SpecializationUtil.hasSpecialization( Drivable , specializations)\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"registereventlisteners",children:"registerEventListeners"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"registerEventListeners()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"vehicleType"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'function Locomotive.registerEventListeners(vehicleType)\n    SpecializationUtil.registerEventListener(vehicleType, "onLoad" , Locomotive )\n    SpecializationUtil.registerEventListener(vehicleType, "onDelete" , Locomotive )\n    SpecializationUtil.registerEventListener(vehicleType, "onReadStream" , Locomotive )\n    SpecializationUtil.registerEventListener(vehicleType, "onWriteStream" , Locomotive )\n    SpecializationUtil.registerEventListener(vehicleType, "onUpdate" , Locomotive )\n    SpecializationUtil.registerEventListener(vehicleType, "onLeaveVehicle" , Locomotive )\n    SpecializationUtil.registerEventListener(vehicleType, "onEnterVehicle" , Locomotive )\nend\n\n'})}),"\n",(0,s.jsx)(n.h3,{id:"registerevents",children:"registerEvents"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"registerEvents()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"vehicleType"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'function Locomotive.registerEvents(vehicleType)\n    SpecializationUtil.registerEvent(vehicleType, "onAutomatedTrainTravelActive" )\nend\n\n'})}),"\n",(0,s.jsx)(n.h3,{id:"registerfunctions",children:"registerFunctions"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"registerFunctions()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"vehicleType"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'function Locomotive.registerFunctions(vehicleType)\n    SpecializationUtil.registerFunction(vehicleType, "getDownhillForce" , Locomotive.getDownhillForce)\n    SpecializationUtil.registerFunction(vehicleType, "getLocomotiveSpeed" , Locomotive.getLocomotiveSpeed)\n    SpecializationUtil.registerFunction(vehicleType, "setRequestedSplinePosition" , Locomotive.setRequestedSplinePosition)\n    SpecializationUtil.registerFunction(vehicleType, "getDistanceToRequestedPosition" , Locomotive.getDistanceToRequestedPosition)\n    SpecializationUtil.registerFunction(vehicleType, "setLocomotiveState" , Locomotive.setLocomotiveState)\n    SpecializationUtil.registerFunction(vehicleType, "startAutomatedTrainTravel" , Locomotive.startAutomatedTrainTravel)\n    SpecializationUtil.registerFunction(vehicleType, "notifyPlayerFarmChanged" , Locomotive.notifyPlayerFarmChanged)\nend\n\n'})}),"\n",(0,s.jsx)(n.h3,{id:"registeroverwrittenfunctions",children:"registerOverwrittenFunctions"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"registerOverwrittenFunctions()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"vehicleType"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'function Locomotive.registerOverwrittenFunctions(vehicleType)\n    SpecializationUtil.registerOverwrittenFunction(vehicleType, "getIsMotorStarted" , Locomotive.getIsMotorStarted)\n    SpecializationUtil.registerOverwrittenFunction(vehicleType, "updateVehiclePhysics" , Locomotive.updateVehiclePhysics)\n    SpecializationUtil.registerOverwrittenFunction(vehicleType, "getIsReadyForAutomatedTrainTravel" , Locomotive.getIsReadyForAutomatedTrainTravel)\n    SpecializationUtil.registerOverwrittenFunction(vehicleType, "alignToSplineTime" , Locomotive.alignToSplineTime)\n    SpecializationUtil.registerOverwrittenFunction(vehicleType, "setTrainSystem" , Locomotive.setTrainSystem)\n    SpecializationUtil.registerOverwrittenFunction(vehicleType, "getFullName" , Locomotive.getFullName)\n    SpecializationUtil.registerOverwrittenFunction(vehicleType, "getAreSurfaceSoundsActive" , Locomotive.getAreSurfaceSoundsActive)\n    SpecializationUtil.registerOverwrittenFunction(vehicleType, "getTraveledDistanceStatsActive" , Locomotive.getTraveledDistanceStatsActive)\n    SpecializationUtil.registerOverwrittenFunction(vehicleType, "getIsEnterable" , Locomotive.getIsEnterable)\n    SpecializationUtil.registerOverwrittenFunction(vehicleType, "getIsMapHotspotVisible" , Locomotive.getIsMapHotspotVisible)\n    SpecializationUtil.registerOverwrittenFunction(vehicleType, "getCanBeReset" , Locomotive.getCanBeReset)\n    SpecializationUtil.registerOverwrittenFunction(vehicleType, "getStopMotorOnLeave" , Locomotive.getStopMotorOnLeave)\n    SpecializationUtil.registerOverwrittenFunction(vehicleType, "getMapHotspotPosition" , Locomotive.getMapHotspotPosition)\n    SpecializationUtil.registerOverwrittenFunction(vehicleType, "getMotorRpmReal" , Locomotive.getMotorRpmReal)\nend\n\n'})}),"\n",(0,s.jsx)(n.h3,{id:"setlocomotivestate",children:"setLocomotiveState"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"setLocomotiveState()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"state"})]})}),(0,s.jsx)(n.tbody,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"any"}),(0,s.jsx)(n.td,{children:"noEventSend"})]})})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function Locomotive:setLocomotiveState(state, noEventSend)\n    local spec = self.spec_locomotive\n    spec.state = state\n\n    if state = = Locomotive.STATE_AUTOMATIC_TRAVEL_ACTIVE then\n        if self.setRandomVehicleCharacter ~ = nil then\n            self:setRandomVehicleCharacter()\n        end\n    elseif state = = Locomotive.STATE_MANUAL_TRAVEL_ACTIVE then\n            self:restoreVehicleCharacter()\n        end\n\n        if g_server ~ = nil and not noEventSend then\n            g_server:broadcastEvent( LocomotiveStateEvent.new( self , state), nil , nil , self )\n        end\n\n        self:raiseActive()\n    end\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"setrequestedsplineposition",children:"setRequestedSplinePosition"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"setRequestedSplinePosition()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"splinePosition"})]})}),(0,s.jsx)(n.tbody,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"any"}),(0,s.jsx)(n.td,{children:"noEventSend"})]})})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function Locomotive:setRequestedSplinePosition(splinePosition, noEventSend)\n    local spec = self.spec_locomotive\n    spec.requestedSplinePosition = splinePosition\n    self:setLocomotiveState( Locomotive.STATE_REQUESTED_POSITION, true )\n\n    local currentPosition = self:getCurrentSplinePosition()\n    local requestedPosition = spec.requestedSplinePosition\n    if currentPosition > spec.requestedSplinePosition then\n        if math.abs(currentPosition - (requestedPosition + 1 )) < math.abs(currentPosition - requestedPosition) then\n            spec.requestedSplinePosition = requestedPosition + 1\n        end\n    end\n\n    if self.isServer then\n        self:startMotor()\n    end\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"settrainsystem",children:"setTrainSystem"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"setTrainSystem()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"superFunc"})]})}),(0,s.jsx)(n.tbody,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"any"}),(0,s.jsx)(n.td,{children:"trainSystem"})]})})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function Locomotive:setTrainSystem(superFunc, trainSystem)\n    superFunc( self , trainSystem)\n\n    local spec = self.spec_locomotive\n    if spec.powerArm ~ = nil then\n        local spline = trainSystem:getElectricitySpline()\n        if spline ~ = nil then\n            local electricitySplineLength = trainSystem:getElectricitySplineLength()\n            local splineLength = trainSystem:getSplineLength()\n            spec.splineDiff = math.abs(electricitySplineLength - splineLength)\n            spec.electricitySplineSearchTime = spec.splineDiff * 5 / electricitySplineLength\n            spec.electricitySpline = spline\n        end\n    end\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"startautomatedtraintravel",children:"startAutomatedTrainTravel"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"startAutomatedTrainTravel()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function Locomotive:startAutomatedTrainTravel()\n    self:setLocomotiveState( Locomotive.STATE_AUTOMATIC_TRAVEL_ACTIVE)\n    self:startMotor()\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"updatevehiclephysics",children:"updateVehiclePhysics"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"updateVehiclePhysics()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"superFunc"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"any"}),(0,s.jsx)(n.td,{children:"axisForward"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"any"}),(0,s.jsx)(n.td,{children:"axisSide"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"any"}),(0,s.jsx)(n.td,{children:"doHandbrake"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"any"}),(0,s.jsx)(n.td,{children:"dt"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function Locomotive:updateVehiclePhysics(superFunc, axisForward, axisSide, doHandbrake, dt)\n    local spec = self.spec_locomotive\n    local specDrivable = self.spec_drivable\n\n    axisForward = axisForward * spec.sellingDirection\n\n    local acceleration = superFunc( self , axisForward, axisSide, doHandbrake, dt)\n\n    local interpDt = g_physicsDt\n    if g_server = = nil then\n        -- on clients, we interpolate the vehicles with g_physicsDtUnclamped, thus we need to use the same for camera interpolation\n            interpDt = g_physicsDtUnclamped\n        end\n\n        -- assuming:\n        -- totalMass:mass,\n        -- P(v):tractive effort of locomotive\n        -- Q(v):drag of train(dismissed)\n        -- B:brake force\n        -- g:gravity\n        -- alpha:inclination angle\n        --\n        -- totalMass*a = P(v) - Q(v) - B - totalMass*g*sin(alpha)\n        -- a = 1/totalMass * [ (P(v) - Q(v) - B - totalMass*g*sin(alpha) ]\n\n        local tractiveEffort = 300000\n        local maxBrakeForce = self.serverMass * 9.81 * 0.18\n        local downhillForce = self:getDownhillForce()\n        tractiveEffort = math.min(tractiveEffort, maxBrakeForce)\n\n        if self:getIsMotorStarted() then\n            local reverserDirection = specDrivable = = nil and 1 or specDrivable.reverserDirection\n            if self:getCruiseControlState() ~ = Drivable.CRUISECONTROL_STATE_OFF then\n                local cruiseControlSpeed = self:getCruiseControlSpeed() / 3.6\n                if spec.speed < reverserDirection * cruiseControlSpeed then\n                    acceleration = 1\n                elseif spec.speed > reverserDirection * cruiseControlSpeed then\n                        acceleration = - 1\n                    end\n                end\n            else\n                    tractiveEffort = maxBrakeForce\n                end\n\n                if math.abs(acceleration) < 0.001 then\n                    local a = Locomotive.getBrakeAcceleration( self )\n\n                    if spec.speed > 0 then\n                        spec.speed = math.max( 0 , spec.speed + a * dt / 1000 )\n                    elseif spec.speed < 0 then\n                            spec.speed = math.min( 0 , spec.speed + a * dt / 1000 )\n                        else\n                                -- move train if track is too steep ???\n                                    if maxBrakeForce < math.abs(downhillForce) then\n                                        spec.speed = spec.speed + a * dt / 1000\n                                    end\n                                end\n\n                                if spec.speed = = 0 then\n                                    spec.hasStopped = true\n                                else\n                                        spec.hasStopped = false\n                                    end\n                                else\n                                        if math.abs(spec.speed) > 0.1 then\n                                            spec.hasStopped = false\n                                        elseif math.abs(spec.speed) = = 0 then\n                                                spec.hasStopped = true\n                                            end\n                                            if spec.hasStopped = = nil or(spec.hasStopped and math.abs(acceleration) > 0.01 ) then\n                                                spec.nextMovingDirection = math.sign(acceleration)\n                                            end\n\n                                            local a = 0\n                                            local brakeForce\n                                            if spec.nextMovingDirection = = nil or(spec.nextMovingDirection * acceleration) > 0 then\n                                                tractiveEffort = acceleration * tractiveEffort\n                                                brakeForce = 0\n                                                a = ( 1 / self.serverMass) * ( tractiveEffort - brakeForce - downhillForce )\n                                            else\n                                                    tractiveEffort = 0\n                                                    brakeForce = math.sign(spec.speed) * math.abs(acceleration) * maxBrakeForce\n                                                    if math.abs(spec.speed) < 0.1 then\n                                                        spec.speed = 0\n                                                    else\n                                                            a = ( 1 / self.serverMass) * ( tractiveEffort - brakeForce - downhillForce )\n                                                        end\n                                                    end\n\n                                                    spec.speed = spec.speed + a * interpDt / 1000\n                                                end\n\n                                                local motor = spec.motor\n                                                if spec.speed > 0 then\n                                                    spec.speed = math.min(spec.speed, motor.maxForwardSpeed)\n                                                elseif spec.speed < 0 then\n                                                        spec.speed = math.max(spec.speed, - motor.maxBackwardSpeed)\n                                                    end\n\n                                                    local minRpm = motor.minRpm\n                                                    local maxRpm = motor.maxRpm\n                                                    -- fake rpm for indoorHud\n                                                        if spec.lastAcceleration * spec.nextMovingDirection > 0 then\n                                                            spec.lastVirtualRpm = math.min(maxRpm, spec.lastVirtualRpm + ( 0.0005 * dt * (maxRpm - minRpm)))\n                                                        else\n                                                                spec.lastVirtualRpm = math.max(minRpm, spec.lastVirtualRpm - ( 0.001 * dt * (maxRpm - minRpm)))\n                                                            end\n\n                                                            motor:setEqualizedMotorRpm(spec.lastVirtualRpm)\n\n                                                            spec.lastAcceleration = acceleration\n                                                        end\n\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28453(e,n,i){i.d(n,{R:()=>l,x:()=>o});var t=i(96540);const s={},r=t.createContext(s);function l(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);