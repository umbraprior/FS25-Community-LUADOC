"use strict";(globalThis.webpackChunkfs25_community_luadoc=globalThis.webpackChunkfs25_community_luadoc||[]).push([[28647],{28453(e,n,i){i.d(n,{R:()=>l,x:()=>d});var r=i(96540);const s={},t=r.createContext(s);function l(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),r.createElement(t.Provider,{value:n},e.children)}},31912(e,n,i){i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"script/Specializations/AIFieldWorker","title":"AIFieldWorker","description":"AIFieldWorker","source":"@site/../docs/script/Specializations/AIFieldWorker.md","sourceDirName":"script/Specializations","slug":"/script/Specializations/AIFieldWorker","permalink":"/FS25-Community-LUADOC/script/Specializations/AIFieldWorker","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1767161192000,"frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"AIDrivable","permalink":"/FS25-Community-LUADOC/script/Specializations/AIDrivable"},"next":{"title":"AIImplement","permalink":"/FS25-Community-LUADOC/script/Specializations/AIImplement"}}');var s=i(74848),t=i(28453);const l={},d=void 0,a={},c=[{value:"AIFieldWorker",id:"aifieldworker",level:2},{value:"aiContinue",id:"aicontinue",level:3},{value:"onReadStream",id:"onreadstream",level:3},{value:"onWriteStream",id:"onwritestream",level:3},{value:"prerequisitesPresent",id:"prerequisitespresent",level:3},{value:"saveToXMLFile",id:"savetoxmlfile",level:3},{value:"updateAIFieldWorker",id:"updateaifieldworker",level:3},{value:"updateAIFieldWorkerDriveStrategies",id:"updateaifieldworkerdrivestrategies",level:3}];function o(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"aifieldworker",children:"AIFieldWorker"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Specialization for extending vehicles to by used by AI helpers"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Functions"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#aicontinue",children:"aiContinue"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#onreadstream",children:"onReadStream"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#onwritestream",children:"onWriteStream"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#prerequisitespresent",children:"prerequisitesPresent"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#savetoxmlfile",children:"saveToXMLFile"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#updateaifieldworker",children:"updateAIFieldWorker"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#updateaifieldworkerdrivestrategies",children:"updateAIFieldWorkerDriveStrategies"})}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"aicontinue",children:"aiContinue"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"aiContinue()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"superFunc"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'function AIFieldWorker:aiContinue(superFunc)\n    superFunc( self )\n\n    local spec = self.spec_aiFieldWorker\n    if spec.isActive and not spec.isTurning then\n        self:raiseAIEvent( "onAIFieldWorkerContinue" , "onAIImplementContinue" )\n    end\n\n    spec.isBlocked = false\nend\n\n'})}),"\n",(0,s.jsx)(n.h3,{id:"onreadstream",children:"onReadStream"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Called on client side on join"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"onReadStream(integer streamId, Connection connection)"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"integer"}),(0,s.jsx)(n.th,{children:"streamId"}),(0,s.jsx)(n.th,{children:"streamId"})]})}),(0,s.jsx)(n.tbody,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Connection"}),(0,s.jsx)(n.td,{children:"connection"}),(0,s.jsx)(n.td,{children:"connection"})]})})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function AIFieldWorker:onReadStream(streamId, connection)\n    if streamReadBool(streamId) then\n        self:startFieldWorker()\n    end\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"onwritestream",children:"onWriteStream"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Called on server side on join"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"onWriteStream(integer streamId, Connection connection)"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"integer"}),(0,s.jsx)(n.th,{children:"streamId"}),(0,s.jsx)(n.th,{children:"streamId"})]})}),(0,s.jsx)(n.tbody,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Connection"}),(0,s.jsx)(n.td,{children:"connection"}),(0,s.jsx)(n.td,{children:"connection"})]})})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function AIFieldWorker:onWriteStream(streamId, connection)\n    local spec = self.spec_aiFieldWorker\n    streamWriteBool(streamId, spec.isActive)\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"prerequisitespresent",children:"prerequisitesPresent"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Checks if all prerequisite specializations are loaded"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"prerequisitesPresent(table specializations)"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"table"}),(0,s.jsx)(n.th,{children:"specializations"}),(0,s.jsx)(n.th,{children:"specializations"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Return Values"})}),"\n\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"table"}),(0,s.jsx)(n.th,{children:"hasPrerequisite"}),(0,s.jsx)(n.th,{children:"true if all prerequisite specializations are loaded"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function AIFieldWorker.prerequisitesPresent(specializations)\n    return SpecializationUtil.hasSpecialization( AIJobVehicle , specializations)\n    and SpecializationUtil.hasSpecialization( Drivable , specializations)\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"savetoxmlfile",children:"saveToXMLFile"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"saveToXMLFile()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"xmlFile"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"any"}),(0,s.jsx)(n.td,{children:"key"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"any"}),(0,s.jsx)(n.td,{children:"usedModNames"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'function AIFieldWorker:saveToXMLFile(xmlFile, key, usedModNames)\n    local spec = self.spec_aiFieldWorker\n    if spec.isActive ~ = nil then\n        xmlFile:setValue(key .. "#isActive" , spec.isActive)\n    end\n\n    if spec.driveStrategies ~ = nil and #spec.driveStrategies > 0 then\n        spec.reconstructionData = { }\n        for i, strategy in ipairs(spec.driveStrategies) do\n            if strategy.fillReconstructionData ~ = nil then\n                strategy:fillReconstructionData(spec.reconstructionData)\n            end\n        end\n    end\n\n    for strategyIndex, strategyData in ipairs( AIFieldWorker.registeredDriveStrategies) do\n        if strategyData.class.saveToXML ~ = nil then\n            strategyData.class.saveToXML(spec.reconstructionData, xmlFile, key)\n        end\n    end\nend\n\n'})}),"\n",(0,s.jsx)(n.h3,{id:"updateaifieldworker",children:"updateAIFieldWorker"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"updateAIFieldWorker(float dt)"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"float"}),(0,s.jsx)(n.th,{children:"dt"}),(0,s.jsx)(n.th,{children:"time since last call in ms"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'function AIFieldWorker:updateAIFieldWorker(dt)\n    local spec = self.spec_aiFieldWorker\n\n    self:clearAIDebugTexts()\n    self:clearAIDebugLines()\n\n    if self:getIsFieldWorkActive() then\n        if #spec.driveStrategies > 0 then\n            local vX,vY,vZ = getWorldTranslation( self:getAISteeringNode())\n\n            local tX, tZ, moveForwards, maxSpeedStra, maxSpeed, distanceToStop\n            for _, driveStrategy in ipairs(spec.driveStrategies) do\n                tX, tZ, moveForwards, maxSpeedStra, distanceToStop = driveStrategy:getDriveData(dt, vX,vY,vZ)\n                maxSpeed = math.min(maxSpeedStra or math.huge, maxSpeed or math.huge)\n                if tX ~ = nil or not self:getIsFieldWorkActive() then\n                    break\n                end\n            end\n\n            if tX = = nil or MathUtil.isNan(tX) or MathUtil.isNan(tZ) then\n                if self:getIsFieldWorkActive() then -- check if AI is still active, because it might have been kicked by a strategy\n                    self:stopCurrentAIJob( AIMessageSuccessFinishedJob.new())\n                end\n            end\n\n            if not self:getIsFieldWorkActive() then\n                return\n            end\n\n            local minimumSpeed = 5\n            local lookAheadDistance = 5\n\n            -- use different settings while turning\n                -- so we are more pricise when stopping at end point in small turning segments\n                if self:getAIFieldWorkerIsTurning() then\n                    minimumSpeed = 1.5\n                    lookAheadDistance = 2\n                end\n\n                local distSpeed = math.max(minimumSpeed, maxSpeed * math.min( 1 , distanceToStop / lookAheadDistance))\n                local speedLimit, _ = self:getSpeedLimit( true )\n                maxSpeed = math.min(maxSpeed, distSpeed, speedLimit)\n                maxSpeed = math.min(maxSpeed, self:getCruiseControlMaxSpeed())\n\n                if VehicleDebug.state = = VehicleDebug.DEBUG_AI then\n                    self:addAIDebugText( string.format( " = = = > maxSpeed = %.2f" , maxSpeed))\n                end\n\n                -- set drive values\n                spec.aiDriveParams.moveForwards = moveForwards\n                spec.aiDriveParams.tX = tX\n                spec.aiDriveParams.tY = vY\n                spec.aiDriveParams.tZ = tZ\n                spec.aiDriveParams.maxSpeed = maxSpeed\n                spec.aiDriveParams.valid = true\n            end\n\n            if spec.aiDriveParams.valid then\n                local moveForwards = spec.aiDriveParams.moveForwards\n                local tX = spec.aiDriveParams.tX\n                local tY = spec.aiDriveParams.tY\n                local tZ = spec.aiDriveParams.tZ\n                local maxSpeed = spec.aiDriveParams.maxSpeed\n\n                local pX, _, pZ\n                if moveForwards then\n                    pX, _, pZ = worldToLocal( self:getAISteeringNode(), tX, tY, tZ)\n                else\n                        pX, _, pZ = worldToLocal( self:getAIReverserNode(), tX, tY, tZ)\n                    end\n\n                    local acceleration = 1.0\n                    local isAllowedToDrive = maxSpeed ~ = 0\n\n                    AIVehicleUtil.driveToPoint( self , dt, acceleration, isAllowedToDrive, moveForwards, pX, pZ, maxSpeed)\n                end\n\n                self:raiseAIEvent( "onAIFieldWorkerActive" , "onAIImplementActive" )\n            end\n        end\n\n'})}),"\n",(0,s.jsx)(n.h3,{id:"updateaifieldworkerdrivestrategies",children:"updateAIFieldWorkerDriveStrategies"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Set drive strategies depending on the vehicle"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"updateAIFieldWorkerDriveStrategies()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function AIFieldWorker:updateAIFieldWorkerDriveStrategies()\n    local spec = self.spec_aiFieldWorker\n\n    if #spec.aiImplementList > 0 then\n        if spec.driveStrategies ~ = nil and #spec.driveStrategies > 0 then\n            for i = #spec.driveStrategies, 1 , - 1 do\n                spec.driveStrategies[i]:delete()\n                table.remove(spec.driveStrategies, i)\n            end\n            spec.driveStrategies = { }\n        end\n\n        for strategyIndex, strategyData in ipairs( AIFieldWorker.registeredDriveStrategies) do\n            for _, childVehicle in pairs( self.rootVehicle.childVehicles) do -- using all vehicles since the combine can also be standalone without cutter - so no ai implement\n                if strategyData.func(childVehicle) then\n                    table.insert(spec.driveStrategies, strategyData.class.new(spec.reconstructionData))\n                    break\n                end\n            end\n        end\n\n        for i = 1 , #spec.driveStrategies do\n            spec.driveStrategies[i]:setAIVehicle( self )\n        end\n    end\nend\n\n"})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}}}]);