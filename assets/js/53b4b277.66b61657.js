"use strict";(globalThis.webpackChunkfs25_community_luadoc=globalThis.webpackChunkfs25_community_luadoc||[]).push([[12887],{28453(e,n,i){i.d(n,{R:()=>a,x:()=>d});var l=i(96540);const r={},t=l.createContext(r);function a(e){const n=l.useContext(t);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),l.createElement(t.Provider,{value:n},e.children)}},88589(e,n,i){i.r(n),i.d(n,{assets:()=>s,contentTitle:()=>d,default:()=>h,frontMatter:()=>a,metadata:()=>l,toc:()=>c});const l=JSON.parse('{"id":"script/Specializations/PlaceableRiceField","title":"PlaceableRiceField","description":"PlaceableRiceField","source":"@site/../docs/script/Specializations/PlaceableRiceField.md","sourceDirName":"script/Specializations","slug":"/script/Specializations/PlaceableRiceField","permalink":"/FS25-Community-LUADOC/script/Specializations/PlaceableRiceField","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1767161192000,"frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"PlaceableProductionPoint","permalink":"/FS25-Community-LUADOC/script/Specializations/PlaceableProductionPoint"},"next":{"title":"PlaceableRiceFieldActivatable","permalink":"/FS25-Community-LUADOC/script/Specializations/PlaceableRiceFieldActivatable"}}');var r=i(74848),t=i(28453);const a={},d=void 0,s={},c=[{value:"PlaceableRiceField",id:"placeablericefield",level:2},{value:"buildMesh",id:"buildmesh",level:3},{value:"collectPickObjects",id:"collectpickobjects",level:3},{value:"getDestructionMethod",id:"getdestructionmethod",level:3},{value:"getHasValidFields",id:"gethasvalidfields",level:3},{value:"initSpecialization",id:"initspecialization",level:3},{value:"loadFromXMLFile",id:"loadfromxmlfile",level:3},{value:"onDelete",id:"ondelete",level:3},{value:"onLoad",id:"onload",level:3},{value:"onPumpI3DLoaded",id:"onpumpi3dloaded",level:3},{value:"onReadStream",id:"onreadstream",level:3},{value:"onUpdateTick",id:"onupdatetick",level:3},{value:"onWriteStream",id:"onwritestream",level:3},{value:"onWriteUpdateStream",id:"onwriteupdatestream",level:3},{value:"performNodeDestruction",id:"performnodedestruction",level:3},{value:"performTerrainDeformation",id:"performterraindeformation",level:3},{value:"prerequisitesPresent",id:"prerequisitespresent",level:3},{value:"previewNodeDestructionNodes",id:"previewnodedestructionnodes",level:3},{value:"registerEventListeners",id:"registereventlisteners",level:3},{value:"registerFunctions",id:"registerfunctions",level:3},{value:"registerOverwrittenFunctions",id:"registeroverwrittenfunctions",level:3},{value:"registerSavegameXMLPaths",id:"registersavegamexmlpaths",level:3},{value:"registerXMLPaths",id:"registerxmlpaths",level:3},{value:"saveToXMLFile",id:"savetoxmlfile",level:3}];function o(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"placeablericefield",children:"PlaceableRiceField"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Description"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Specialization for placeables"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Functions"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#buildmesh",children:"buildMesh"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#collectpickobjects",children:"collectPickObjects"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#getdestructionmethod",children:"getDestructionMethod"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#gethasvalidfields",children:"getHasValidFields"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#initspecialization",children:"initSpecialization"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#loadfromxmlfile",children:"loadFromXMLFile"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#ondelete",children:"onDelete"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#onload",children:"onLoad"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#onpumpi3dloaded",children:"onPumpI3DLoaded"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#onreadstream",children:"onReadStream"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#onupdatetick",children:"onUpdateTick"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#onwritestream",children:"onWriteStream"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#onwriteupdatestream",children:"onWriteUpdateStream"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#performnodedestruction",children:"performNodeDestruction"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#performterraindeformation",children:"performTerrainDeformation"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#prerequisitespresent",children:"prerequisitesPresent"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#previewnodedestructionnodes",children:"previewNodeDestructionNodes"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#registereventlisteners",children:"registerEventListeners"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#registerfunctions",children:"registerFunctions"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#registeroverwrittenfunctions",children:"registerOverwrittenFunctions"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#registersavegamexmlpaths",children:"registerSavegameXMLPaths"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#registerxmlpaths",children:"registerXMLPaths"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#savetoxmlfile",children:"saveToXMLFile"})}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"buildmesh",children:"buildMesh"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Description"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Definition"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"buildMesh()"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,r.jsx)(n.table,{children:(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"any"}),(0,r.jsx)(n.th,{children:"field"})]})})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Code"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:'function PlaceableRiceField:buildMesh(field)\n    local spec = self.spec_riceField\n\n    local offsetPolygon = field.polygon:getOffsetPolygon( PlaceableRiceField.COL_MESH_SIZE_OFFSET)\n    if offsetPolygon = = nil then\n        return false\n    end\n\n    local waterplaneNode = createPlaneShapeFrom2DContour( "riceFieldVisualWaterPlane" , field.polygon:getVertices(), false )\n    if waterplaneNode = = 0 then\n        return false\n    end\n\n    local waterplaneMirrorsNode = clone(waterplaneNode, false , false , false )\n    setName(waterplaneMirrorsNode, "riceFieldVisualWaterPlaneMirror" )\n\n    -- dedicated water col as we cannot move it with the visual water to ensure it is always\n    local waterplaneColNode = createPlaneShapeFrom2DContour( "riceFieldWaterCol" , field.polygon:getVertices(), true )\n    if waterplaneColNode = = 0 then\n        return false\n    end\n\n    local placementColPlaneNode = createPlaneShapeFrom2DContour( "riceFieldPlacementCol" , offsetPolygon:getVertices(), true )\n    if placementColPlaneNode = = 0 then\n        return false\n    end\n\n    removeFromPhysics(waterplaneColNode)\n    removeFromPhysics(placementColPlaneNode)\n\n    field.node = createTransformGroup( "riceField" )\n    link( self.rootNode, field.node)\n    field.mesh = waterplaneNode\n    field.mirrorMesh = waterplaneMirrorsNode\n    field.colMesh = waterplaneColNode\n    field.placementColMesh = placementColPlaneNode\n    link(field.node, waterplaneNode)\n    link(field.node, waterplaneMirrorsNode)\n    link(field.node, waterplaneColNode)\n    link(field.node, placementColPlaneNode)\n\n    -- placement col\n    local x, _, z = getTranslation(placementColPlaneNode)\n    setTranslation(placementColPlaneNode, x, field.height - 1 , z) -- col for masks can be below the terrain\n        setCollisionFilter(placementColPlaneNode, CollisionFlag.PLACEMENT_BLOCKING, 1 )\n        setIsNonRenderable(placementColPlaneNode, true )\n        addToPhysics(placementColPlaneNode)\n\n        -- water col\n        x, _, z = getTranslation(waterplaneColNode)\n        setTranslation(waterplaneColNode, x, field.height + spec.waterMaxLevel, z)\n        setCollisionFilter(waterplaneColNode, CollisionFlag.WATER , 1 )\n        setIsNonRenderable(waterplaneColNode, true )\n        addToPhysics(waterplaneColNode)\n\n        --#debug local rnx, rny, rnz = getWorldTranslation(field.node)\n        --#debug Assert.areRoughlyEqual(rnx, 0)\n        --#debug Assert.areRoughlyEqual(rny, 0)\n        --#debug Assert.areRoughlyEqual(rnz, 0)\n\n        -- water planes\n        -- regular water plane\n        setShapeReceiveShadowmap(waterplaneNode, true )\n        setShapeCastShadowmap(waterplaneNode, false )\n\n        local r,g,b,a = unpack(spec.underwaterFogColor or PlaceableRiceField.UNDERWATER_FOG_COLOR)\n        local depthScale, refractionColorScale, getWaterDepthScale, inscatteringScale = unpack(spec.underwaterFogDepth or PlaceableRiceField.UNDERWATER_FOG_DEPTH)\n\n        local waterSimMat = g_materialManager:getBaseMaterialByName( "riceFieldWaterSimulation" )\n        if waterSimMat = = nil then\n            Logging.error( "Unable to retrieve material \'riceFieldWaterSimulation\' for rice field water plane" )\n            else\n                    setMaterial(waterplaneNode, waterSimMat, 0 )\n                    setShaderParameter(waterplaneNode, "underwaterFogColor" , r,g,b,a, false )\n                    setShaderParameter(waterplaneNode, "underwaterFogDepth" , depthScale, refractionColorScale, getWaterDepthScale, inscatteringScale, false )\n                end\n\n                -- simplified mirror water plane\n                setShapeReceiveShadowmap(waterplaneMirrorsNode, true )\n                setShapeCastShadowmap(waterplaneMirrorsNode, false )\n                local waterMirrorMat = g_materialManager:getBaseMaterialByName( "riceFieldWaterInMirror" )\n                if waterMirrorMat = = nil then\n                    Logging.error( "Unable to retrieve material \'riceFieldWaterInMirror\' for rice field water plane" )\n                    else\n                            setMaterial(waterplaneMirrorsNode, waterMirrorMat, 0 )\n                            setShaderParameter(waterplaneNode, "underwaterFogColor" , r,g,b,a)\n                            setShaderParameter(waterplaneNode, "underwaterFogDepth" , depthScale, refractionColorScale, getWaterDepthScale, inscatteringScale, false )\n                            setObjectMask(waterplaneMirrorsNode, ObjectMask.SHAPE_VIS_MIRROR_ONLY)\n                        end\n\n                        field.polygonFoliage = field.polygon:getOffsetPolygon(spec.foliageOffsetFromRidge)\n                        field.areaSqm = field.polygon:getArea()\n                        field.capacity = field.areaSqm * 1000 * spec.waterMaxLevel\n\n                        table.insert(spec.fields, field)\n                        local fieldIndex = #spec.fields\n\n                        self:setWaterHeight(fieldIndex, field.waterHeight, true )\n\n                        if g_currentMission.shallowWaterSimulation ~ = nil then\n                            g_currentMission.shallowWaterSimulation:addWaterPlane(field.mesh)\n                            g_currentMission.shallowWaterSimulation:addAreaGeometry(field.mesh)\n                        end\n\n                        g_currentMission:addNodeObject(waterplaneColNode, self )\n                        g_currentMission:addNodeObject(placementColPlaneNode, self )\n\n                        -- add pump and trigger at center of first edge\n                        field.pumpNode = clone(spec.pumpNode, false , false , false )\n                        link(field.node, field.pumpNode)\n\n                        field.fillingWater = I3DUtil.indexToObject(field.pumpNode, spec.fillingWaterPath)\n                        field.fillingSplash = I3DUtil.indexToObject(field.pumpNode, spec.fillingSplashPath)\n                        field.emptyingWater = I3DUtil.indexToObject(field.pumpNode, spec.emptyingWaterPath)\n                        field.emptyingSplash = I3DUtil.indexToObject(field.pumpNode, spec.emptyingSplashPath)\n\n                        if spec.samples ~ = nil then\n                            if spec.samples.pumpSound ~ = nil then\n                                field.pumpSound = g_soundManager:cloneSample(spec.samples.pumpSound, field.pumpNode)\n                            end\n                            if spec.samples.waterSound ~ = nil then\n                                local waterSoundLinkNode = createTransformGroup( "riceFieldWaterSoundNode" )\n                                link(field.pumpNode, waterSoundLinkNode)\n                                field.waterSoundLinkNode = waterSoundLinkNode\n                                field.waterSound = g_soundManager:cloneSample(spec.samples.waterSound, field.waterSoundLinkNode)\n                            end\n                        end\n\n                        -- position pump\n                        local x1, z1, x2, z2 = field.polygon:getEdge( 1 )\n                        local cx, cz = (x1 + x2) / 2 , (z1 + z2) / 2\n                        setWorldTranslation(field.pumpNode, cx, field.height, cz)\n\n                        -- position emptying splash\n                        local wx,wy,wz = getWorldTranslation(field.emptyingSplash)\n                        local heightDiff = math.abs(getTerrainHeightAtWorldPos(g_terrainNode, wx, 0 , wz) - wy)\n                        if heightDiff < 0.5 then\n                            setWorldTranslation(field.emptyingSplash, wx, wy + 0.07 , wz)\n                        else\n                                -- hide splash if too far from terrain beneath\n                                    delete(field.emptyingSplash)\n                                    field.emptyingSplash = createTransformGroup( "riceFieldEmptyingSplashDummy" )\n                                    link(field.pumpNode, field.emptyingSplash)\n                                end\n\n                                local orientation = field.polygon:getCurveOrientation()\n                                local ry = - math.pi / 2 + MathUtil.getYRotationFromDirection(x2 - x1, z2 - z1) + (orientation = = - 1 and math.pi or 0 )\n                                setRotation(field.pumpNode, 0 , ry, 0 )\n                                addToPhysics(field.pumpNode)\n\n                                self:setEffectVisibility(fieldIndex, false , false )\n\n                                field.playerTriggerNode = clone(spec.playerTriggerNode, false , false , false )\n                                link(field.node, field.playerTriggerNode)\n                                setWorldTranslation(field.playerTriggerNode, cx, field.height, cz)\n                                setRotation(field.playerTriggerNode, 0 , ry, 0 )\n                                addToPhysics(field.playerTriggerNode)\n                                addTrigger(field.playerTriggerNode, "playerTriggerCallback" , self )\n                                spec.triggerToFieldIndex[field.playerTriggerNode] = fieldIndex\n\n                                return true\n                            end\n\n'})}),"\n",(0,r.jsx)(n.h3,{id:"collectpickobjects",children:"collectPickObjects"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Description"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Definition"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"collectPickObjects()"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"any"}),(0,r.jsx)(n.th,{children:"superFunc"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"any"}),(0,r.jsx)(n.td,{children:"node"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"any"}),(0,r.jsx)(n.td,{children:"target"})]})]})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Code"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:"function PlaceableRiceField:collectPickObjects(superFunc, node, target)\n    ---Default picking objects is disabled\nend\n\n"})}),"\n",(0,r.jsx)(n.h3,{id:"getdestructionmethod",children:"getDestructionMethod"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Description"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Deletion is in pieces so not instantly"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Definition"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"getDestructionMethod()"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,r.jsx)(n.table,{children:(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"any"}),(0,r.jsx)(n.th,{children:"superFunc"})]})})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Code"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:"function PlaceableRiceField:getDestructionMethod(superFunc)\n    return Placeable.DESTRUCTION.PER_NODE\nend\n\n"})}),"\n",(0,r.jsx)(n.h3,{id:"gethasvalidfields",children:"getHasValidFields"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Description"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Definition"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"getHasValidFields()"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Code"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:"function PlaceableRiceField:getHasValidFields()\n    local spec = self.spec_riceField\n    for _, field in ipairs(spec.fields) do\n        if field.polygon:getNumVertices() > = 3 then -- field.mesh ~ = nil\n            return true\n        end\n    end\n\n    return false\nend\n\n"})}),"\n",(0,r.jsx)(n.h3,{id:"initspecialization",children:"initSpecialization"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Description"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Definition"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"initSpecialization()"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Code"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:'function PlaceableRiceField.initSpecialization()\n    if g_isDevelopmentVersion then\n        addConsoleCommand( "gsRiceFieldWaterSetLevel" , "Set rice field water level percentage" , "consoleCommandSetWaterLevel" , PlaceableRiceField )\n        addConsoleCommand( "gsRiceFieldWaterSetShaderParameters" , "Set rice field water plane shader parameters" , "consoleCommandsetWaterShaderParameters" , PlaceableRiceField , "r; g; b; a; depthScale; refractionColorScale; getWaterDepthScale; inscatteringScale" )\n        addConsoleCommand( "gsRiceFieldSetRice" , "Set field rice state" , "consoleCommandSetRiceState" , PlaceableRiceField , "fruitTypeName; growthState; groundAngle" )\n        addConsoleCommand( "gsRiceFieldCreateFromField" , "Create a rice field from a field using the same outline" , "consoleCommandCreateRiceFieldFromField" , PlaceableRiceField , "fieldIndex" )\n    end\nend\n\n'})}),"\n",(0,r.jsx)(n.h3,{id:"loadfromxmlfile",children:"loadFromXMLFile"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Description"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Definition"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"loadFromXMLFile()"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"any"}),(0,r.jsx)(n.th,{children:"xmlFile"})]})}),(0,r.jsx)(n.tbody,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"any"}),(0,r.jsx)(n.td,{children:"key"})]})})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Code"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:'function PlaceableRiceField:loadFromXMLFile(xmlFile, key)\n    for fieldIndex, fieldKey in xmlFile:iterator(key .. ".fields.field" ) do\n\n        local height = xmlFile:getValue(fieldKey .. "#worldHeight" )\n\n        local field = self:createNewField(height)\n        field.waterHeight = xmlFile:getValue(fieldKey .. "#waterHeight" ) or 0\n        local waterHeightTarget = xmlFile:getValue(fieldKey .. "#waterHeightTarget" )\n\n        local numVertexElements = xmlFile:getNumOfElements(fieldKey .. ".v" )\n        field.polygon = Polygon2D.new(numVertexElements)\n\n        for _, periodKey in xmlFile:iterator(fieldKey .. ".waterLevels" ) do\n            local period = xmlFile:getValue(periodKey .. "#period" )\n            field.periodWaterLevelPerSqm[period] = xmlFile:getValue(periodKey .. "#levelPerSqm" )\n        end\n\n        xmlFile:iterate(fieldKey .. ".v" , function (vertexIndex, vertexKey)\n\n            local xz = xmlFile:getVector(vertexKey, nil , 2 )\n\n            field.polygon:addPos(xz[ 1 ], xz[ 2 ])\n        end )\n\n        self:buildMesh(field)\n\n        -- perform deformation and set initial fruit if new savegame is started with preplaced fields\n            if self.isServer and not g_currentMission.missionInfo.isValid then\n                Logging.devInfo( "perform initial deformation for rice field %q" , key)\n                    local initialFruitName = xmlFile:getValue(fieldKey .. "#initialFruit" )\n                    if initialFruitName ~ = nil then\n                        local initialFruitType = g_fruitTypeManager:getFruitTypeByName(initialFruitName)\n                        if initialFruitType ~ = nil then\n                            field.initialFruitTypeIndex = initialFruitType.index\n                            field.initialFruitGrowthState = xmlFile:getValue(fieldKey .. "#initialFruitGrowthState" ) or initialFruitType:getMinHarvestingGrowthState()\n                            Logging.devInfo( "initial fruit %q at growth state %d" , initialFruitName, field.initialFruitGrowthState or - 1 )\n                        end\n                    end\n\n                    field.deformationIsFree = true\n                    self:performTerrainDeformation(field, callback)\n                end\n\n                if waterHeightTarget ~ = nil then\n                    self:setWaterHeightTarget(fieldIndex, waterHeightTarget)\n                end\n            end\n        end\n\n'})}),"\n",(0,r.jsx)(n.h3,{id:"ondelete",children:"onDelete"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Description"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Definition"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"onDelete()"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Code"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:'function PlaceableRiceField:onDelete()\n    local spec = self.spec_riceField\n\n    g_currentMission.activatableObjectsSystem:removeActivatable(spec.activatable)\n\n    g_messageCenter:unsubscribe(MessageType.FINISHED_GROWTH_PERIOD, self )\n    g_messageCenter:unsubscribe( PlaceableRiceFieldFieldAnswerEvent , self )\n\n    g_debugManager:removeGroup( "PlaceableRiceField" .. tostring( self ))\n\n    if spec.fields ~ = nil then\n        for _, field in ipairs(spec.fields) do\n            self:deleteField(field)\n        end\n\n        spec.fields = { }\n    end\n\n    if spec.pumpNode ~ = nil then\n        delete(spec.pumpNode)\n        spec.pumpNode = nil\n    end\n\n    if spec.samples ~ = nil then\n        g_soundManager:deleteSamples(spec.samples)\n    end\n\n    if spec.sharedLoadRequestId ~ = nil then\n        g_i3DManager:releaseSharedI3DFile(spec.sharedLoadRequestId)\n        spec.sharedLoadRequestId = nil\n    end\n\n    --#debug g_debugManager:removeDrawable(self)\nend\n\n'})}),"\n",(0,r.jsx)(n.h3,{id:"onload",children:"onLoad"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Description"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Called on loading"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Definition"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"onLoad(table savegame)"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n",(0,r.jsx)(n.table,{children:(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"table"}),(0,r.jsx)(n.th,{children:"savegame"}),(0,r.jsx)(n.th,{children:"savegame"})]})})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Code"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:'function PlaceableRiceField:onLoad(savegame)\n    local spec = self.spec_riceField\n    local xmlFile = self.xmlFile\n\n    spec.fields = { }\n    spec.triggerToFieldIndex = { }\n    spec.fieldsToCheckForOverlap = { }\n    spec.nodesToCheckForOverlap = { }\n\n    spec.groundTypeInner = xmlFile:getValue( "placeable.riceField.area#groundType" )\n    spec.groundInnerOffsetFromRidge = xmlFile:getValue( "placeable.riceField.area#offsetFromRidge" , - 0.5 )\n    spec.groundTypeRidge = xmlFile:getValue( "placeable.riceField.ridge#groundType" )\n    spec.ridgeHeight = xmlFile:getValue( "placeable.riceField.ridge#height" , 0.35 )\n    spec.levelingWidth = xmlFile:getValue( "placeable.riceField.ridge#levelingWidth" , 0.45 )\n    spec.ridgePaintWidth = xmlFile:getValue( "placeable.riceField.ridge#paintWidth" , 1 )\n    local foliageTypeName = xmlFile:getValue( "placeable.riceField.ridge#foliageType" )\n    if foliageTypeName ~ = nil then\n        spec.ridgeFoliageType = g_fruitTypeManager:getFruitTypeByName(foliageTypeName)\n        if spec.ridgeFoliageType ~ = nil then\n            local foliageGrowthState\n            local foliageGrowthStateName = xmlFile:getValue( "placeable.riceField.ridge#foliageGrowthStateName" )\n            if foliageGrowthStateName ~ = nil then\n                foliageGrowthState = spec.ridgeFoliageType:getGrowthStateByName(foliageGrowthStateName)\n                if foliageGrowthState = = nil then\n                    Logging.xmlWarning(xmlFile, "Foliage growthstate name \'%s\' does not exist for fruit type \'%s\'!" , foliageGrowthStateName, foliageTypeName)\n                    end\n                end\n\n                if foliageGrowthState = = nil then\n                    foliageGrowthState = xmlFile:getValue( "placeable.riceField.ridge#foliageGrowthStateName" , 2 )\n                end\n\n                spec.ridgeFoliageGrowthState = foliageGrowthState\n                spec.ridgeFoliageWidth = xmlFile:getValue( "placeable.riceField.ridge#foliageWidth" , spec.ridgePaintWidth / 2 )\n                spec.ridgeFoliageOffset = xmlFile:getValue( "placeable.riceField.ridge#foliageOffsetFromRidge" , 0.5 )\n            else\n                    Logging.xmlWarning(xmlFile, "Foliage type \'%s\' does not exist!" , foliageTypeName)\n                end\n            end\n\n            spec.waterMaxLevel = xmlFile:getValue( "placeable.riceField.water#maxLevel" , spec.ridgeHeight * 0.8 )\n            local waterFillDurationGameMinutes = xmlFile:getValue( "placeable.riceField.water#fillDurationGameMinutes" , 60 )\n            spec.waterFillDurationMs = waterFillDurationGameMinutes * 60 * 1000\n            spec.underwaterFogColor = xmlFile:getValue( "placeable.riceField.water#underwaterFogColor" )\n            spec.underwaterFogDepth = xmlFile:getValue( "placeable.riceField.water#underwaterFogDepth" )\n\n            spec.playerTriggerNode = xmlFile:getValue( "placeable.riceField.playerTrigger#node" , nil , self.components, self.i3dMappings)\n\n            local pumpFilename = xmlFile:getValue( "placeable.riceField.pump#filename" )\n            if pumpFilename ~ = nil then\n                pumpFilename = Utils.getFilename(pumpFilename, self.baseDirectory)\n                local args = {\n                loadingTask = self:createLoadingTask(spec),\n                xmlFile = xmlFile\n                }\n\n                spec.sharedLoadRequestId = g_i3DManager:loadSharedI3DFileAsync(pumpFilename, false , false , self.onPumpI3DLoaded, self , args)\n            end\n\n            if self.isClient then\n                spec.samples = { }\n                spec.samples.pumpSound = g_soundManager:loadSampleFromXML(xmlFile, "placeable.riceField.pump.sounds" , "pump" , self.baseDirectory, self.components, 0 , AudioGroup.ENVIRONMENT, self.i3dMappings, self )\n                spec.samples.waterSound = g_soundManager:loadSampleFromXML(xmlFile, "placeable.riceField.pump.sounds" , "water" , self.baseDirectory, self.components, 0 , AudioGroup.ENVIRONMENT, self.i3dMappings, self )\n            end\n\n            local fruitTypeNames = xmlFile:getValue( "placeable.riceField.foliage#fruitTypes" , "RICELONGGRAIN RICE" )\n            spec.fruitTypes = g_fruitTypeManager:getFruitTypesByNames(fruitTypeNames)\n            spec.foliageOffsetFromRidge = xmlFile:getValue( "placeable.riceField.foliage#offsetFromRidge" , - 1 )\n\n            -- spec.moduleNode = I3DUtil.indexToObject(self.components, "1", self.i3dMappings)\n            -- spec.moduleCornerNode = I3DUtil.indexToObject(self.components, "2", self.i3dMappings)\n\n            if self.isServer then\n                spec.waterPlanesDirtyFlag = self:getNextDirtyFlag()\n                spec.fieldIndicesDirty = { }\n                spec.fieldsPendingTargetWaterLevel = { }\n            end\n\n            spec.activatable = PlaceableRiceFieldActivatable.new( self )\n\n            g_messageCenter:subscribe(MessageType.FINISHED_GROWTH_PERIOD, self.onFinishedGrowthPeriod, self )\n\n            --#debug g_debugManager:addDrawable(self)\n        end\n\n'})}),"\n",(0,r.jsx)(n.h3,{id:"onpumpi3dloaded",children:"onPumpI3DLoaded"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Description"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Definition"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"onPumpI3DLoaded()"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"any"}),(0,r.jsx)(n.th,{children:"i3dNode"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"any"}),(0,r.jsx)(n.td,{children:"failedReason"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"any"}),(0,r.jsx)(n.td,{children:"args"})]})]})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Code"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:'function PlaceableRiceField:onPumpI3DLoaded(i3dNode, failedReason, args)\n    local spec = self.spec_riceField\n\n    local loadingTask = args.loadingTask\n    local xmlFile = args.xmlFile\n\n    if i3dNode = = 0 then\n        self:finishLoadingTask(loadingTask)\n        return false\n    end\n\n    spec.pumpNode = i3dNode -- template to clone per field\n\n    -- store node paths to resolve after cloning template pumpNode(per field)\n    spec.fillingWaterPath = xmlFile:getString( "placeable.riceField.pump.filling#water" )\n    spec.fillingSplashPath = xmlFile:getString( "placeable.riceField.pump.filling#splash" )\n    spec.fillingSplashYOffset = xmlFile:getValue( "placeable.riceField.pump.filling#yOffset" , 0.07 )\n    spec.emptyingWaterPath = xmlFile:getString( "placeable.riceField.pump.emptying#water" )\n    spec.emptyingSplashPath = xmlFile:getString( "placeable.riceField.pump.emptying#splash" )\n\n    self:finishLoadingTask(loadingTask)\n\n    return true\nend\n\n'})}),"\n",(0,r.jsx)(n.h3,{id:"onreadstream",children:"onReadStream"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Description"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Definition"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"onReadStream()"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"any"}),(0,r.jsx)(n.th,{children:"streamId"})]})}),(0,r.jsx)(n.tbody,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"any"}),(0,r.jsx)(n.td,{children:"connection"})]})})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Code"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:"function PlaceableRiceField:onReadStream(streamId, connection)\n    local numFields = streamReadUInt8(streamId)\n\n    for i = 1 , numFields do\n        local height = streamReadFloat32(streamId)\n        local field = self:createNewField(height)\n\n        local numVertices = streamReadUInt16(streamId)\n        field.polygon = Polygon2D.new(numVertices)\n\n        for i = 1 , numVertices do\n            field.polygon:addPos(streamReadFloat32(streamId), streamReadFloat32(streamId))\n        end\n\n        field.waterHeight = streamReadFloat32(streamId)\n\n        local isFilling = false\n        local isEmptying = false\n        if streamReadBool(streamId) then\n            field.waterHeightTarget = streamReadFloat32(streamId)\n            isFilling = field.waterHeightTarget > field.waterHeight\n            isEmptying = field.waterHeightTarget < field.waterHeight\n        end\n\n        self:buildMesh(field)\n\n        self:setEffectVisibility(i, isFilling, isEmptying)\n    end\nend\n\n"})}),"\n",(0,r.jsx)(n.h3,{id:"onupdatetick",children:"onUpdateTick"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Description"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Definition"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"onUpdateTick()"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,r.jsx)(n.table,{children:(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"any"}),(0,r.jsx)(n.th,{children:"dt"})]})})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Code"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:"function PlaceableRiceField:onUpdateTick(dt)\n    local spec = self.spec_riceField\n\n    if g_currentMission.shallowWaterSimulation ~ = nil then\n        for _, field in ipairs(spec.fields) do\n            if field.isFilling and math.random() > 0.6 then\n                -- add some waves to SWS when filling\n                local x,_,z = getWorldTranslation(field.fillingSplash)\n\n                g_currentMission.shallowWaterSimulation:paintCircle(x, nil ,z, 0.3 , MathUtil.randomFloat( - 1 , 1 ), MathUtil.randomFloat( - 1 , 1 ))\n            end\n        end\n    end\n\n    if not self.isServer then\n        return\n    end\n\n    local changeFactor = g_currentMission:getEffectiveTimeScale() * dt / spec.waterFillDurationMs\n\n    for fieldIndex in pairs(spec.fieldsPendingTargetWaterLevel) do\n        local field = spec.fields[fieldIndex]\n        if field = = nil then\n            continue\n        end\n\n        local dir = spec.fieldsPendingTargetWaterLevel[fieldIndex]\n\n        -- check if target height is reached\n            local heightDiff = field.waterHeight - field.waterHeightTarget\n            if heightDiff * dir > = 0 then\n                -- remove field from pending list, remove water target attribute\n                spec.fieldsPendingTargetWaterLevel[fieldIndex] = nil\n                field.waterHeightTarget = nil\n\n                -- stop effects\n                self:setEffectVisibility(fieldIndex, false , false )\n\n                -- enqueue one more update to sync reaching of target fillLevel to the clients\n                spec.fieldIndicesDirty[fieldIndex] = true\n                self:raiseDirtyFlags(spec.waterPlanesDirtyFlag)\n                self:raiseActive()\n\n                continue\n            end\n\n            local newHeight = field.waterHeight + dir * spec.waterMaxLevel * changeFactor\n            if dir = = PlaceableRiceField.FILL_DIRECTION.RISE then\n                newHeight = math.min(newHeight, field.waterHeightTarget)\n            else\n                    newHeight = math.max(newHeight, field.waterHeightTarget)\n                end\n\n                self:setWaterHeight(fieldIndex, newHeight) -- will raise active\n            end\n        end\n\n"})}),"\n",(0,r.jsx)(n.h3,{id:"onwritestream",children:"onWriteStream"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Description"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Definition"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"onWriteStream()"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"any"}),(0,r.jsx)(n.th,{children:"streamId"})]})}),(0,r.jsx)(n.tbody,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"any"}),(0,r.jsx)(n.td,{children:"connection"})]})})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Code"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:"function PlaceableRiceField:onWriteStream(streamId, connection)\n    local spec = self.spec_riceField\n\n    local numFields = #spec.fields\n\n    streamWriteUInt8(streamId, numFields)\n\n    for _, field in ipairs(spec.fields) do\n\n        streamWriteFloat32(streamId, field.height)\n\n        streamWriteUInt16(streamId, field.polygon:getNumVertices())\n\n        for _, vertexComponent in ipairs(field.polygon:getVertices()) do\n            streamWriteFloat32(streamId, vertexComponent)\n        end\n\n        streamWriteFloat32(streamId, field.waterHeight)\n\n        if streamWriteBool(streamId, field.waterHeightTarget ~ = nil ) then\n            streamWriteFloat32(streamId, field.waterHeightTarget)\n        end\n    end\nend\n\n"})}),"\n",(0,r.jsx)(n.h3,{id:"onwriteupdatestream",children:"onWriteUpdateStream"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Description"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Definition"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"onWriteUpdateStream()"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"any"}),(0,r.jsx)(n.th,{children:"streamId"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"any"}),(0,r.jsx)(n.td,{children:"connection"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"any"}),(0,r.jsx)(n.td,{children:"dirtyMask"})]})]})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Code"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:"function PlaceableRiceField:onWriteUpdateStream(streamId, connection, dirtyMask)\n    local spec = self.spec_riceField\n\n    if not connection:getIsServer() then\n        if streamWriteBool(streamId, bit32.btest(dirtyMask, spec.waterPlanesDirtyFlag)) then\n            for fieldIndex, field in ipairs(spec.fields) do\n                if streamWriteBool(streamId, spec.fieldIndicesDirty[fieldIndex] ~ = nil ) then -- only sync filllevel for fields which were set dirty\n                    NetworkUtil.writeCompressedRange(streamId, field.waterHeight, 0 , spec.waterMaxLevel, PlaceableRiceField.WATER_LEVEL_NUM_BITS)\n                    streamWriteBool(streamId, field.waterHeightTarget = = nil )\n                end\n            end\n        end\n    end\nend\n\n"})}),"\n",(0,r.jsx)(n.h3,{id:"performnodedestruction",children:"performNodeDestruction"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Description"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Definition"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"performNodeDestruction()"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"any"}),(0,r.jsx)(n.th,{children:"superFunc"})]})}),(0,r.jsx)(n.tbody,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"any"}),(0,r.jsx)(n.td,{children:"node"})]})})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Code"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:"function PlaceableRiceField:performNodeDestruction(superFunc, node)\n    local didRemoveField = self:removeFieldByNode(node)\n    local destroyPlaceable = not self:getHasValidFields()\n    return didRemoveField, destroyPlaceable\nend\n\n"})}),"\n",(0,r.jsx)(n.h3,{id:"performterraindeformation",children:"performTerrainDeformation"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Description"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Definition"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"performTerrainDeformation()"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"any"}),(0,r.jsx)(n.th,{children:"field"})]})}),(0,r.jsx)(n.tbody,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"any"}),(0,r.jsx)(n.td,{children:"callback"})]})})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Code"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:'function PlaceableRiceField:performTerrainDeformation(field, callback)\n    local spec = self.spec_riceField\n\n    -- prepare terrain deformation\n    field.displacedVolume = 0\n\n    -- flatten inside rice field\n    field.areaDeformation = TerrainDeformation.new(g_terrainNode)\n\n    -- create list of vertices including y coordinate\n    local polygon3dVertices = field.polygon:getVerticesAs3DCoordinates(field.height + 0.02 )\n\n    field.brushCallback = callback or( function () end )\n\n    local terrainBrushId = g_groundTypeManager:getTerrainLayerByType(spec.groundTypeInner)\n    field.areaDeformation:setOutsideAreaConstraints( PlaceableRiceField.MAX_HEIGHT_DIFF_TO_TERRAIN * 1.1 , math.rad( 45 ), math.rad( 50 ))\n    field.areaDeformation:addPolygonalArea(polygon3dVertices, terrainBrushId, false ) -- placement col is blocked by water plane mesh already\n\n    field.deformQueue = 1\n    field.areaDeformationJobId = g_terrainDeformationQueue:queueJob(field.areaDeformation, false , "onTerrainDeformationTaskFinished" , self , field)\n\n    -- deform ridges\n    local deformWidthHalf = spec.levelingWidth / 2\n    field.ridgeDeformation = TerrainDeformation.new(g_terrainNode)\n    field.ridgeDeformation:enableDeformationMode()\n    -- spec.ridgeDeformation:enableAreaBasedDeformationMode()\n    field.ridgeDeformation:setOutsideAreaConstraints( PlaceableRiceField.MAX_HEIGHT_DIFF_TO_TERRAIN * 1.1 , math.rad( 45 ), math.rad( 50 ))\n    for edgeIndex, v1x, v1z, v2x, v2z in field.polygon:iteratorEdges() do\n        -- offset edges by half ridge width\n        local dx, dz = MathUtil.vector2Normalize(v2x - v1x, v2z - v1z)\n        local dxPerp, dzPerp = - dz, dx\n        v1x = v1x - (dx * deformWidthHalf) + (dxPerp * deformWidthHalf)\n        v1z = v1z - (dz * deformWidthHalf) + (dzPerp * deformWidthHalf)\n\n        v2x = v2x + (dx * deformWidthHalf) + (dxPerp * deformWidthHalf)\n        v2z = v2z + (dz * deformWidthHalf) + (dzPerp * deformWidthHalf)\n\n        -- absolute to relative for deformation\n            v2x, v2z = v2x - v1x, v2z - v1z\n            local hx, hz = MathUtil.vector2SetLength(v2z , - v2x, spec.levelingWidth)\n\n            -- DebugPlane.new():createWithPositionsOffset(v1x, field.height + spec.ridgeHeight, v1z, v2x, 0, v2z, hx, 0, hz):addToManager()\n            field.ridgeDeformation:addArea(v1x, field.height + spec.ridgeHeight, v1z, v2x, 0 , v2z, hx, 0 , hz, terrainBrushId, false )\n        end\n        field.deformQueue = field.deformQueue + 1\n        field.ridgeDeformationJobId = g_terrainDeformationQueue:queueJob(field.ridgeDeformation, false , "onTerrainDeformationTaskFinished" , self , field)\n\n        -- paint ridges\n        terrainBrushId = g_groundTypeManager:getTerrainLayerByType(spec.groundTypeRidge)\n\n        if terrainBrushId ~ = nil then\n            field.ridgeDeformationPaint = TerrainDeformation.new(g_terrainNode)\n            field.ridgeDeformationPaint:enablePaintingMode()\n\n            local ridgeWidthHalf = spec.ridgePaintWidth / 2\n            for edgeIndex, v1x, v1z, v2x, v2z in field.polygon:iteratorEdges() do\n                -- offset edges by half ridge width\n                local dx, dz = MathUtil.vector2Normalize(v2x - v1x, v2z - v1z)\n                local dxPerp, dzPerp = - dz, dx\n                v1x = v1x - (dx * ridgeWidthHalf) + (dxPerp * ridgeWidthHalf)\n                v1z = v1z - (dz * ridgeWidthHalf) + (dzPerp * ridgeWidthHalf)\n\n                v2x = v2x + (dx * ridgeWidthHalf) + (dxPerp * ridgeWidthHalf)\n                v2z = v2z + (dz * ridgeWidthHalf) + (dzPerp * ridgeWidthHalf)\n\n                -- absolute to relative for deformation\n                    v2x, v2z = v2x - v1x, v2z - v1z\n                    local hx, hz = MathUtil.vector2SetLength(v2z , - v2x, spec.ridgePaintWidth)\n\n                    field.ridgeDeformationPaint:addArea(v1x, field.height + spec.ridgeHeight, v1z, v2x, 0 , v2z, hx, 0 , hz, terrainBrushId, false )\n                end\n\n                field.deformQueue = field.deformQueue + 1\n                field.ridgePaintJobId = g_terrainDeformationQueue:queueJob(field.ridgeDeformationPaint, false , "onTerrainDeformationTaskFinished" , self , field)\n            end\n        end\n\n'})}),"\n",(0,r.jsx)(n.h3,{id:"prerequisitespresent",children:"prerequisitesPresent"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Description"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Checks if all prerequisite specializations are loaded"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Definition"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"prerequisitesPresent(table specializations)"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n",(0,r.jsx)(n.table,{children:(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"table"}),(0,r.jsx)(n.th,{children:"specializations"}),(0,r.jsx)(n.th,{children:"specializations"})]})})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Return Values"})}),"\n\n\n\n\n\n\n\n\n",(0,r.jsx)(n.table,{children:(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"table"}),(0,r.jsx)(n.th,{children:"hasPrerequisite"}),(0,r.jsx)(n.th,{children:"true if all prerequisite specializations are loaded"})]})})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Code"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:"function PlaceableRiceField.prerequisitesPresent(specializations)\n    return true\nend\n\n"})}),"\n",(0,r.jsx)(n.h3,{id:"previewnodedestructionnodes",children:"previewNodeDestructionNodes"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Description"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Definition"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"previewNodeDestructionNodes(function superFunc, entityId node)"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"function"}),(0,r.jsx)(n.th,{children:"superFunc"}),(0,r.jsx)(n.th,{})]})}),(0,r.jsx)(n.tbody,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"entityId"}),(0,r.jsx)(n.td,{children:"node"}),(0,r.jsx)(n.td,{children:"node to visualize provided by raycast"})]})})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Return Values"})}),"\n\n\n\n\n\n\n\n",(0,r.jsx)(n.table,{children:(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"entityId"}),(0,r.jsx)(n.th,{children:"nodesToVisualizeByBrush"})]})})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Code"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:"function PlaceableRiceField:previewNodeDestructionNodes(superFunc, node)\n    local field = self:getFieldByNode(node)\n\n    if field ~ = nil then\n        renderShapeOutline(field.mesh, false )\n        I3DUtil.iterateRecursively(field.pumpNode, function (iteratedNode)\n            if getHasClassId(iteratedNode, ClassIds.SHAPE) and not getIsNonRenderable(iteratedNode) and getVisibility(iteratedNode) then\n                renderShapeOutline(iteratedNode, false )\n            end\n        end )\n    end\n\n    return nil -- nothing to visualize by the brush\nend\n\n"})}),"\n",(0,r.jsx)(n.h3,{id:"registereventlisteners",children:"registerEventListeners"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Description"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Definition"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"registerEventListeners()"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,r.jsx)(n.table,{children:(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"any"}),(0,r.jsx)(n.th,{children:"placeableType"})]})})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Code"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:'function PlaceableRiceField.registerEventListeners(placeableType)\n    SpecializationUtil.registerEventListener(placeableType, "onLoad" , PlaceableRiceField )\n    SpecializationUtil.registerEventListener(placeableType, "onDelete" , PlaceableRiceField )\n    SpecializationUtil.registerEventListener(placeableType, "onReadStream" , PlaceableRiceField )\n    SpecializationUtil.registerEventListener(placeableType, "onWriteStream" , PlaceableRiceField )\n    SpecializationUtil.registerEventListener(placeableType, "onReadUpdateStream" , PlaceableRiceField )\n    SpecializationUtil.registerEventListener(placeableType, "onWriteUpdateStream" , PlaceableRiceField )\n    SpecializationUtil.registerEventListener(placeableType, "onDirtyMaskCleared" , PlaceableRiceField )\n    SpecializationUtil.registerEventListener(placeableType, "onUpdateTick" , PlaceableRiceField )\n\n    SpecializationUtil.registerEventListener(placeableType, "onPeriodChanged" , PlaceableRiceField )\nend\n\n'})}),"\n",(0,r.jsx)(n.h3,{id:"registerfunctions",children:"registerFunctions"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Description"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Definition"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"registerFunctions()"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,r.jsx)(n.table,{children:(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"any"}),(0,r.jsx)(n.th,{children:"placeableType"})]})})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Code"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:'function PlaceableRiceField.registerFunctions(placeableType)\n    SpecializationUtil.registerFunction(placeableType, "onPumpI3DLoaded" , PlaceableRiceField.onPumpI3DLoaded)\n    SpecializationUtil.registerFunction(placeableType, "drawDebug" , PlaceableRiceField.drawDebug)\n    SpecializationUtil.registerFunction(placeableType, "getCanCreateNewField" , PlaceableRiceField.getCanCreateNewField)\n    SpecializationUtil.registerFunction(placeableType, "createNewField" , PlaceableRiceField.createNewField)\n    SpecializationUtil.registerFunction(placeableType, "removeFieldByNode" , PlaceableRiceField.removeFieldByNode)\n    SpecializationUtil.registerFunction(placeableType, "removeFieldByIndex" , PlaceableRiceField.removeFieldByIndex)\n    SpecializationUtil.registerFunction(placeableType, "deleteField" , PlaceableRiceField.deleteField)\n    SpecializationUtil.registerFunction(placeableType, "getFields" , PlaceableRiceField.getFields)\n    SpecializationUtil.registerFunction(placeableType, "getFieldByIndex" , PlaceableRiceField.getFieldByIndex)\n    SpecializationUtil.registerFunction(placeableType, "getFieldByNode" , PlaceableRiceField.getFieldByNode)\n    SpecializationUtil.registerFunction(placeableType, "getCanAddVertex" , PlaceableRiceField.getCanAddVertex)\n    SpecializationUtil.registerFunction(placeableType, "getCanFinish" , PlaceableRiceField.getCanFinish)\n    SpecializationUtil.registerFunction(placeableType, "onPolyhedronOverlap" , PlaceableRiceField.onPolyhedronOverlap)\n    SpecializationUtil.registerFunction(placeableType, "onFinishedGrowthPeriod" , PlaceableRiceField.onFinishedGrowthPeriod)\n    SpecializationUtil.registerFunction(placeableType, "getHasValidFields" , PlaceableRiceField.getHasValidFields)\n    SpecializationUtil.registerFunction(placeableType, "addVertex" , PlaceableRiceField.addVertex)\n    SpecializationUtil.registerFunction(placeableType, "removeLastVertex" , PlaceableRiceField.removeLastVertex)\n    SpecializationUtil.registerFunction(placeableType, "tryToFinishField" , PlaceableRiceField.tryToFinishField)\n    SpecializationUtil.registerFunction(placeableType, "finalizeNewField" , PlaceableRiceField.finalizeNewField)\n    SpecializationUtil.registerFunction(placeableType, "onRiceFieldAnswerEvent" , PlaceableRiceField.onRiceFieldAnswerEvent)\n    SpecializationUtil.registerFunction(placeableType, "buildMesh" , PlaceableRiceField.buildMesh)\n    SpecializationUtil.registerFunction(placeableType, "performTerrainDeformation" , PlaceableRiceField.performTerrainDeformation)\n    SpecializationUtil.registerFunction(placeableType, "onTerrainDeformationFinished" , PlaceableRiceField.onTerrainDeformationFinished)\n    SpecializationUtil.registerFunction(placeableType, "onTerrainDeformationFailed" , PlaceableRiceField.onTerrainDeformationFailed)\n    SpecializationUtil.registerFunction(placeableType, "onTerrainDeformationTaskFinished" , PlaceableRiceField.onTerrainDeformationTaskFinished)\n    SpecializationUtil.registerFunction(placeableType, "getFirstAndLastVertex" , PlaceableRiceField.getFirstAndLastVertex)\n    SpecializationUtil.registerFunction(placeableType, "getNumVertices" , PlaceableRiceField.getNumVertices)\n    SpecializationUtil.registerFunction(placeableType, "setWaterHeight" , PlaceableRiceField.setWaterHeight)\n    SpecializationUtil.registerFunction(placeableType, "setEffectVisibility" , PlaceableRiceField.setEffectVisibility)\n    SpecializationUtil.registerFunction(placeableType, "getWaterHeight" , PlaceableRiceField.getWaterHeight)\n    SpecializationUtil.registerFunction(placeableType, "setWaterHeightTarget" , PlaceableRiceField.setWaterHeightTarget)\n    SpecializationUtil.registerFunction(placeableType, "getWaterHeightTarget" , PlaceableRiceField.getWaterHeightTarget)\n    SpecializationUtil.registerFunction(placeableType, "getWaterFillLevel" , PlaceableRiceField.getWaterFillLevel)\n    SpecializationUtil.registerFunction(placeableType, "getWaterFillLevelPerSqm" , PlaceableRiceField.getWaterFillLevelPerSqm)\n    SpecializationUtil.registerFunction(placeableType, "getFieldFillingState" , PlaceableRiceField.getFieldFillingState)\n    SpecializationUtil.registerFunction(placeableType, "getMaxWaterHeight" , PlaceableRiceField.getMaxWaterHeight)\n    SpecializationUtil.registerFunction(placeableType, "getArea" , PlaceableRiceField.getArea)\n    SpecializationUtil.registerFunction(placeableType, "getSupportedFruitTypes" , PlaceableRiceField.getSupportedFruitTypes)\n    SpecializationUtil.registerFunction(placeableType, "playerTriggerCallback" , PlaceableRiceField.playerTriggerCallback)\n    SpecializationUtil.registerFunction(placeableType, "renderEdges" , PlaceableRiceField.renderEdges)\n    SpecializationUtil.registerFunction(placeableType, "getRiceFieldState" , PlaceableRiceField.getRiceFieldState)\n    SpecializationUtil.registerFunction(placeableType, "onRiceFieldStatusResult" , PlaceableRiceField.onRiceFieldStatusResult)\n    SpecializationUtil.registerFunction(placeableType, "getConfirmDestruction" , PlaceableRiceField.getConfirmDestruction)\nend\n\n'})}),"\n",(0,r.jsx)(n.h3,{id:"registeroverwrittenfunctions",children:"registerOverwrittenFunctions"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Description"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Definition"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"registerOverwrittenFunctions()"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,r.jsx)(n.table,{children:(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"any"}),(0,r.jsx)(n.th,{children:"placeableType"})]})})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Code"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:'function PlaceableRiceField.registerOverwrittenFunctions(placeableType)\n    SpecializationUtil.registerOverwrittenFunction(placeableType, "addToPhysics" , PlaceableRiceField.addToPhysics)\n    SpecializationUtil.registerOverwrittenFunction(placeableType, "collectPickObjects" , PlaceableRiceField.collectPickObjects)\n    SpecializationUtil.registerOverwrittenFunction(placeableType, "getIsOnFarmland" , PlaceableRiceField.getIsOnFarmland)\n    SpecializationUtil.registerOverwrittenFunction(placeableType, "getFarmlandId" , PlaceableRiceField.getFarmlandId)\n    SpecializationUtil.registerOverwrittenFunction(placeableType, "getDestructionMethod" , PlaceableRiceField.getDestructionMethod)\n    SpecializationUtil.registerOverwrittenFunction(placeableType, "performNodeDestruction" , PlaceableRiceField.performNodeDestruction)\n    SpecializationUtil.registerOverwrittenFunction(placeableType, "previewNodeDestructionNodes" , PlaceableRiceField.previewNodeDestructionNodes)\nend\n\n'})}),"\n",(0,r.jsx)(n.h3,{id:"registersavegamexmlpaths",children:"registerSavegameXMLPaths"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Description"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Definition"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"registerSavegameXMLPaths()"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"any"}),(0,r.jsx)(n.th,{children:"schema"})]})}),(0,r.jsx)(n.tbody,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"any"}),(0,r.jsx)(n.td,{children:"basePath"})]})})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Code"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:'function PlaceableRiceField.registerSavegameXMLPaths(schema, basePath)\n    schema:setXMLSpecializationType( "RiceField" )\n    schema:register(XMLValueType.FLOAT, basePath .. ".fields.field(?)#worldHeight" , "world height/y level of the field" )\n    schema:register(XMLValueType.FLOAT, basePath .. ".fields.field(?)#waterHeight" , "water height in meters" )\n    schema:register(XMLValueType.FLOAT, basePath .. ".fields.field(?)#waterHeightTarget" , "water level target height in m relative to field ground" )\n    schema:register(XMLValueType.STRING, basePath .. ".fields.field(?)#initialFruit" , "initial fruit for preplaced rice fields" )\n        schema:register(XMLValueType.INT, basePath .. ".fields.field(?)#initialFruitGrowthState" , "initial fruit growth state index for preplaced rice fields" )\n            schema:register(XMLValueType.STRING, basePath .. ".fields.field(?).v(?)" , "outline vertex x z position" )\n            schema:register(XMLValueType.INT, basePath .. ".fields.field(?).waterLevels(?)#period" , "period index" )\n            schema:register(XMLValueType.FLOAT, basePath .. ".fields.field(?).waterLevels(?)#levelPerSqm" , "water level for period" )\n                schema:setXMLSpecializationType()\n            end\n\n'})}),"\n",(0,r.jsx)(n.h3,{id:"registerxmlpaths",children:"registerXMLPaths"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Description"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Definition"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"registerXMLPaths(XMLSchema schema, string basePath)"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"XMLSchema"}),(0,r.jsx)(n.th,{children:"schema"})]})}),(0,r.jsx)(n.tbody,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"basePath"})]})})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Code"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:'function PlaceableRiceField.registerXMLPaths(schema, basePath)\n    schema:setXMLSpecializationType( "RiceField" )\n    schema:register(XMLValueType.STRING, basePath .. ".riceField.area#groundType" , "" , "dirt" )\n    schema:register(XMLValueType.FLOAT, basePath .. ".riceField.area#offsetFromRidge" , "distance in m the ground type inside the rice field if offset from the ridge center" , "-0.5" )\n\n        schema:register(XMLValueType.STRING, basePath .. ".riceField.ridge#groundType" , "" , "grass" )\n        schema:register(XMLValueType.FLOAT, basePath .. ".riceField.ridge#height" , "height of the ridge around the rice field in m" , 0.35 )\n        schema:register(XMLValueType.FLOAT, basePath .. ".riceField.ridge#levelingWidth" , "width of the ridge terrain leveling in m" , 0.45 )\n        schema:register(XMLValueType.FLOAT, basePath .. ".riceField.ridge#paintWidth" , "width of the painted area on the ridge around the rice field in m" , 1 )\n        schema:register(XMLValueType.STRING, basePath .. ".riceField.ridge#foliageType" , "foliage to place ontop of ridge" )\n        schema:register(XMLValueType.INT, basePath .. ".riceField.ridge#foliageGrowthState" , "foliage growth state" , 2 )\n        schema:register(XMLValueType.STRING, basePath .. ".riceField.ridge#foliageGrowthStateName" , "foliage growth state name" )\n        schema:register(XMLValueType.FLOAT, basePath .. ".riceField.ridge#foliageWidth" , "foliage width" , "paintWidth / 2" )\n        schema:register(XMLValueType.FLOAT, basePath .. ".riceField.ridge#foliageOffsetFromRidge" , "foliage offset" , "0.5" )\n\n        schema:register(XMLValueType.FLOAT, basePath .. ".riceField.water#maxLevel" , "maximum height of the water" , "80% or ridge height" )\n        schema:register(XMLValueType.FLOAT, basePath .. ".riceField.water#fillDurationGameMinutes" , "duration for fully filling field in game minutes" )\n            schema:register(XMLValueType.VECTOR_ 4 , basePath .. ".riceField.water#underwaterFogColor" , "shader paramters for underwaterFogColor" )\n                schema:register(XMLValueType.VECTOR_ 4 , basePath .. ".riceField.water#underwaterFogDepth" , "shader paramters for underwaterFogDepth" )\n\n                    schema:register(XMLValueType.FILENAME, basePath .. ".riceField.pump#filename" , "filepath to pump i3d file" )\n                    schema:register(XMLValueType.NODE_INDEX, basePath .. ".riceField.pump.filling#water" , "node index path to filling water mesh" )\n                    schema:register(XMLValueType.NODE_INDEX, basePath .. ".riceField.pump.filling#splash" , "node index path to filling water splash mesh" )\n                    schema:register(XMLValueType.FLOAT, basePath .. ".riceField.pump.filling#yOffset" , "y offset of the splash above the water plane" , 0.07 )\n                    schema:register(XMLValueType.NODE_INDEX, basePath .. ".riceField.pump.emptying#water" , "node index path to emptying water mesh" )\n                    schema:register(XMLValueType.NODE_INDEX, basePath .. ".riceField.pump.emptying#splash" , "node index path to emptying water splash mesh" )\n                    SoundManager.registerSampleXMLPaths(schema, basePath .. ".riceField.pump.sounds" , "pump" )\n                    SoundManager.registerSampleXMLPaths(schema, basePath .. ".riceField.pump.sounds" , "water" )\n\n                    schema:register(XMLValueType.NODE_INDEX, basePath .. ".riceField.playerTrigger#node" , "node of the player trigger" )\n\n                    schema:register(XMLValueType.STRING, basePath .. ".riceField.foliage#fruitTypes" , "" )\n                    schema:register(XMLValueType.FLOAT, basePath .. ".riceField.foliage#offsetFromRidge" , "" )\n                    schema:setXMLSpecializationType()\n                end\n\n'})}),"\n",(0,r.jsx)(n.h3,{id:"savetoxmlfile",children:"saveToXMLFile"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Description"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Definition"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"saveToXMLFile()"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"any"}),(0,r.jsx)(n.th,{children:"xmlFile"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"any"}),(0,r.jsx)(n.td,{children:"key"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"any"}),(0,r.jsx)(n.td,{children:"usedModNames"})]})]})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Code"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:'function PlaceableRiceField:saveToXMLFile(xmlFile, key, usedModNames)\n    local spec = self.spec_riceField\n\n    xmlFile:setTable(key .. ".fields.field" , spec.fields, function (path, field, _)\n        xmlFile:setValue(path .. "#worldHeight" , field.height)\n        xmlFile:setValue(path .. "#waterHeight" , field.waterHeight)\n        if field.waterHeightTarget ~ = nil then\n            xmlFile:setValue(path .. "#waterHeightTarget" , field.waterHeightTarget)\n        end\n\n        local periodIndex = 0\n        for period, waterLevelPerSqm in pairs(field.periodWaterLevelPerSqm) do\n            xmlFile:setValue( string.format( "%s.waterLevels(%d)#period" , path, periodIndex), period)\n            xmlFile:setValue( string.format( "%s.waterLevels(%d)#levelPerSqm" , path, periodIndex), waterLevelPerSqm)\n            periodIndex = periodIndex + 1\n        end\n\n        for vertexIndex, xPos, zPos in field.polygon:iteratorVertices() do\n            xmlFile:setValue( string.format( "%s.v(%d)" , path, vertexIndex - 1 ), string.format( "%.3f %.3f" , xPos, zPos))\n        end\n    end )\nend\n\n'})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}}}]);