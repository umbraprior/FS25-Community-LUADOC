"use strict";(globalThis.webpackChunkfs25_community_luadoc=globalThis.webpackChunkfs25_community_luadoc||[]).push([[66956],{1616(e,n,t){t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"script/StateMachine/PlayerOnFootStateMachine","title":"PlayerOnFootStateMachine","description":"PlayerOnFootStateMachine","source":"@site/../docs/script/StateMachine/PlayerOnFootStateMachine.md","sourceDirName":"script/StateMachine","slug":"/script/StateMachine/PlayerOnFootStateMachine","permalink":"/FS25-Community-LUADOC/script/StateMachine/PlayerOnFootStateMachine","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1767161192000,"frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"WorkParticles","permalink":"/FS25-Community-LUADOC/script/Specializations/WorkParticles"},"next":{"title":"PlayerStateCrouch","permalink":"/FS25-Community-LUADOC/script/StateMachine/PlayerStateCrouch"}}');var r=t(74848),l=t(28453);const o={},i=void 0,s={},c=[{value:"PlayerOnFootStateMachine",id:"playeronfootstatemachine",level:2},{value:"new",id:"new",level:3},{value:"onStateEntered",id:"onstateentered",level:3},{value:"onStateExited",id:"onstateexited",level:3},{value:"updateAsCurrent",id:"updateascurrent",level:3}];function h(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"playeronfootstatemachine",children:"PlayerOnFootStateMachine"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Description"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"A sub-state of the PlayerStateMachine, also being a state machine itself. This is used when the player is walking\naround on foot."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Parent"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"?version=script&category=80&class=841",children:"StateMachine"})}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Functions"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#new",children:"new"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#onstateentered",children:"onStateEntered"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#onstateexited",children:"onStateExited"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#updateascurrent",children:"updateAsCurrent"})}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"new",children:"new"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Description"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Creates the on-foot state machine for the given player."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Definition"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"new(Player player)"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n",(0,r.jsx)(n.table,{children:(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Player"}),(0,r.jsx)(n.th,{children:"player"}),(0,r.jsx)(n.th,{children:"The player who owns the state machine."})]})})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Return Values"})}),"\n\n\n\n\n\n\n\n\n",(0,r.jsx)(n.table,{children:(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Player"}),(0,r.jsx)(n.th,{children:"instance"}),(0,r.jsx)(n.th,{children:"The created instance."})]})})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Code"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:'function PlayerOnFootStateMachine.new(player)\n\n    -- Create the instance.\n    local self = StateMachine.new( PlayerOnFootStateMachine _mt)\n\n    -- The player.\n    self.player = player\n\n    self.stateMachine = player.stateMachine\n\n    -- Create the states.\n    self.states =\n    {\n    idle = PlayerStateIdle.new(player, self ),\n    walking = PlayerStateWalk.new(player, self ),\n    swimming = PlayerStateSwim.new(player, self ),\n    falling = PlayerStateFall.new(player, self ),\n    jumping = PlayerStateJump.new(player, self ),\n    crouching = PlayerStateCrouch.new(player, self )\n    }\n\n    -- Create the state transitions now that the list of states is ready.\n    self:initialiseStateTransitions()\n\n    -- Start on the idle state, and set it as the default.\n    self.currentState = self.states.idle\n    self.defaultState = self.states.idle\n\n    -- Used to determine if this state allows the player to use hand tools.\n        self.canUseHandTools = true\n\n        self.player:addStateEvent( PlayerOnFootStateMachine.onLeaveVehicle, self , "onLeaveVehicle" )\n        self.player:addStateEvent( PlayerOnFootStateMachine.onLeaveVehicle, self , "onLeaveVehicleAsPassenger" )\n        self.player:addStateEvent( PlayerOnFootStateMachine.onLeaveVehicle, self , "onLeaveRollercoaster" )\n\n        -- Return the created instance.\n        return self\n    end\n\n'})}),"\n",(0,r.jsx)(n.h3,{id:"onstateentered",children:"onStateEntered"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Description"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Fired when this state machine becomes the current state of the PlayerStateMachine. This usually happens once the\nplayer leaves a vehicle."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Definition"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"onStateEntered(BaseStateMachineState previousState)"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n",(0,r.jsx)(n.table,{children:(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"BaseStateMachineState"}),(0,r.jsx)(n.th,{children:"previousState"}),(0,r.jsx)(n.th,{children:"The previous state the machine was in before entering this one."})]})})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Code"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:'function PlayerOnFootStateMachine:onStateEntered(previousState)\n    self.player.networkComponent:reset()\n    self.player.graphicsState:setDefault()\n    self.player.graphicsComponent:applyState( self.player.graphicsState)\n    self.player.mover:setSpeed( 0 )\n    self.player.mover:resetHorizontalVelocity()\n\n    --#debug self.player:debugLog(Player.DEBUG_DISPLAY_FLAG.STATE, "Entered on foot state")\n\n    -- Show the player on the server, which will sync with the clients.\n    if self.player.isServer then\n        self.player:show()\n    end\n\n    if self.player.isOwner then\n        local oldContext = g_inputBinding:getContextName()\n        if oldContext ~ = Vehicle.INPUT_CONTEXT_NAME then\n            g_inputBinding:replaceContextInStack( Vehicle.INPUT_CONTEXT_NAME, PlayerInputComponent.INPUT_CONTEXT_NAME)\n        end\n\n        if oldContext = = InputBinding.ROOT_CONTEXT_NAME or oldContext = = Vehicle.INPUT_CONTEXT_NAME or oldContext = = PlaceableRollercoaster.INPUT_CONTEXT_ROLLERCOASTER then\n            -- Make the input current.\n            self.player.inputComponent:makeCurrent()\n        end\n\n        -- Activate the activatable objects.\n        local mission = g_currentMission\n        mission.activatableObjectsSystem:activate( PlayerInputComponent.INPUT_CONTEXT_NAME)\n        mission.hud:setIsControllingPlayer( true )\n\n        -- When the state is entered, it can mean a few things; like the player exiting from a vehicle.\n        -- In any case, there is no way to be certain of what state the player should have, so immediately determine it.\n        -- Only the owner can determine their own state, as non-owners simply follow what the server says.\n        self:determineState()\n    end\nend\n\n'})}),"\n",(0,r.jsx)(n.h3,{id:"onstateexited",children:"onStateExited"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Description"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Fired when this state is exited."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Definition"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"onStateExited(BaseStateMachineState nextState)"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n",(0,r.jsx)(n.table,{children:(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"BaseStateMachineState"}),(0,r.jsx)(n.th,{children:"nextState"}),(0,r.jsx)(n.th,{children:"The state the machine will be in after exiting this one."})]})})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Code"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:"function PlayerOnFootStateMachine:onStateExited(nextState)\n    self.player.networkComponent:reset()\n    self.player.graphicsState:setDefault()\n    self.player.graphicsComponent:applyState( self.player.graphicsState)\n    self.player.graphicsComponent:setModelPosition( self.player:getGraphicalPosition())\n\n    if self.player.isOwner then\n        self.player.mover:setSpeed( 0 )\n        self.player.mover:resetHorizontalVelocity()\n\n        self.player:setCurrentHandTool( nil , true )\n\n        -- Deactivate the activatable objects.\n        local mission = g_currentMission\n        mission.activatableObjectsSystem:deactivate( PlayerInputComponent.INPUT_CONTEXT_NAME)\n    end\nend\n\n"})}),"\n",(0,r.jsx)(n.h3,{id:"updateascurrent",children:"updateAsCurrent"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Description"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"The update function for when this state machine is the current state in the main player state machine. Updates the\non-foot movement and on-foot state."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Definition"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"updateAsCurrent(float dt)"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n",(0,r.jsx)(n.table,{children:(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"float"}),(0,r.jsx)(n.th,{children:"dt"}),(0,r.jsx)(n.th,{children:"Delta time in ms."})]})})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Code"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:'function PlayerOnFootStateMachine:updateAsCurrent(dt)\n    local mission = g_currentMission\n\n    --#profile RemoteProfiler.zoneBeginN("PlayerOnFootStateMachine-updateInput")\n    -- Update the player\'s input component.\n    if self.player.inputComponent ~ = nil then\n        self.player.inputComponent:update(dt)\n    end\n    --#profile RemoteProfiler.zoneEnd()\n\n    --#profile RemoteProfiler.zoneBeginN("PlayerOnFootStateMachine-updateTargeter")\n    -- Update the player\'s targeter.\n    if self.player.targeter ~ = nil then\n        self.player.targeter:update(dt)\n    end\n    --#profile RemoteProfiler.zoneEnd()\n\n    --#profile RemoteProfiler.zoneBeginN("PlayerOnFootStateMachine-preUpdateNetworkComponent")\n    -- Pre-update the network component, if one exists.\n        if self.player.networkComponent ~ = nil then\n            self.player.networkComponent:preUpdate(dt)\n        end\n        --#profile RemoteProfiler.zoneEnd()\n\n        --#profile RemoteProfiler.zoneBeginN("PlayerOnFootStateMachine-updateCamera")\n        -- Update the camera\'s rotation.This should be done before any movement, as the movement direction relies on the direction of the camera.\n        if self.player.camera ~ = nil then\n            self.player.camera:updateRotation(dt)\n        end\n        --#profile RemoteProfiler.zoneEnd()\n\n        --#profile RemoteProfiler.zoneBeginN("PlayerOnFootStateMachine-updateCCT")\n        -- Update the CCT so the height can be correct for the state.\n            self.player.capsuleController:update(dt)\n            --#profile RemoteProfiler.zoneEnd()\n\n            --#profile RemoteProfiler.zoneBeginN("PlayerOnFootStateMachine-update")\n            -- Call the base update function so that the states can be updated.\n                self:update(dt)\n                --#profile RemoteProfiler.zoneEnd()\n\n                --#profile RemoteProfiler.zoneBeginN("PlayerOnFootStateMachine-move")\n                -- If the current state has a horizontal movement function, use it.\n                    if self.player.inputComponent ~ = nil and self.currentState.calculateDesiredHorizontalVelocity then\n\n                        -- Calculate the movement from the current state using the current inputs.\n                        local movementX, movementZ = self.currentState:calculateDesiredHorizontalVelocity( self.player.inputComponent.worldDirectionX, self.player.inputComponent.worldDirectionZ)\n\n                        -- Tell the mover to move horizontally.\n                        self.player.mover:moveHorizontally(movementX, movementZ)\n                    end\n                    --#profile RemoteProfiler.zoneEnd()\n\n                    --#profile RemoteProfiler.zoneBeginN("PlayerOnFootStateMachine-updateMover")\n                    -- Update the mover.\n                    self.player.mover:update(dt)\n                    --#profile RemoteProfiler.zoneEnd()\n\n                    --#profile RemoteProfiler.zoneBeginN("PlayerOnFootStateMachine-setCameraOffset")\n                    -- If the current state has a camera offset, apply it to the camera.\n                    if self.player.camera ~ = nil then\n                        self.player.camera:setOffsetY( self.currentState.cameraOffsetY)\n                    end\n                    --#profile RemoteProfiler.zoneEnd()\n\n                    --#profile RemoteProfiler.zoneBeginN("PlayerOnFootStateMachine-updatePositionInterpolator")\n                    -- Update the positional interpolator, if one exists.\n                        if self.player.positionalInterpolator ~ = nil then\n                            self.player.positionalInterpolator:update(dt)\n                        end\n                        --#profile RemoteProfiler.zoneEnd()\n\n                        --#profile RemoteProfiler.zoneBeginN("PlayerOnFootStateMachine-updateAnimatior")\n                        -- Update the graphics component.\n                        if self.player.isOwner then\n                            self.player.graphicsState:updateLocal( self.player)\n                        else\n                                self.player.graphicsState:updateRemote( self.player)\n                            end\n                            self.player.graphicsComponent:applyState( self.player.graphicsState)\n                            self.player.graphicsComponent:setModelYaw( self.player:getGraphicalYaw())\n                            self.player.graphicsComponent:setModelPosition( self.player:getGraphicalPosition())\n                            --#profile RemoteProfiler.zoneEnd()\n\n                            --#profile RemoteProfiler.zoneBeginN("PlayerOnFootStateMachine-updateGraphics")\n                            self.player.graphicsComponent:update(dt)\n                            --#profile RemoteProfiler.zoneEnd()\n\n                            --#profile RemoteProfiler.zoneBeginN("PlayerOnFootStateMachine-updateCameraPosition")\n                            -- Update the camera\'s position.\n                            if self.player.camera ~ = nil then\n                                self.player.camera:updatePosition(dt)\n                            end\n\n                            if self.player.isOwner then\n                                local x, y, z = self.player:getPosition()\n                                local dirX, dirZ = self.player:getCurrentFacingDirection()\n                                local activatableObjectsSystem = mission.activatableObjectsSystem\n                                activatableObjectsSystem:setPosition(x, y, z)\n                                activatableObjectsSystem:setDirection(dirX, 0 , dirZ)\n                            end\n                            --#profile RemoteProfiler.zoneEnd()\n\n                            --#profile RemoteProfiler.zoneBeginN("PlayerOnFootStateMachine-resetInput")\n                            -- Reset the state of the input component.\n                            if self.player.inputComponent ~ = nil then\n                                self.player.inputComponent:resetState()\n                            end\n                            --#profile RemoteProfiler.zoneEnd()\n\n                            --#profile RemoteProfiler.zoneBeginN("PlayerOnFootStateMachine-updateNetwork")\n                            -- Update the network component, if one exists.\n                                if self.player.networkComponent ~ = nil then\n                                    self.player.networkComponent:update(dt)\n                                end\n                                --#profile RemoteProfiler.zoneEnd()\n                            end\n\n'})})]})}function d(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},28453(e,n,t){t.d(n,{R:()=>o,x:()=>i});var a=t(96540);const r={},l=a.createContext(r);function o(e){const n=a.useContext(l);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),a.createElement(l.Provider,{value:n},e.children)}}}]);