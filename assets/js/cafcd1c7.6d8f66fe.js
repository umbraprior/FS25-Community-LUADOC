"use strict";(globalThis.webpackChunkfs25_community_luadoc=globalThis.webpackChunkfs25_community_luadoc||[]).push([[49945],{28453(e,n,r){r.d(n,{R:()=>a,x:()=>t});var s=r(96540);const i={},l=s.createContext(i);function a(e){const n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(l.Provider,{value:n},e.children)}},43242(e,n,r){r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>t,default:()=>g,frontMatter:()=>a,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"script/Specializations/PlaceableTriggerMarkers","title":"PlaceableTriggerMarkers","description":"PlaceableTriggerMarkers","source":"@site/../docs/script/Specializations/PlaceableTriggerMarkers.md","sourceDirName":"script/Specializations","slug":"/script/Specializations/PlaceableTriggerMarkers","permalink":"/FS25-Community-LUADOC/script/Specializations/PlaceableTriggerMarkers","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1767161192000,"frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"PlaceableTrainSystem","permalink":"/FS25-Community-LUADOC/script/Specializations/PlaceableTrainSystem"},"next":{"title":"PlaceableVehicle","permalink":"/FS25-Community-LUADOC/script/Specializations/PlaceableVehicle"}}');var i=r(74848),l=r(28453);const a={},t=void 0,d={},o=[{value:"PlaceableTriggerMarkers",id:"placeabletriggermarkers",level:2},{value:"onDelete",id:"ondelete",level:3},{value:"onFinalizePlacement",id:"onfinalizeplacement",level:3},{value:"onLoad",id:"onload",level:3},{value:"onMarkerFileLoaded",id:"onmarkerfileloaded",level:3},{value:"prerequisitesPresent",id:"prerequisitespresent",level:3},{value:"registerEventListeners",id:"registereventlisteners",level:3},{value:"registerFunctions",id:"registerfunctions",level:3},{value:"registerXMLPaths",id:"registerxmlpaths",level:3}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"placeabletriggermarkers",children:"PlaceableTriggerMarkers"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Description"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Specialization for placeables"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Functions"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#ondelete",children:"onDelete"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#onfinalizeplacement",children:"onFinalizePlacement"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#onload",children:"onLoad"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#onmarkerfileloaded",children:"onMarkerFileLoaded"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#prerequisitespresent",children:"prerequisitesPresent"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#registereventlisteners",children:"registerEventListeners"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#registerfunctions",children:"registerFunctions"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#registerxmlpaths",children:"registerXMLPaths"})}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"ondelete",children:"onDelete"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Description"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Definition"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"onDelete()"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Code"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-lua",children:"function PlaceableTriggerMarkers:onDelete()\n    local spec = self.spec_triggerMarkers\n    if spec.sharedLoadRequestIds ~ = nil then\n        for _, sharedLoadRequestId in ipairs(spec.sharedLoadRequestIds) do\n            g_i3DManager:releaseSharedI3DFile(sharedLoadRequestId)\n        end\n        spec.sharedLoadRequestIds = nil\n    end\n\n    if spec.triggerMarkers ~ = nil then\n        for _, marker in ipairs(spec.triggerMarkers) do\n            g_currentMission:removeTriggerMarker(marker.node)\n        end\n    end\n\n    g_messageCenter:unsubscribe(MessageType.PLAYER_FARM_CHANGED, self )\n    g_messageCenter:unsubscribe(MessageType.PLAYER_CREATED, self )\nend\n\n"})}),"\n",(0,i.jsx)(n.h3,{id:"onfinalizeplacement",children:"onFinalizePlacement"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Description"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Definition"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"onFinalizePlacement()"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Code"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-lua",children:"function PlaceableTriggerMarkers:onFinalizePlacement()\n    local spec = self.spec_triggerMarkers\n\n    if g_terrainNode ~ = nil then\n        for _, marker in ipairs(spec.triggerMarkers) do\n            if marker.adjustToGround then\n                local x, _, z = getWorldTranslation(marker.node)\n                local y = getTerrainHeightAtWorldPos(g_terrainNode, x, 0 , z) + marker.groundOffset\n                setWorldTranslation(marker.node, x, y, z)\n            end\n        end\n    end\n\n    self:setShowMarkers(g_currentMission.accessHandler:canPlayerAccess( self ))\n\n    -- Get notified when the player visibility state changes\n    g_messageCenter:subscribe(MessageType.PLAYER_FARM_CHANGED, self.onPlayerFarmChanged, self )\n    g_messageCenter:subscribe(MessageType.PLAYER_CREATED, self.onPlayerFarmChanged, self )\nend\n\n"})}),"\n",(0,i.jsx)(n.h3,{id:"onload",children:"onLoad"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Description"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Called on loading"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Definition"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"onLoad(table savegame)"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n",(0,i.jsx)(n.table,{children:(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"table"}),(0,i.jsx)(n.th,{children:"savegame"}),(0,i.jsx)(n.th,{children:"savegame"})]})})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Code"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-lua",children:'function PlaceableTriggerMarkers:onLoad(savegame)\n    local spec = self.spec_triggerMarkers\n    local xmlFile = self.xmlFile\n\n    spec.sharedLoadRequestIds = { }\n\n    spec.triggerMarkers = { }\n\n    -- <markerIcons>\n    -- <markerIcon filename = "$data/shared/assets/marker/markerIconUnload.i3d" id = "UNLOAD" />\n\n    for _, key in xmlFile:iterator( "placeable.triggerMarkers.triggerMarker" ) do\n        local node = xmlFile:getValue(key .. "#node" , nil , self.components, self.i3dMappings)\n        if node = = nil then\n            Logging.xmlWarning(xmlFile, "Missing trigger marker node for \'%s\'" , key)\n                continue\n            end\n\n            local adjustToGround = xmlFile:getValue(key .. "#adjustToGround" , false )\n            local groundOffset = xmlFile:getValue(key .. "#groundOffset" )\n\n            if groundOffset ~ = nil and not adjustToGround then\n                Logging.xmlWarning(xmlFile, "\'groundOffset = %.2f\' given but \'adjustToGround\' is false for \'%s\'" , groundOffset, key)\n                end\n                groundOffset = groundOffset or 0.03 -- 3cm as default to prevent clipping of flat markers with terrain\n\n                --#debug if not getEffectiveVisibility(getParent(node)) then\n                    --#debug Logging.xmlWarning(xmlFile, "Parent of triggerMarker link node \'%s\' (%s) is not visible", getName(node), key .. "#node")\n                    --#debug end\n\n                    -- check if there are any child nodes, which are not a shape(e.g.transformGroups used as targets) or have a collision\n                        --#debug if adjustToGround then\n                            --#debug local tgsOrColNodes = {}\n                            --#debug I3DUtil.iterateRecursively(node, function (nodeToCheck)\n                                --#debug if getRigidBodyType(nodeToCheck) ~ = RigidBodyType.NONE then -- TODO:also warn for non-shapes, e.g.spawnNodes? not getHasClassId(nodeToCheck, ClassIds.SHAPE)\n                                    --#debug table.insert(tgsOrColNodes, getName(nodeToCheck))\n                                    --#debug end\n                                    --#debug end)\n                                    --#debug if #tgsOrColNodes > 0 then\n                                        --#debug Logging.xmlWarning(xmlFile, "triggerMarker link node \'%s\' (%s) has child nodes(%s) which are not shapes without a collision.", getName(node), key .. "#node", table.concat(tgsOrColNodes, ", "))\n                                        --#debug end\n                                        --#debug end\n\n                                        local i3dFilename = self.xmlFile:getValue(key .. "#filename" , nil , self.baseDirectory)\n\n                                        local showAllPlayers = self.xmlFile:getValue(key .. "#showAllPlayers" , false )\n                                        local showOnlyIfOwned = self.xmlFile:getValue(key .. "#showOnlyIfOwned" , false )\n\n                                        local marker = {\n                                        node = node,\n                                        i3dFilename = i3dFilename,\n                                        adjustToGround = adjustToGround,\n                                        groundOffset = groundOffset,\n                                        showAllPlayers = showAllPlayers,\n                                        showOnlyIfOwned = showOnlyIfOwned\n                                        }\n\n                                        if i3dFilename ~ = nil then\n\n                                            local loadingTask = self:createLoadingTask()\n\n                                            local args = {\n                                            marker = marker,\n                                            loadingTask = loadingTask\n                                            }\n\n                                            local sharedLoadRequestId = g_i3DManager:loadSharedI3DFileAsync(i3dFilename, false , false , self.onMarkerFileLoaded, self , args)\n                                            table.insert(spec.sharedLoadRequestIds, sharedLoadRequestId)\n                                        end\n\n                                        table.insert(spec.triggerMarkers, marker)\n                                    end\n                                end\n\n'})}),"\n",(0,i.jsx)(n.h3,{id:"onmarkerfileloaded",children:"onMarkerFileLoaded"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Description"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Definition"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"onMarkerFileLoaded()"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"any"}),(0,i.jsx)(n.th,{children:"i3dNode"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"any"}),(0,i.jsx)(n.td,{children:"failedReason"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"any"}),(0,i.jsx)(n.td,{children:"args"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Code"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-lua",children:"function PlaceableTriggerMarkers:onMarkerFileLoaded(i3dNode, failedReason, args)\n    local linkNode = args.marker.node\n    local loadingTask = args.loadingTask\n\n    if i3dNode ~ = 0 then\n        link(linkNode, i3dNode)\n\n        -- update marker node to be new linked i3d to avoid moving the linkNode(e.g.unloadTriggers) when adjusting to terrain\n        args.marker.node = i3dNode\n    end\n\n    self:finishLoadingTask(loadingTask)\nend\n\n"})}),"\n",(0,i.jsx)(n.h3,{id:"prerequisitespresent",children:"prerequisitesPresent"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Description"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Checks if all prerequisite specializations are loaded"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Definition"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"prerequisitesPresent(table specializations)"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n",(0,i.jsx)(n.table,{children:(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"table"}),(0,i.jsx)(n.th,{children:"specializations"}),(0,i.jsx)(n.th,{children:"specializations"})]})})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Return Values"})}),"\n\n\n\n\n\n\n\n\n",(0,i.jsx)(n.table,{children:(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"table"}),(0,i.jsx)(n.th,{children:"hasPrerequisite"}),(0,i.jsx)(n.th,{children:"true if all prerequisite specializations are loaded"})]})})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Code"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-lua",children:"function PlaceableTriggerMarkers.prerequisitesPresent(specializations)\n    return true\nend\n\n"})}),"\n",(0,i.jsx)(n.h3,{id:"registereventlisteners",children:"registerEventListeners"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Description"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Definition"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"registerEventListeners()"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,i.jsx)(n.table,{children:(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"any"}),(0,i.jsx)(n.th,{children:"placeableType"})]})})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Code"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-lua",children:'function PlaceableTriggerMarkers.registerEventListeners(placeableType)\n    SpecializationUtil.registerEventListener(placeableType, "onLoad" , PlaceableTriggerMarkers )\n    SpecializationUtil.registerEventListener(placeableType, "onDelete" , PlaceableTriggerMarkers )\n    SpecializationUtil.registerEventListener(placeableType, "onFinalizePlacement" , PlaceableTriggerMarkers )\n    SpecializationUtil.registerEventListener(placeableType, "onOwnerChanged" , PlaceableTriggerMarkers )\nend\n\n'})}),"\n",(0,i.jsx)(n.h3,{id:"registerfunctions",children:"registerFunctions"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Description"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Definition"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"registerFunctions()"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,i.jsx)(n.table,{children:(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"any"}),(0,i.jsx)(n.th,{children:"placeableType"})]})})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Code"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-lua",children:'function PlaceableTriggerMarkers.registerFunctions(placeableType)\n    SpecializationUtil.registerFunction(placeableType, "onPlayerFarmChanged" , PlaceableTriggerMarkers.onPlayerFarmChanged)\n    SpecializationUtil.registerFunction(placeableType, "onMarkerFileLoaded" , PlaceableTriggerMarkers.onMarkerFileLoaded)\n    SpecializationUtil.registerFunction(placeableType, "getTriggerMarkerPosition" , PlaceableTriggerMarkers.getTriggerMarkerPosition)\n    SpecializationUtil.registerFunction(placeableType, "setShowMarkers" , PlaceableTriggerMarkers.setShowMarkers)\nend\n\n'})}),"\n",(0,i.jsx)(n.h3,{id:"registerxmlpaths",children:"registerXMLPaths"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Description"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Definition"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"registerXMLPaths()"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"any"}),(0,i.jsx)(n.th,{children:"schema"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"any"}),(0,i.jsx)(n.td,{children:"basePath"})]})})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Code"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-lua",children:'function PlaceableTriggerMarkers.registerXMLPaths(schema, basePath)\n    schema:setXMLSpecializationType( "TriggerMarkers" )\n    schema:register(XMLValueType.NODE_INDEX, basePath .. ".triggerMarkers.triggerMarker(?)#node" , "Trigger marker node" )\n    schema:register(XMLValueType.FILENAME, basePath .. ".triggerMarkers.triggerMarker(?)#filename" , "Trigger marker i3d filename" )\n    schema:register(XMLValueType.BOOL, basePath .. ".triggerMarkers.triggerMarker(?)#adjustToGround" , "Trigger marker adjusted to ground" )\n    schema:register(XMLValueType.FLOAT, basePath .. ".triggerMarkers.triggerMarker(?)#groundOffset" , "Height of the trigger marker above the ground if adjustToGround is enabled" , 0.03 )\n        schema:register(XMLValueType.BOOL, basePath .. ".triggerMarkers.triggerMarker(?)#showAllPlayers" , "Show marker for all players even if they do not have access to the placeable" , false )\n            schema:register(XMLValueType.BOOL, basePath .. ".triggerMarkers.triggerMarker(?)#showOnlyIfOwned" , "Show marker only if owned" , false )\n                schema:setXMLSpecializationType()\n            end\n\n'})})]})}function g(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}}}]);