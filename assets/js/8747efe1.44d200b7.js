"use strict";(globalThis.webpackChunkfs25_community_luadoc=globalThis.webpackChunkfs25_community_luadoc||[]).push([[40608],{28453(e,n,i){i.d(n,{R:()=>r,x:()=>a});var l=i(96540);const s={},t=l.createContext(s);function r(e){const n=l.useContext(t);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),l.createElement(t.Provider,{value:n},e.children)}},44974(e,n,i){i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>l,toc:()=>d});const l=JSON.parse('{"id":"script/Specializations/PlaceableTrainSystem","title":"PlaceableTrainSystem","description":"PlaceableTrainSystem","source":"@site/../docs/script/Specializations/PlaceableTrainSystem.md","sourceDirName":"script/Specializations","slug":"/script/Specializations/PlaceableTrainSystem","permalink":"/FS25-Community-LUADOC/script/Specializations/PlaceableTrainSystem","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1767161192000,"frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"PlaceableTipOcclusionAreas","permalink":"/FS25-Community-LUADOC/script/Specializations/PlaceableTipOcclusionAreas"},"next":{"title":"PlaceableTriggerMarkers","permalink":"/FS25-Community-LUADOC/script/Specializations/PlaceableTriggerMarkers"}}');var s=i(74848),t=i(28453);const r={},a=void 0,c={},d=[{value:"PlaceableTrainSystem",id:"placeabletrainsystem",level:2},{value:"addSplinePositionUpdateListener",id:"addsplinepositionupdatelistener",level:3},{value:"createVehicles",id:"createvehicles",level:3},{value:"finalizeTrain",id:"finalizetrain",level:3},{value:"getCanBeRented",id:"getcanberented",level:3},{value:"getElectricitySpline",id:"getelectricityspline",level:3},{value:"getElectricitySplineLength",id:"getelectricitysplinelength",level:3},{value:"getIsRented",id:"getisrented",level:3},{value:"getIsTrainInDriveableRange",id:"getistrainindriveablerange",level:3},{value:"getLengthSplineTime",id:"getlengthsplinetime",level:3},{value:"getNeedDayChanged",id:"getneeddaychanged",level:3},{value:"getSpline",id:"getspline",level:3},{value:"getSplineLength",id:"getsplinelength",level:3},{value:"getSplineTime",id:"getsplinetime",level:3},{value:"gsIsTrainFilled",id:"gsistrainfilled",level:3},{value:"loadFromXMLFile",id:"loadfromxmlfile",level:3},{value:"onDayChanged",id:"ondaychanged",level:3},{value:"onDelete",id:"ondelete",level:3},{value:"onDeleteObject",id:"ondeleteobject",level:3},{value:"onFinalizePlacement",id:"onfinalizeplacement",level:3},{value:"onLoad",id:"onload",level:3},{value:"onReadStream",id:"onreadstream",level:3},{value:"onReadUpdateStream",id:"onreadupdatestream",level:3},{value:"onSellGoodsQuestion",id:"onsellgoodsquestion",level:3},{value:"onUpdate",id:"onupdate",level:3},{value:"onWriteStream",id:"onwritestream",level:3},{value:"onWriteUpdateStream",id:"onwriteupdatestream",level:3},{value:"prerequisitesPresent",id:"prerequisitespresent",level:3},{value:"railroadVehicleLoaded",id:"railroadvehicleloaded",level:3},{value:"registerEventListeners",id:"registereventlisteners",level:3},{value:"registerFunctions",id:"registerfunctions",level:3},{value:"registerOverwrittenFunctions",id:"registeroverwrittenfunctions",level:3},{value:"registerSavegameXMLPaths",id:"registersavegamexmlpaths",level:3},{value:"registerXMLPaths",id:"registerxmlpaths",level:3},{value:"removeSplinePositionUpdateListener",id:"removesplinepositionupdatelistener",level:3},{value:"rentRailroad",id:"rentrailroad",level:3},{value:"returnRailroad",id:"returnrailroad",level:3},{value:"saveToXMLFile",id:"savetoxmlfile",level:3},{value:"sellGoods",id:"sellgoods",level:3},{value:"setIsTrainTabbable",id:"setistraintabbable",level:3},{value:"setSplineTime",id:"setsplinetime",level:3},{value:"toggleRent",id:"togglerent",level:3},{value:"updateDriveableState",id:"updatedriveablestate",level:3},{value:"updateRailroadVehiclePositions",id:"updaterailroadvehiclepositions",level:3},{value:"updateTrainLength",id:"updatetrainlength",level:3},{value:"updateTrainPositionByLocomotiveSpeed",id:"updatetrainpositionbylocomotivespeed",level:3},{value:"updateTrainPositionByLocomotiveSplinePosition",id:"updatetrainpositionbylocomotivesplineposition",level:3}];function o(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"placeabletrainsystem",children:"PlaceableTrainSystem"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Specialization for placeables"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Functions"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#addsplinepositionupdatelistener",children:"addSplinePositionUpdateListener"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#createvehicles",children:"createVehicles"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#finalizetrain",children:"finalizeTrain"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#getcanberented",children:"getCanBeRented"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#getelectricityspline",children:"getElectricitySpline"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#getelectricitysplinelength",children:"getElectricitySplineLength"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#getisrented",children:"getIsRented"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#getistrainindriveablerange",children:"getIsTrainInDriveableRange"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#getlengthsplinetime",children:"getLengthSplineTime"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#getneeddaychanged",children:"getNeedDayChanged"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#getspline",children:"getSpline"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#getsplinelength",children:"getSplineLength"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#getsplinetime",children:"getSplineTime"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#gsistrainfilled",children:"gsIsTrainFilled"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#loadfromxmlfile",children:"loadFromXMLFile"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#ondaychanged",children:"onDayChanged"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#ondelete",children:"onDelete"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#ondeleteobject",children:"onDeleteObject"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#onfinalizeplacement",children:"onFinalizePlacement"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#onload",children:"onLoad"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#onreadstream",children:"onReadStream"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#onreadupdatestream",children:"onReadUpdateStream"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#onsellgoodsquestion",children:"onSellGoodsQuestion"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#onupdate",children:"onUpdate"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#onwritestream",children:"onWriteStream"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#onwriteupdatestream",children:"onWriteUpdateStream"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#prerequisitespresent",children:"prerequisitesPresent"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#railroadvehicleloaded",children:"railroadVehicleLoaded"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#registereventlisteners",children:"registerEventListeners"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#registerfunctions",children:"registerFunctions"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#registeroverwrittenfunctions",children:"registerOverwrittenFunctions"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#registersavegamexmlpaths",children:"registerSavegameXMLPaths"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#registerxmlpaths",children:"registerXMLPaths"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#removesplinepositionupdatelistener",children:"removeSplinePositionUpdateListener"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#rentrailroad",children:"rentRailroad"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#returnrailroad",children:"returnRailroad"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#savetoxmlfile",children:"saveToXMLFile"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#sellgoods",children:"sellGoods"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#setistraintabbable",children:"setIsTrainTabbable"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#setsplinetime",children:"setSplineTime"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#togglerent",children:"toggleRent"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#updatedriveablestate",children:"updateDriveableState"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#updaterailroadvehiclepositions",children:"updateRailroadVehiclePositions"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#updatetrainlength",children:"updateTrainLength"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#updatetrainpositionbylocomotivespeed",children:"updateTrainPositionByLocomotiveSpeed"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#updatetrainpositionbylocomotivesplineposition",children:"updateTrainPositionByLocomotiveSplinePosition"})}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"addsplinepositionupdatelistener",children:"addSplinePositionUpdateListener"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"addSplinePositionUpdateListener()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"listener"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function PlaceableTrainSystem:addSplinePositionUpdateListener(listener)\n    if listener ~ = nil then\n        local spec = self.spec_trainSystem\n        table.addElement(spec.splinePositionUpdateListener, listener)\n    end\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"createvehicles",children:"createVehicles"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"createVehicles()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function PlaceableTrainSystem:createVehicles()\n    local spec = self.spec_trainSystem\n    if spec.vehicleIdsToLoad ~ = nil and #spec.vehicleIdsToLoad > 0 then\n        for k, uniqueId in ipairs(spec.vehicleIdsToLoad) do\n            local vehicle = g_currentMission.vehicleSystem:getVehicleByUniqueId(uniqueId)\n            if vehicle ~ = nil then\n                if vehicle.setTrainSystem = = nil then\n                    --#debug Logging.devWarning(\"Vehicle '%s' (savegameId %d) is not a railroad vehicle\", vehicle:getName(), uniqueId)\n                    --#debug printCallstack()\n                else\n                        vehicle:setTrainSystem( self )\n                        vehicle.trainVehicleIndex = k\n                        table.insert(spec.railroadVehicles, vehicle)\n                    end\n                end\n            end\n\n            self:finalizeTrain( false )\n        else\n                for k, filename in ipairs(spec.vehiclesToLoad) do\n                    filename = Utils.getFilename(filename, spec.baseDirectory)\n                    spec.numVehiclesToLoad = spec.numVehiclesToLoad + 1\n\n                    local arguments = {\n                    filename = filename,\n                    vehicleIndex = k\n                    }\n\n                    local data = VehicleLoadingData.new()\n                    data:setFilename(filename)\n                    data:setPropertyState(VehiclePropertyState.NONE)\n                    data:setOwnerFarmId(AccessHandler.EVERYONE)\n\n                    data:load(spec.railroadVehicleLoaded, self , arguments)\n                end\n\n            end\n            spec.vehiclesToLoad = { }\n        end\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"finalizetrain",children:"finalizeTrain"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"finalizeTrain()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"attachVehicles"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function PlaceableTrainSystem:finalizeTrain(attachVehicles)\n    if self:getIsBeingDeleted() then\n        return\n    end\n\n    local spec = self.spec_trainSystem\n\n    table.sort(spec.railroadVehicles, function (a, b)\n        return a.trainVehicleIndex < b.trainVehicleIndex\n    end )\n\n    local lastVehicle = nil\n    spec.rootLocomotive = nil\n    for _,railroadVehicle in ipairs(spec.railroadVehicles) do\n        if not railroadVehicle:getIsBeingDeleted() then\n            railroadVehicle:addDeleteListener( self )\n\n            if spec.rootLocomotive = = nil and railroadVehicle.startAutomatedTrainTravel ~ = nil then\n                spec.rootLocomotive = railroadVehicle\n            end\n\n            if attachVehicles and lastVehicle ~ = nil then\n                lastVehicle:attachImplement(railroadVehicle, 1 , 1 , true )\n            end\n\n            lastVehicle = railroadVehicle\n        end\n    end\n\n    self:updateTrainLength(spec.startSplineTime)\n    self:setIsTrainTabbable(spec.isRented and g_currentMission:getFarmId() = = spec.rentFarmId)\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"getcanberented",children:"getCanBeRented"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"getCanBeRented()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"farmId"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function PlaceableTrainSystem:getCanBeRented(farmId)\n    local spec = self.spec_trainSystem\n\n    if spec.isRented then\n        if spec.rentFarmId ~ = farmId then\n            return false\n        end\n    end\n\n    return true\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"getelectricityspline",children:"getElectricitySpline"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"getElectricitySpline()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function PlaceableTrainSystem:getElectricitySpline()\n    local spec = self.spec_trainSystem\n    return spec.electricitySpline\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"getelectricitysplinelength",children:"getElectricitySplineLength"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"getElectricitySplineLength()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function PlaceableTrainSystem:getElectricitySplineLength()\n    local spec = self.spec_trainSystem\n    return spec.electricitySplineLength or 0\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"getisrented",children:"getIsRented"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"getIsRented()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function PlaceableTrainSystem:getIsRented()\n    local spec = self.spec_trainSystem\n    return spec.isRented\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"getistrainindriveablerange",children:"getIsTrainInDriveableRange"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"getIsTrainInDriveableRange()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function PlaceableTrainSystem:getIsTrainInDriveableRange()\n    return self.spec_trainSystem.lastIsInDriveableRange\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"getlengthsplinetime",children:"getLengthSplineTime"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"getLengthSplineTime()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function PlaceableTrainSystem:getLengthSplineTime()\n    local spec = self.spec_trainSystem\n    return spec.trainLengthSplineTime\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"getneeddaychanged",children:"getNeedDayChanged"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"getNeedDayChanged()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"superFunc"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function PlaceableTrainSystem:getNeedDayChanged(superFunc)\n    return true\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"getspline",children:"getSpline"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"getSpline()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function PlaceableTrainSystem:getSpline()\n    local spec = self.spec_trainSystem\n    return spec.spline\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"getsplinelength",children:"getSplineLength"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"getSplineLength()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function PlaceableTrainSystem:getSplineLength()\n    local spec = self.spec_trainSystem\n    return spec.splineLength\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"getsplinetime",children:"getSplineTime"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"getSplineTime()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function PlaceableTrainSystem:getSplineTime()\n    return self.spec_trainSystem.splineTime\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"gsistrainfilled",children:"gsIsTrainFilled"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"gsIsTrainFilled()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function PlaceableTrainSystem:gsIsTrainFilled()\n    local spec = self.spec_trainSystem\n    for _,railroadVehicle2 in ipairs(spec.railroadVehicles) do\n        if railroadVehicle2.getFillUnits ~ = nil then\n            local fillUnits = railroadVehicle2:getFillUnits()\n            for fillUnitIndex, fillUnit in ipairs(fillUnits) do\n                if fillUnit.fillLevel > 0 then\n                    return true\n                end\n            end\n        end\n    end\n\n    return false\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"loadfromxmlfile",children:"loadFromXMLFile"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"loadFromXMLFile()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"xmlFile"})]})}),(0,s.jsx)(n.tbody,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"any"}),(0,s.jsx)(n.td,{children:"key"})]})})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'function PlaceableTrainSystem:loadFromXMLFile(xmlFile, key)\n    local spec = self.spec_trainSystem\n\n    for _, railroadKey in xmlFile:iterator(key .. ".railroadObjects" ) do\n        local index = xmlFile:getValue(railroadKey .. "#index" )\n        if index ~ = nil then\n            local object = spec.railroadObjects[index]\n            if object ~ = nil then\n                object:loadFromXMLFile(xmlFile, railroadKey)\n            end\n        end\n    end\n\n    spec.isRented = xmlFile:getValue(key .. "#isRented" , spec.isRented)\n    spec.rentFarmId = xmlFile:getValue(key .. "#rentFarmId" , spec.rentFarmId)\n    spec.lastRentFarmId = spec.rentFarmId\n    spec.currentPrice = xmlFile:getValue(key .. "#currentPrice" , spec.currentPrice)\n\n    spec.startSplineTime = SplineUtil.getValidSplineTime(xmlFile:getValue(key .. "#splineTime" ) or 0 )\n\n    spec.vehicleIdsToLoad = { }\n    for _, vehicleKey in xmlFile:iterator(key .. ".railroadVehicle" ) do\n        local vehicleUniqueId = xmlFile:getValue(vehicleKey .. "#vehicleUniqueId" )\n        if vehicleUniqueId ~ = nil then\n            table.insert(spec.vehicleIdsToLoad, vehicleUniqueId)\n        end\n    end\nend\n\n'})}),"\n",(0,s.jsx)(n.h3,{id:"ondaychanged",children:"onDayChanged"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"onDayChanged()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function PlaceableTrainSystem:onDayChanged()\n    if self.isServer then\n        local spec = self.spec_trainSystem\n        if spec.currentPrice > 0 then\n            g_currentMission:addMoney( - spec.currentPrice, spec.rentFarmId, MoneyType.LEASING_COSTS, true )\n            g_currentMission:showMoneyChange(MoneyType.LEASING_COSTS, nil , false , spec.rentFarmId)\n            spec.currentPrice = 0\n        end\n    end\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"ondelete",children:"onDelete"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"onDelete()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function PlaceableTrainSystem:onDelete()\n    local spec = self.spec_trainSystem\n\n    if spec.railroadObjects ~ = nil then\n        for _, object in ipairs(spec.railroadObjects) do\n            object:delete()\n        end\n    end\n\n    if spec.railroadVehicles ~ = nil then\n        for _, vehicle in ipairs(spec.railroadVehicles) do\n            vehicle.trainSystem = nil\n        end\n    end\n\n    g_currentMission:removeTrainSystem( self )\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"ondeleteobject",children:"onDeleteObject"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"onDeleteObject()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"object"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function PlaceableTrainSystem:onDeleteObject(object)\n    local spec = self.spec_trainSystem\n    if table.removeElement(spec.railroadVehicles, object) then\n        self:updateTrainLength(spec.splineTime)\n    end\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"onfinalizeplacement",children:"onFinalizePlacement"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"onFinalizePlacement()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function PlaceableTrainSystem:onFinalizePlacement()\n    local spec = self.spec_trainSystem\n\n    if spec.railroadCrossings ~ = nil then\n        for _, railroadCrossing in ipairs(spec.railroadCrossings) do\n            railroadCrossing:findBlockingPositions()\n        end\n    end\n\n    for _, object in ipairs(spec.railroadObjects) do\n        if object.setSplineTimeByPosition ~ = nil then\n            object:setSplineTimeByPosition(object.nearestTime, spec.splineLength)\n        end\n        if object.onSplinePositionTimeUpdate ~ = nil then\n            object:onSplinePositionTimeUpdate(spec.splineTime, spec.splineEndTime)\n        end\n    end\n\n    g_currentMission:addTrainSystem( self )\n\n    if g_currentMission.isMissionStarted then\n        self:createVehicles()\n    else\n            g_messageCenter:subscribeOneshot(MessageType.CURRENT_MISSION_START, PlaceableTrainSystem.createVehicles, self )\n        end\n    end\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"onload",children:"onLoad"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Called on loading"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"onLoad(table savegame)"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"table"}),(0,s.jsx)(n.th,{children:"savegame"}),(0,s.jsx)(n.th,{children:"savegame"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'function PlaceableTrainSystem:onLoad(savegame)\n    local spec = self.spec_trainSystem\n\n    spec.lastUpdateLoopIndex = - 1\n    spec.splineTime = - 1\n    spec.splineTimeSent = spec.splineTime\n    spec.splineEndTime = 0\n    spec.trainLengthSplineTime = 0\n    spec.splinePositionUpdateListener = { }\n    spec.startSplineTime = spec.startSplineTime or 0\n    spec.railroadVehicles = { }\n    spec.trainLength = 0\n    spec.x, spec.y, spec.z = 0 , 0 , 0\n\n    spec.splinePositionSpeedReal = 0\n    spec.splinePositionSpeed = 0\n    spec.firstUpdate = true\n\n    spec.dirtyFlag = self:getNextDirtyFlag()\n    spec.stationDirtyFlag = self:getNextDirtyFlag()\n    spec.networkTimeInterpolator = InterpolationTime.new( 1.2 )\n    spec.networkSplineTimeInterpolator = InterpolatorValue.new( 0 )\n\n    spec.isRented = false\n    spec.rentFarmId = FarmManager.SPECTATOR_FARM_ID\n    spec.lastRentFarmId = FarmManager.SPECTATOR_FARM_ID\n    spec.currentPrice = 0\n    spec.rentPricePerHour = self.xmlFile:getValue( "placeable.trainSystem.rent#pricePerHour" , 0 )\n    spec.rentPricePerMS = spec.rentPricePerHour / 60 / 60 / 1000\n\n    spec.rootLocomotive = nil\n\n    spec.spline = self.xmlFile:getValue( "placeable.trainSystem.spline#node" , nil , self.components, self.i3dMappings)\n    if spec.spline = = nil then\n        Logging.xmlError( self.xmlFile, "Missing spline node!" )\n        self:setLoadingState(PlaceableLoadingState.ERROR)\n        return\n    end\n\n    if not getHasClassId(getGeometry(spec.spline), ClassIds.SPLINE) then\n        Logging.xmlError( self.xmlFile, "Given node is not a spline!" )\n        self:setLoadingState(PlaceableLoadingState.ERROR)\n        return\n    end\n\n    if not getIsSplineClosed(spec.spline) then\n        Logging.xmlError( self.xmlFile, "Train spline is not closed.Open splines are not supported!" )\n        self:setLoadingState(PlaceableLoadingState.ERROR)\n        return\n    end\n\n    spec.splineLength = getSplineLength(spec.spline)\n    spec.splineYOffset = self.xmlFile:getValue( "placeable.trainSystem.spline#splineYOffset" , 0.0 )\n\n    spec.splineDriveRange = { 0 , 1 }\n\n    spec.drivingRangeStart = self.xmlFile:getValue( "placeable.trainSystem.drivingRange#startNode" , nil , self.components, self.i3dMappings)\n    spec.drivingRangeEnd = self.xmlFile:getValue( "placeable.trainSystem.drivingRange#endNode" , nil , self.components, self.i3dMappings)\n    spec.drivingRangeSellingStationId = self.xmlFile:getValue( "placeable.trainSystem.drivingRange#sellingStationId" )\n\n    spec.textDriveInfo = g_i18n:getText( "ui_infoTrainDrive" )\n    spec.textSellQuestion = g_i18n:getText( "ui_questionTrainSellGoods" )\n\n    spec.hasLimitedRange = false\n    if spec.drivingRangeStart ~ = nil and spec.drivingRangeEnd ~ = nil then\n        local nearestDistanceStart = math.huge\n        local nearestDistanceEnd = math.huge\n\n        local x1, y1, z1 = getWorldTranslation(spec.drivingRangeStart)\n        local x2, y2, z2 = getWorldTranslation(spec.drivingRangeEnd)\n\n        for i = 0 , 1 , 0.5 / spec.splineLength do\n            local sx, sy, sz = getSplinePosition(spec.spline, i)\n\n            local distance1 = MathUtil.vector3Length(sx - x1, sy - y1, sz - z1)\n            if distance1 < nearestDistanceStart then\n                nearestDistanceStart = distance1\n                spec.splineDriveRange[ 1 ] = i\n            end\n\n            local distance2 = MathUtil.vector3Length(sx - x2, sy - y2, sz - z2)\n            if distance2 < nearestDistanceEnd then\n                nearestDistanceEnd = distance2\n                spec.splineDriveRange[ 2 ] = i\n            end\n        end\n\n        if spec.splineDriveRange[ 1 ] > spec.splineDriveRange[ 2 ] then\n            local secondValue = spec.splineDriveRange[ 2 ]\n            spec.splineDriveRange[ 2 ] = spec.splineDriveRange[ 1 ]\n            spec.splineDriveRange[ 1 ] = secondValue\n        end\n\n        spec.hasLimitedRange = true\n    end\n\n    spec.sellingStationPlaceable = nil\n    spec.sellingStationPlaceableId = nil\n    spec.sellingStation = nil\n    spec.showDialog = 0\n    spec.showDialogDelay = 0\n\n    spec.lastIsInDriveableRange = true\n    spec.lastSplineTime = 0\n\n    spec.electricitySpline = self.xmlFile:getValue( "placeable.trainSystem.electricitySpline#node" , nil , self.components, self.i3dMappings)\n    if spec.electricitySpline ~ = nil then\n        if getHasClassId(getGeometry(spec.electricitySpline), ClassIds.SPLINE) then\n            if getIsSplineClosed(spec.electricitySpline) then\n                local sx, _, sz = getSplinePosition(spec.spline, 0 )\n                local esx, _, esz = getSplinePosition(spec.spline, 0 )\n                if MathUtil.vector2Length(sx - esx, sz - esz) < 5 then\n                    spec.electricitySplineLength = getSplineLength(spec.electricitySpline)\n                    spec.electricitySplineYOffset = self.xmlFile:getValue( "placeable.trainSystem.electricitySpline#splineYOffset" , 0.0 )\n                else\n                        Logging.xmlError( self.xmlFile, "Railroad and electricity spline should almost start at the same x and z positions.Ignoring electricity spline!" )\n                        spec.electricitySpline = nil\n                    end\n                else\n                        Logging.xmlError( self.xmlFile, "Railroad electricity spline has to be closed.Ignoring electricity spline!" )\n                        spec.electricitySpline = nil\n                    end\n                else\n                        Logging.xmlError( self.xmlFile, "Given electricitySpline node is not a spline.Ignoring electricity spline!" )\n                        spec.electricitySpline = nil\n                    end\n                end\n\n                spec.vehiclesToLoad = { }\n\n                if self.isServer then\n                    for _, baseString in self.xmlFile:iterator( "placeable.trainSystem.train.vehicle" ) do\n                        local filename = self.xmlFile:getValue(baseString .. "#xmlFilename" )\n                        if filename ~ = nil then\n                            table.insert(spec.vehiclesToLoad, filename)\n                        end\n                    end\n                end\n\n                spec.railroadObjects = { }\n                spec.railroadCrossings = { }\n                for _, key in self.xmlFile:iterator( "placeable.trainSystem.railroadCrossings.railroadCrossing" ) do\n                    local railroadCrossing = RailroadCrossing.new( self.isServer, self.isClient, self , self.rootNode)\n                    if railroadCrossing:loadFromXML( self.xmlFile, key, self.components, self.i3dMappings) then\n                        table.insert(spec.railroadCrossings, railroadCrossing)\n                        table.insert(spec.railroadObjects, railroadCrossing)\n                    else\n                            railroadCrossing:delete()\n                        end\n                    end\n\n                    spec.railroadCallers = { }\n                    for _, key in self.xmlFile:iterator( "placeable.trainSystem.railroadCallers.railroadCaller" ) do\n                        local railroadCaller = RailroadCaller.new( self.isServer, self.isClient, self , self.rootNode)\n                        if railroadCaller:loadFromXML( self.xmlFile, key, self.components, self.i3dMappings) then\n                            table.insert(spec.railroadCallers, railroadCaller)\n                            table.insert(spec.railroadObjects, railroadCaller)\n                        end\n                    end\n\n                    for t = 0 , 1 , 0.5 / spec.splineLength do\n                        local x1, y1, z1 = getSplinePosition(spec.spline, t)\n                        for _, object in ipairs(spec.railroadObjects) do\n                            local x2, y2, z2 = getWorldTranslation(object.rootNode)\n                            local distance = MathUtil.vector3Length(x1 - x2, y1 - y2, z1 - z2)\n                            if object.nearestDistance = = nil then\n                                object.nearestDistance = distance\n                                object.nearestTime = t\n                            else\n                                    if object.nearestDistance > distance then\n                                        object.nearestDistance = distance\n                                        object.nearestTime = t\n                                    end\n                                end\n                            end\n                        end\n\n                        spec.railroadVehiclesEndTimes = { }\n                        spec.railroadVehicleUpdateIndex = 0\n\n                        spec.lastVehicle = nil\n                        spec.numVehiclesToLoad = 0\n                    end\n\n'})}),"\n",(0,s.jsx)(n.h3,{id:"onreadstream",children:"onReadStream"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"onReadStream()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"streamId"})]})}),(0,s.jsx)(n.tbody,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"any"}),(0,s.jsx)(n.td,{children:"connection"})]})})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function PlaceableTrainSystem:onReadStream(streamId, connection)\n    if connection:getIsServer() then\n        local spec = self.spec_trainSystem\n        spec.railroadVehicleIds = { }\n        local numVehicles = streamReadInt8(streamId)\n        for i = 1 ,numVehicles do\n            spec.railroadVehicleIds[i] = NetworkUtil.readNodeObjectId(streamId)\n        end\n\n        local splineTime = streamReadFloat32(streamId)\n        spec.networkSplineTimeInterpolator:setValue(splineTime)\n        spec.networkTimeInterpolator:reset()\n        spec.splineTime = splineTime\n\n        for _, railroadObject in ipairs(spec.railroadObjects) do\n            if railroadObject.readStream ~ = nil then\n                railroadObject:readStream(streamId, connection)\n            end\n        end\n\n        spec.isRented = streamReadBool(streamId)\n        spec.rentFarmId = streamReadUIntN(streamId, FarmManager.FARM_ID_SEND_NUM_BITS)\n\n        spec.sellingStationPlaceableId = NetworkUtil.readNodeObjectId(streamId)\n\n        self:raiseActive()\n    end\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"onreadupdatestream",children:"onReadUpdateStream"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"onReadUpdateStream()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"streamId"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"any"}),(0,s.jsx)(n.td,{children:"timestamp"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"any"}),(0,s.jsx)(n.td,{children:"connection"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function PlaceableTrainSystem:onReadUpdateStream(streamId, timestamp, connection)\n    local spec = self.spec_trainSystem\n    if connection:getIsServer() then\n        if streamReadBool(streamId) then\n            local splineTime = streamReadFloat32(streamId)\n            spec.networkTimeInterpolator:startNewPhaseNetwork()\n            spec.networkSplineTimeInterpolator:setTargetValue(splineTime)\n\n            for _, railroadObject in ipairs(spec.railroadObjects) do\n                if railroadObject.readUpdateStream ~ = nil then\n                    railroadObject:readUpdateStream(streamId, timestamp, connection)\n                end\n            end\n        end\n\n        if streamReadBool(streamId) then\n            spec.sellingStationPlaceableId = NetworkUtil.readNodeObjectId(streamId)\n        end\n    end\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"onsellgoodsquestion",children:"onSellGoodsQuestion"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"onSellGoodsQuestion()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"yes"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function PlaceableTrainSystem:onSellGoodsQuestion(yes)\n    if yes then\n        g_client:getServerConnection():sendEvent( PlaceableTrainSystemSellEvent.new( self ))\n    end\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"onupdate",children:"onUpdate"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"onUpdate()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"dt"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'function PlaceableTrainSystem:onUpdate(dt)\n    local spec = self.spec_trainSystem\n\n    if not self.finishedFirstUpdate then\n        self:setIsTrainTabbable(spec.isRented and g_currentMission:getFarmId() = = spec.rentFarmId)\n\n        self.finishedFirstUpdate = true\n    end\n\n    if self.isClient then\n        spec.splinePositionSpeed = spec.splinePositionSpeed * 0.975 + spec.splinePositionSpeedReal * 0.025\n    end\n\n    --#profile RemoteProfiler.zoneBeginN("PlaceableTrainSystem-updateObjects")\n    for _, railroadObject in ipairs(spec.railroadObjects) do\n        if railroadObject.update ~ = nil then\n            railroadObject:update(dt)\n        end\n    end\n    --#profile RemoteProfiler.zoneEnd()\n\n    if spec.isRented then\n        spec.currentPrice = spec.currentPrice + spec.rentPricePerMS * dt\n    end\n\n    if not self.isServer and self.isClient then\n        -- load railroadVehicles on client side\n        if spec.railroadVehicleIds ~ = nil then\n            local allVehiclesSynchronized = true\n            for index, id in pairs(spec.railroadVehicleIds) do\n                local vehicle = NetworkUtil.getObject(id)\n                if vehicle = = nil or not vehicle:getIsSynchronized() then\n                    allVehiclesSynchronized = false\n                end\n            end\n\n            if allVehiclesSynchronized then\n                spec.rootLocomotive = nil\n\n                for index, id in pairs(spec.railroadVehicleIds) do\n                    local vehicle = NetworkUtil.getObject(id)\n                    if vehicle ~ = nil then\n                        vehicle:setTrainSystem( self )\n                        spec.trainLength = spec.trainLength + vehicle:getFrontToBackDistance()\n                        spec.trainLengthSplineTime = spec.trainLength / spec.splineLength\n                        table.insert(spec.railroadVehicles, index, vehicle)\n\n                        if spec.rootLocomotive = = nil and vehicle.startAutomatedTrainTravel ~ = nil then\n                            spec.rootLocomotive = vehicle\n                        end\n                    end\n                    spec.railroadVehicleIds[index] = nil\n                end\n                if next(spec.railroadVehicleIds) = = nil then\n                    spec.railroadVehicleIds = nil\n                    self:setIsTrainTabbable(spec.isRented and g_currentMission:getFarmId() = = spec.rentFarmId)\n                end\n            end\n        end\n\n        -- update train position on client\n        spec.networkTimeInterpolator:update(dt)\n        local interpolationAlpha = spec.networkTimeInterpolator:getAlpha()\n        local splineTime = spec.networkSplineTimeInterpolator:getInterpolatedValue(interpolationAlpha)\n        splineTime = SplineUtil.getValidSplineTime(splineTime)\n        self:updateTrainPositionByLocomotiveSplinePosition(splineTime)\n    end\n\n    if spec.hasLimitedRange then\n        if self.isServer and spec.sellingStationPlaceable = = nil then\n            if spec.drivingRangeSellingStationId ~ = nil then\n                local placeable = g_currentMission.placeableSystem:getPlaceableByUniqueId(spec.drivingRangeSellingStationId)\n                if placeable ~ = nil then\n                    if placeable.spec_sellingStation ~ = nil then\n                        spec.sellingStationPlaceable = placeable\n                        spec.sellingStation = placeable.spec_sellingStation.sellingStation\n\n                        self:raiseDirtyFlags(spec.stationDirtyFlag)\n                    end\n                else\n                        Logging.xmlWarning( self.configFileName, "Unable to find selling station placeable with id %q" , spec.drivingRangeSellingStationId)\n                    end\n\n                    spec.drivingRangeSellingStationId = nil\n                end\n            end\n\n            if spec.sellingStationPlaceable = = nil and spec.sellingStationPlaceableId ~ = nil then\n                local placeable = NetworkUtil.getObject(spec.sellingStationPlaceableId)\n                if placeable ~ = nil then\n                    if placeable.spec_sellingStation ~ = nil then\n                        spec.sellingStationPlaceable = placeable\n                        spec.sellingStation = placeable.spec_sellingStation.sellingStation\n                    end\n                end\n            end\n\n            if spec.showDialogDelay > 0 then\n                spec.showDialogDelay = spec.showDialogDelay - dt\n                if spec.showDialogDelay < = 0 then\n                    local stationName = "UNKNOWN"\n                    if spec.sellingStationPlaceable ~ = nil then\n                        stationName = spec.sellingStationPlaceable:getName()\n                    end\n\n                    local textDriveInfo = string.format(spec.textDriveInfo, stationName)\n                    local textSellQuestion = string.format(spec.textSellQuestion, stationName)\n\n                    if spec.showDialog = = 2 then\n                        YesNoDialog.show( self.onSellGoodsQuestion, self , textDriveInfo .. "\\n\\n" .. textSellQuestion)\n                    else\n                            InfoDialog.show(textDriveInfo)\n                        end\n\n                        spec.showDialog = 0\n                    end\n                end\n            end\n\n            self:updateRailroadVehiclePositions(dt)\n\n            self:raiseActive()\n        end\n\n'})}),"\n",(0,s.jsx)(n.h3,{id:"onwritestream",children:"onWriteStream"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"onWriteStream()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"streamId"})]})}),(0,s.jsx)(n.tbody,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"any"}),(0,s.jsx)(n.td,{children:"connection"})]})})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function PlaceableTrainSystem:onWriteStream(streamId, connection)\n    if not connection:getIsServer() then\n        local spec = self.spec_trainSystem\n        local numVehicles = #spec.railroadVehicles\n        streamWriteInt8(streamId, numVehicles)\n        for i = 1 ,numVehicles do\n            NetworkUtil.writeNodeObject(streamId, spec.railroadVehicles[i])\n        end\n\n        streamWriteFloat32(streamId, spec.splineTimeSent)\n\n        for _, railroadObject in ipairs(spec.railroadObjects) do\n            if railroadObject.writeStream ~ = nil then\n                railroadObject:writeStream(streamId, connection)\n            end\n        end\n\n        streamWriteBool(streamId, spec.isRented)\n        streamWriteUIntN(streamId, spec.rentFarmId, FarmManager.FARM_ID_SEND_NUM_BITS)\n\n        NetworkUtil.writeNodeObject(streamId, spec.sellingStationPlaceable)\n    end\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"onwriteupdatestream",children:"onWriteUpdateStream"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"onWriteUpdateStream()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"streamId"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"any"}),(0,s.jsx)(n.td,{children:"connection"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"any"}),(0,s.jsx)(n.td,{children:"dirtyMask"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function PlaceableTrainSystem:onWriteUpdateStream(streamId, connection, dirtyMask)\n    local spec = self.spec_trainSystem\n    if not connection:getIsServer() then\n        if streamWriteBool(streamId, bit32.band(dirtyMask, spec.dirtyFlag) ~ = 0 ) then\n            streamWriteFloat32(streamId, spec.splineTimeSent)\n\n            for _, railroadObject in ipairs(spec.railroadObjects) do\n                if railroadObject.writeUpdateStream ~ = nil then\n                    railroadObject:writeUpdateStream(streamId, connection, dirtyMask)\n                end\n            end\n        end\n\n        if streamWriteBool(streamId, bit32.band(dirtyMask, spec.stationDirtyFlag) ~ = 0 ) then\n            NetworkUtil.writeNodeObject(streamId, spec.sellingStationPlaceable)\n        end\n    end\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"prerequisitespresent",children:"prerequisitesPresent"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Checks if all prerequisite specializations are loaded"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"prerequisitesPresent(table specializations)"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"table"}),(0,s.jsx)(n.th,{children:"specializations"}),(0,s.jsx)(n.th,{children:"specializations"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Return Values"})}),"\n\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"table"}),(0,s.jsx)(n.th,{children:"hasPrerequisite"}),(0,s.jsx)(n.th,{children:"true if all prerequisite specializations are loaded"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function PlaceableTrainSystem.prerequisitesPresent(specializations)\n    return true\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"railroadvehicleloaded",children:"railroadVehicleLoaded"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"railroadVehicleLoaded()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"vehicles"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"any"}),(0,s.jsx)(n.td,{children:"vehicleLoadState"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"any"}),(0,s.jsx)(n.td,{children:"args"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'function PlaceableTrainSystem:railroadVehicleLoaded(vehicles, vehicleLoadState, args)\n    local filename = args.filename\n    local vehicleIndex = args.vehicleIndex\n\n    local spec = self.spec_trainSystem\n    if vehicleLoadState = = VehicleLoadingState.OK and #vehicles > 0 then\n        local vehicle = vehicles[ 1 ]\n\n        if not self:getIsBeingDeleted() then\n            vehicle:setTrainSystem( self )\n            vehicle.trainVehicleIndex = vehicleIndex\n        end\n\n        table.insert(spec.railroadVehicles, vehicle)\n    else\n            Logging.warning( "(%s) Could not create trainsystem vehicle!" , filename)\n        end\n\n        spec.numVehiclesToLoad = spec.numVehiclesToLoad - 1\n        if spec.numVehiclesToLoad = = 0 and #spec.vehiclesToLoad = = 0 then\n            self:finalizeTrain( true )\n        end\n    end\n\n'})}),"\n",(0,s.jsx)(n.h3,{id:"registereventlisteners",children:"registerEventListeners"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"registerEventListeners()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"placeableType"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'function PlaceableTrainSystem.registerEventListeners(placeableType)\n    SpecializationUtil.registerEventListener(placeableType, "onLoad" , PlaceableTrainSystem )\n    SpecializationUtil.registerEventListener(placeableType, "onDelete" , PlaceableTrainSystem )\n    SpecializationUtil.registerEventListener(placeableType, "onFinalizePlacement" , PlaceableTrainSystem )\n    SpecializationUtil.registerEventListener(placeableType, "onReadStream" , PlaceableTrainSystem )\n    SpecializationUtil.registerEventListener(placeableType, "onWriteStream" , PlaceableTrainSystem )\n    SpecializationUtil.registerEventListener(placeableType, "onReadUpdateStream" , PlaceableTrainSystem )\n    SpecializationUtil.registerEventListener(placeableType, "onWriteUpdateStream" , PlaceableTrainSystem )\n    SpecializationUtil.registerEventListener(placeableType, "onUpdate" , PlaceableTrainSystem )\n    SpecializationUtil.registerEventListener(placeableType, "onDayChanged" , PlaceableTrainSystem )\nend\n\n'})}),"\n",(0,s.jsx)(n.h3,{id:"registerfunctions",children:"registerFunctions"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"registerFunctions()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"placeableType"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'function PlaceableTrainSystem.registerFunctions(placeableType)\n    SpecializationUtil.registerFunction(placeableType, "updateRailroadVehiclePositions" , PlaceableTrainSystem.updateRailroadVehiclePositions)\n    SpecializationUtil.registerFunction(placeableType, "createVehicles" , PlaceableTrainSystem.createVehicles)\n    SpecializationUtil.registerFunction(placeableType, "railroadVehicleLoaded" , PlaceableTrainSystem.railroadVehicleLoaded)\n    SpecializationUtil.registerFunction(placeableType, "finalizeTrain" , PlaceableTrainSystem.finalizeTrain)\n    SpecializationUtil.registerFunction(placeableType, "setIsTrainTabbable" , PlaceableTrainSystem.setIsTrainTabbable)\n    SpecializationUtil.registerFunction(placeableType, "getIsTrainInDriveableRange" , PlaceableTrainSystem.getIsTrainInDriveableRange)\n    SpecializationUtil.registerFunction(placeableType, "getSplineTime" , PlaceableTrainSystem.getSplineTime)\n    SpecializationUtil.registerFunction(placeableType, "setSplineTime" , PlaceableTrainSystem.setSplineTime)\n    SpecializationUtil.registerFunction(placeableType, "addSplinePositionUpdateListener" , PlaceableTrainSystem.addSplinePositionUpdateListener)\n    SpecializationUtil.registerFunction(placeableType, "removeSplinePositionUpdateListener" , PlaceableTrainSystem.removeSplinePositionUpdateListener)\n    SpecializationUtil.registerFunction(placeableType, "updateTrainPositionByLocomotiveSpeed" , PlaceableTrainSystem.updateTrainPositionByLocomotiveSpeed)\n    SpecializationUtil.registerFunction(placeableType, "updateTrainPositionByLocomotiveSplinePosition" , PlaceableTrainSystem.updateTrainPositionByLocomotiveSplinePosition)\n    SpecializationUtil.registerFunction(placeableType, "updateTrainLength" , PlaceableTrainSystem.updateTrainLength)\n    SpecializationUtil.registerFunction(placeableType, "toggleRent" , PlaceableTrainSystem.toggleRent)\n    SpecializationUtil.registerFunction(placeableType, "getCanBeRented" , PlaceableTrainSystem.getCanBeRented)\n    SpecializationUtil.registerFunction(placeableType, "rentRailroad" , PlaceableTrainSystem.rentRailroad)\n    SpecializationUtil.registerFunction(placeableType, "returnRailroad" , PlaceableTrainSystem.returnRailroad)\n    SpecializationUtil.registerFunction(placeableType, "onDeleteObject" , PlaceableTrainSystem.onDeleteObject)\n    SpecializationUtil.registerFunction(placeableType, "getIsRented" , PlaceableTrainSystem.getIsRented)\n    SpecializationUtil.registerFunction(placeableType, "getSplineLength" , PlaceableTrainSystem.getSplineLength)\n    SpecializationUtil.registerFunction(placeableType, "getElectricitySpline" , PlaceableTrainSystem.getElectricitySpline)\n    SpecializationUtil.registerFunction(placeableType, "getElectricitySplineLength" , PlaceableTrainSystem.getElectricitySplineLength)\n    SpecializationUtil.registerFunction(placeableType, "getLengthSplineTime" , PlaceableTrainSystem.getLengthSplineTime)\n    SpecializationUtil.registerFunction(placeableType, "getSpline" , PlaceableTrainSystem.getSpline)\n    SpecializationUtil.registerFunction(placeableType, "updateDriveableState" , PlaceableTrainSystem.updateDriveableState)\n    SpecializationUtil.registerFunction(placeableType, "gsIsTrainFilled" , PlaceableTrainSystem.gsIsTrainFilled)\n    SpecializationUtil.registerFunction(placeableType, "onSellGoodsQuestion" , PlaceableTrainSystem.onSellGoodsQuestion)\n    SpecializationUtil.registerFunction(placeableType, "sellGoods" , PlaceableTrainSystem.sellGoods)\n    SpecializationUtil.registerFunction(placeableType, "getTrainPosition" , PlaceableTrainSystem.getTrainPosition)\nend\n\n'})}),"\n",(0,s.jsx)(n.h3,{id:"registeroverwrittenfunctions",children:"registerOverwrittenFunctions"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"registerOverwrittenFunctions()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"placeableType"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'function PlaceableTrainSystem.registerOverwrittenFunctions(placeableType)\n    SpecializationUtil.registerOverwrittenFunction(placeableType, "getNeedDayChanged" , PlaceableTrainSystem.getNeedDayChanged)\nend\n\n'})}),"\n",(0,s.jsx)(n.h3,{id:"registersavegamexmlpaths",children:"registerSavegameXMLPaths"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"registerSavegameXMLPaths()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"schema"})]})}),(0,s.jsx)(n.tbody,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"any"}),(0,s.jsx)(n.td,{children:"basePath"})]})})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'function PlaceableTrainSystem.registerSavegameXMLPaths(schema, basePath)\n    schema:setXMLSpecializationType( "Train" )\n    schema:register(XMLValueType.FLOAT, basePath .. "#splineTime" , "Current spline time" )\n    schema:register(XMLValueType.BOOL, basePath .. "#isRented" , "Is train rented" )\n    schema:register(XMLValueType.INT, basePath .. "#rentFarmId" , "Train is rented by farm" )\n    schema:register(XMLValueType.FLOAT, basePath .. "#currentPrice" , "Current pending rent price" )\n    schema:register(XMLValueType.STRING, basePath .. ".railroadVehicle(?)#vehicleUniqueId" , "Vehicle unique id" )\n    schema:register(XMLValueType.INT, basePath .. ".railroadObjects(?)#index" , "Object index" )\n    schema:setXMLSpecializationType()\nend\n\n'})}),"\n",(0,s.jsx)(n.h3,{id:"registerxmlpaths",children:"registerXMLPaths"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"registerXMLPaths()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"schema"})]})}),(0,s.jsx)(n.tbody,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"any"}),(0,s.jsx)(n.td,{children:"basePath"})]})})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'function PlaceableTrainSystem.registerXMLPaths(schema, basePath)\n    schema:setXMLSpecializationType( "Train" )\n    schema:register(XMLValueType.FLOAT, basePath .. ".trainSystem.rent#pricePerHour" , "Rent price per real time hour" , 0 )\n\n    schema:register(XMLValueType.NODE_INDEX, basePath .. ".trainSystem.spline#node" , "Spline node" )\n    schema:register(XMLValueType.FLOAT, basePath .. ".trainSystem.spline#splineYOffset" , "Spline Y offset" , 0 )\n\n    schema:register(XMLValueType.NODE_INDEX, basePath .. ".trainSystem.drivingRange#startNode" , "Start of range node" )\n    schema:register(XMLValueType.NODE_INDEX, basePath .. ".trainSystem.drivingRange#endNode" , "End of range node" )\n    schema:register(XMLValueType.STRING, basePath .. ".trainSystem.drivingRange#sellingStationId" , "Unique id of selling station" )\n\n    schema:register(XMLValueType.NODE_INDEX, basePath .. ".trainSystem.electricitySpline#node" , "Electricity spline" )\n    schema:register(XMLValueType.FLOAT, basePath .. ".trainSystem.electricitySpline#splineYOffset" , "Electricity spline Y offset" , 0 )\n\n    schema:register(XMLValueType.STRING, basePath .. ".trainSystem.train.vehicle(?)#xmlFilename" , "XMl filename" )\n\n    RailroadCrossing.registerXMLPaths(schema, basePath .. ".trainSystem.railroadCrossings.railroadCrossing(?)" )\n    RailroadCaller.registerXMLPaths(schema, basePath .. ".trainSystem.railroadCallers.railroadCaller(?)" )\n\n    schema:setXMLSpecializationType()\nend\n\n'})}),"\n",(0,s.jsx)(n.h3,{id:"removesplinepositionupdatelistener",children:"removeSplinePositionUpdateListener"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"removeSplinePositionUpdateListener()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"listener"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function PlaceableTrainSystem:removeSplinePositionUpdateListener(listener)\n    if listener ~ = nil then\n        local spec = self.spec_trainSystem\n        table.removeElement(spec.splinePositionUpdateListener, listener)\n    end\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"rentrailroad",children:"rentRailroad"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"rentRailroad()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"farmId"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"any"}),(0,s.jsx)(n.td,{children:"position"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"any"}),(0,s.jsx)(n.td,{children:"noEventSend"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function PlaceableTrainSystem:rentRailroad(farmId, position, noEventSend)\n    local spec = self.spec_trainSystem\n    if spec.rootLocomotive = = nil then\n        return\n    end\n\n    spec.isRented = true\n\n    spec.rentFarmId = farmId\n    spec.lastRentFarmId = farmId\n    spec.rootLocomotive:setRequestedSplinePosition(position)\n\n    for _, railroadVehicle in ipairs(spec.railroadVehicles) do\n        railroadVehicle:setOwnerFarmId(spec.rentFarmId, true )\n    end\n\n    self:setIsTrainTabbable(g_currentMission:getFarmId() = = farmId)\n\n    PlaceableTrainSystemRentEvent.sendEvent( self , true , farmId, position, noEventSend)\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"returnrailroad",children:"returnRailroad"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"returnRailroad()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"noEventSend"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function PlaceableTrainSystem:returnRailroad(noEventSend)\n    local spec = self.spec_trainSystem\n    spec.isRented = false\n\n    if self.isServer then\n        if spec.currentPrice > 0 then\n            g_currentMission:addMoney( - spec.currentPrice, spec.rentFarmId, MoneyType.LEASING_COSTS, true )\n            g_currentMission:showMoneyChange(MoneyType.LEASING_COSTS, nil , false , spec.rentFarmId)\n            spec.currentPrice = 0\n        end\n\n        spec.rootLocomotive:startAutomatedTrainTravel()\n    end\n\n    spec.rentFarmId = FarmManager.SPECTATOR_FARM_ID\n\n    for _, railroadVehicle in ipairs(spec.railroadVehicles) do\n        railroadVehicle:setOwnerFarmId(spec.rentFarmId, true )\n    end\n\n    self:setIsTrainTabbable( false )\n\n    PlaceableTrainSystemRentEvent.sendEvent( self , false , nil , nil , noEventSend)\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"savetoxmlfile",children:"saveToXMLFile"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"saveToXMLFile()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"xmlFile"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"any"}),(0,s.jsx)(n.td,{children:"key"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"any"}),(0,s.jsx)(n.td,{children:"usedModNames"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'function PlaceableTrainSystem:saveToXMLFile(xmlFile, key, usedModNames)\n    local spec = self.spec_trainSystem\n\n    xmlFile:setValue(key .. "#splineTime" , SplineUtil.getValidSplineTime(spec.splineTime))\n\n    for k, railroadVehicle in ipairs(spec.railroadVehicles) do\n        local railroadKey = string.format( "%s.railroadVehicle(%d)" , key, k - 1 )\n        xmlFile:setValue(railroadKey .. "#vehicleUniqueId" , railroadVehicle:getUniqueId())\n    end\n\n    for k, railroadObject in ipairs(spec.railroadObjects) do\n        local railroadKey = string.format( "%s.railroadObjects(%d)" , key, k - 1 )\n        if railroadObject.saveToXMLFile ~ = nil then\n            xmlFile:setValue(railroadKey .. "#index" , k)\n            railroadObject.saveToXMLFile(xmlFile, railroadKey, usedModNames)\n        end\n    end\n\n    xmlFile:setValue(key .. "#isRented" , spec.isRented)\n    xmlFile:setValue(key .. "#rentFarmId" , spec.rentFarmId)\n    xmlFile:setValue(key .. "#currentPrice" , spec.currentPrice)\nend\n\n'})}),"\n",(0,s.jsx)(n.h3,{id:"sellgoods",children:"sellGoods"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"sellGoods()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function PlaceableTrainSystem:sellGoods()\n    local spec = self.spec_trainSystem\n    if spec.sellingStation ~ = nil and spec.rentFarmId ~ = 0 then\n        local soldDelta = 0\n        for _,railroadVehicle in ipairs(spec.railroadVehicles) do\n            if railroadVehicle.getFillUnits ~ = nil then\n                local fillUnits = railroadVehicle:getFillUnits()\n                for fillUnitIndex, fillUnit in ipairs(fillUnits) do\n                    local delta = spec.sellingStation:addFillLevelFromTool(spec.rentFarmId, fillUnit.fillLevel, fillUnit.fillType, nil , ToolType.UNDEFINED)\n                    railroadVehicle:addFillUnitFillLevel(railroadVehicle:getOwnerFarmId(), fillUnitIndex, - delta, fillUnit.fillType, ToolType.UNDEFINED, nil )\n                    soldDelta = soldDelta + delta\n                end\n            end\n        end\n\n        -- if we've sold something we return the train\n            if soldDelta > 0 then\n                if spec.isRented then\n                    self:returnRailroad()\n                end\n            end\n        end\n    end\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"setistraintabbable",children:"setIsTrainTabbable"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"setIsTrainTabbable()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"isTabbable"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function PlaceableTrainSystem:setIsTrainTabbable(isTabbable)\n    local spec = self.spec_trainSystem\n\n    isTabbable = isTabbable and g_gameSettings:getValue(GameSettings.SETTING.IS_TRAIN_TABBABLE)\n\n    if spec.hasLimitedRange then\n        isTabbable = isTabbable and spec.lastIsInDriveableRange\n    end\n\n    for _,railroadVehicle in ipairs(spec.railroadVehicles) do\n        if railroadVehicle.setIsTabbable ~ = nil then\n            railroadVehicle:setIsTabbable(isTabbable)\n        end\n    end\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"setsplinetime",children:"setSplineTime"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"setSplineTime()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"startTime"})]})}),(0,s.jsx)(n.tbody,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"any"}),(0,s.jsx)(n.td,{children:"endTime"})]})})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function PlaceableTrainSystem:setSplineTime(startTime, endTime)\n    local spec = self.spec_trainSystem\n\n    startTime = SplineUtil.getValidSplineTime(startTime)\nendTime = SplineUtil.getValidSplineTime(endTime)\n\nif startTime ~ = spec.splineTime then\n    if spec.hasLimitedRange then\n        self:updateDriveableState(startTime)\n    end\n\n    for _,listener in ipairs(spec.splinePositionUpdateListener) do\n        listener:onSplinePositionTimeUpdate(startTime, endTime)\n    end\n\n    local delta = startTime - spec.splineTime\n\n    spec.splineTime = startTime\n    spec.splineEndTime = endTime\n\n    spec.x, spec.y, spec.z = getSplinePosition(spec.spline, spec.splineTime)\n\n    local interpDt = g_physicsDt\n    if g_server = = nil then\n        -- on clients, we interpolate the vehicles with g_physicsDtUnclamped, thus we need to use the same for camera interpolation\n            interpDt = g_physicsDtUnclamped\n        end\n\n        spec.splinePositionSpeedReal = delta * spec.splineLength * ( 1000 / interpDt)\n        if self.isServer then\n            spec.splinePositionSpeed = spec.splinePositionSpeedReal\n        end\n\n        if spec.firstUpdate then\n            spec.splinePositionSpeedReal = 0\n            spec.splinePositionSpeed = 0\n            spec.firstUpdate = false\n        end\n\n        for _, railroadVehicle in ipairs(spec.railroadVehicles) do\n            railroadVehicle:setSplineSpeed(spec.splinePositionSpeed, spec.splinePositionSpeedReal)\n        end\n\n        if self.isServer then\n            local threshold = 0.02 / spec.splineLength -- 2 cm threshold\n            if math.abs(spec.splineTime - spec.splineTimeSent) > threshold then\n                spec.splineTimeSent = spec.splineTime\n                self:raiseDirtyFlags(spec.dirtyFlag)\n            end\n        end\n    end\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"togglerent",children:"toggleRent"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"toggleRent()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"farmId"})]})}),(0,s.jsx)(n.tbody,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"any"}),(0,s.jsx)(n.td,{children:"position"})]})})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function PlaceableTrainSystem:toggleRent(farmId, position)\n    local spec = self.spec_trainSystem\n\n    if spec.isRented then\n        if spec.rentFarmId = = farmId then\n            self:returnRailroad()\n        end\n    else\n            self:rentRailroad(farmId, position, false )\n        end\n    end\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"updatedriveablestate",children:"updateDriveableState"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"updateDriveableState()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"newSplineTime"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function PlaceableTrainSystem:updateDriveableState(newSplineTime)\n    local spec = self.spec_trainSystem\n\n    local isInDriveableRange = (newSplineTime % 1 ) > = spec.splineDriveRange[ 1 ] and(newSplineTime % 1 ) < = spec.splineDriveRange[ 2 ]\n    if isInDriveableRange ~ = spec.lastIsInDriveableRange then\n        spec.lastIsInDriveableRange = isInDriveableRange\n        if not isInDriveableRange then\n            for _,railroadVehicle in ipairs(spec.railroadVehicles) do\n                if self.isClient then\n                    if railroadVehicle.getIsEntered ~ = nil and railroadVehicle:getIsEntered() then\n                        g_localPlayer:leaveVehicle()\n\n                        -- show a bit delayed so the player is positionated correctly\n                        spec.showDialogDelay = 100\n                        spec.showDialog = 1\n                        if self:gsIsTrainFilled() then\n                            spec.showDialog = 2\n                        end\n                    end\n                end\n\n                if self.isServer then\n                    local locomotiveSpec = railroadVehicle.spec_locomotive\n                    if locomotiveSpec ~ = nil then\n                        if locomotiveSpec.state ~ = Locomotive.STATE_AUTOMATIC_TRAVEL_ACTIVE\n                            and locomotiveSpec.state ~ = Locomotive.STATE_REQUESTED_POSITION\n                            and locomotiveSpec.state ~ = Locomotive.STATE_REQUESTED_POSITION_BRAKING then\n                            railroadVehicle:setLocomotiveState( Locomotive.STATE_AUTOMATIC_TRAVEL_ACTIVE)\n\n                            -- return rental if train is empty so user will not pay for the drive outside of the map\n                                if not self:gsIsTrainFilled() then\n                                    if spec.isRented then\n                                        self:returnRailroad()\n                                    end\n                                end\n\n                                if spec.splineTime < newSplineTime then\n                                    locomotiveSpec.sellingDirection = 1\n                                else\n                                        locomotiveSpec.sellingDirection = - 1\n                                    end\n                                end\n                            end\n                        end\n                    end\n                else\n                        if self.isServer then\n                            for _,railroadVehicle in ipairs(spec.railroadVehicles) do\n                                local locomotiveSpec = railroadVehicle.spec_locomotive\n                                if locomotiveSpec ~ = nil then\n                                    if not railroadVehicle:getIsReadyForAutomatedTrainTravel() then\n                                        if locomotiveSpec.state = = Locomotive.STATE_AUTOMATIC_TRAVEL_ACTIVE then\n                                            railroadVehicle:setLocomotiveState( Locomotive.STATE_MANUAL_TRAVEL_INACTIVE)\n                                            locomotiveSpec.sellingDirection = 1\n                                        end\n                                    else\n                                            if locomotiveSpec.sellingDirection ~ = nil and locomotiveSpec.sellingDirection < 0 then\n                                                locomotiveSpec.sellingDirection = 1\n\n                                                railroadVehicle:setLocomotiveState( Locomotive.STATE_MANUAL_TRAVEL_INACTIVE)\n                                            end\n                                        end\n                                    end\n                                end\n                            end\n                        end\n\n                        self:setIsTrainTabbable(spec.isRented and g_currentMission:getFarmId() = = spec.rentFarmId)\n                    end\n                end\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"updaterailroadvehiclepositions",children:"updateRailroadVehiclePositions"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"updateRailroadVehiclePositions()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"dt"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'function PlaceableTrainSystem:updateRailroadVehiclePositions(dt)\n    local spec = self.spec_trainSystem\n\n    -- allow vehicle position update only once a frame\n    -- it is triggered by the object that is updated first\n    if spec.lastUpdateLoopIndex < g_updateLoopIndex then\n        spec.lastUpdateLoopIndex = g_updateLoopIndex\n\n        -- update the spline time by the current locomotive speed first, then update the positions on the spline\n        for _, railroadVehicle in pairs(spec.railroadVehicles) do\n            if railroadVehicle.getLocomotiveSpeed ~ = nil then\n                local locomotiveSpeed = railroadVehicle:getLocomotiveSpeed()\n\n                local interpDt = g_physicsDt\n                if g_server = = nil then\n                    -- on clients, we interpolate the vehicles with g_physicsDtUnclamped, thus we need to use the same for camera interpolation\n                        interpDt = g_physicsDtUnclamped\n                    end\n\n                    if locomotiveSpeed ~ = 0 then\n                        --#profile RemoteProfiler.zoneBeginN("Locomotive-updatePosition")\n                        self:updateTrainPositionByLocomotiveSpeed(interpDt, locomotiveSpeed)\n                        --#profile RemoteProfiler.zoneEnd()\n                    end\n                end\n            end\n\n            local maxNumVehicleUpdatesPerFrame = 3\n            for _, railroadVehicle in pairs(spec.railroadVehicles) do\n                local clipDistance = getClipDistance(railroadVehicle.rootNode)\n                if railroadVehicle.currentUpdateDistance < clipDistance then\n                    maxNumVehicleUpdatesPerFrame = math.huge\n                    break\n                end\n            end\n\n            local numUpdates = 0\n            while true do\n                local railroadVehicle = spec.railroadVehicles[spec.railroadVehicleUpdateIndex + 1 ]\n                if railroadVehicle = = nil then\n                    -- on savegame start / delayed loading of vehicles\n                    break\n                end\n\n                local vehicleSplineStartTime = spec.splineTime\n                if spec.railroadVehicleUpdateIndex > 0 then\n                    local railroadVehiclePredecessor = spec.railroadVehicles[spec.railroadVehicleUpdateIndex]\n                    vehicleSplineStartTime = spec.railroadVehiclesEndTimes[railroadVehiclePredecessor]\n                end\n\n                --#profile RemoteProfiler.zoneBeginN("PlaceableTrainSystem-alignToSplineTime " .. (railroadVehicle.configFileNameClean or(railroadVehicle.getName ~ = nil and railroadVehicle:getName()) or railroadVehicle.__CLASSNAME or ""))\n                local vehicleSplineEndTime = railroadVehicle:alignToSplineTime(spec.spline, spec.splineYOffset, vehicleSplineStartTime)\n                --#profile RemoteProfiler.zoneEnd()\n\n                spec.railroadVehiclesEndTimes[railroadVehicle] = vehicleSplineEndTime\n                spec.railroadVehicleUpdateIndex = (spec.railroadVehicleUpdateIndex + 1 ) % #spec.railroadVehicles\n\n                numUpdates = numUpdates + 1\n                if numUpdates = = maxNumVehicleUpdatesPerFrame or numUpdates = = #spec.railroadVehicles then\n                    break\n                end\n            end\n        end\n    end\n\n'})}),"\n",(0,s.jsx)(n.h3,{id:"updatetrainlength",children:"updateTrainLength"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"updateTrainLength()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"splinePosition"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function PlaceableTrainSystem:updateTrainLength(splinePosition)\n    local spec = self.spec_trainSystem\n    for _,railroadVehicle in ipairs(spec.railroadVehicles) do\n        spec.trainLength = spec.trainLength + railroadVehicle:getFrontToBackDistance()\n    end\n    spec.trainLengthSplineTime = spec.trainLength / spec.splineLength\n    self:updateTrainPositionByLocomotiveSplinePosition(splinePosition)\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"updatetrainpositionbylocomotivespeed",children:"updateTrainPositionByLocomotiveSpeed"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"updateTrainPositionByLocomotiveSpeed()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"dt"})]})}),(0,s.jsx)(n.tbody,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"any"}),(0,s.jsx)(n.td,{children:"speed"})]})})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function PlaceableTrainSystem:updateTrainPositionByLocomotiveSpeed(dt, speed)\n    local spec = self.spec_trainSystem\n    local distance = speed * (dt / 1000 )\n    local increment = distance / spec.splineLength\n    local splineTime = self:getSplineTime() + increment\n\n    self:setSplineTime(splineTime, splineTime - spec.trainLengthSplineTime)\nend\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"updatetrainpositionbylocomotivesplineposition",children:"updateTrainPositionByLocomotiveSplinePosition"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Definition"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"updateTrainPositionByLocomotiveSplinePosition()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Arguments"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"any"}),(0,s.jsx)(n.th,{children:"splinePosition"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Code"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"function PlaceableTrainSystem:updateTrainPositionByLocomotiveSplinePosition(splinePosition)\n    local spec = self.spec_trainSystem\n    local splineTime = splinePosition\n\n    self:setSplineTime(splineTime, splineTime - spec.trainLengthSplineTime)\nend\n\n"})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}}}]);